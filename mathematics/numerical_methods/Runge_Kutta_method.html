

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Runge-Kutta integration method &#8212; ESE Jupyter Material</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".cell"
        const thebe_selector_input = ".cell_input div.highlight"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Successive over-relaxation (SOR)" href="Solving_PDEs_SOR.html" />
    <link rel="prev" title="Numerical integration" href="Numerical_integration.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ESE Jupyter Material</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../../intro.html">Landing page</a>
  </li>
  <li class="">
    <a href="../../coding/intro.html">Coding</a>
  </li>
  <li class="">
    <a href="../../geosciences/intro.html">Geosciences</a>
  </li>
  <li class="active">
    <a href="../intro.html">Mathematics</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="../calculus/intro.html">Calculus</a>
    </li>
    <li class="">
      <a href="../complex analysis/intro.html">Complex analysis</a>
    </li>
    <li class="">
      <a href="../differential_equations/intro.html">Differential equations</a>
    </li>
    <li class="">
      <a href="../linear_algebra/intro.html">Linear algebra</a>
    </li>
    <li class="">
      <a href="../mathematical_notation/intro.html">Mathematical notation</a>
    </li>
    <li class="active">
      <a href="intro.html">Numerical methods</a>
      <ul class="nav sidenav_l3">
      <li class="">
        <a href="Forward_time_centred_space.html">Forward Time Centred Space (FTCS) scheme</a>
      </li>
      <li class="">
        <a href="Numerical_integration.html">Numerical integration</a>
      </li>
      <li class="active">
        <a href="">Runge-Kutta integration method</a>
      </li>
      <li class="">
        <a href="Solving_PDEs_SOR.html">Successive over-relaxation (SOR)</a>
      </li>
      <li class="">
        <a href="Timestepping_an_ODE.html">Solving (or “timestepping”) an ordinary differential equation (ODE)</a>
      </li>
    </ul>
    </li>
    <li class="">
      <a href="../series_and_sequences/intro.html">Series and sequences</a>
    </li>
    <li class="">
      <a href="../sets and functions/intro.html">Sets and functions</a>
    </li>
    <li class="">
      <a href="../statistics/intro.html">Statistics</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="../../modules/intro.html">Modules</a>
  </li>
  <li class="">
    <a href="../../z_extra_resources_for_researchers/intro.html">Extra resources for researchers</a>
  </li>
  <li class="">
    <a href="../../genindex.html">Index</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/mathematics/numerical_methods/Runge_Kutta_method.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/primer-computational-mathematics/book/issues/new?title=Issue%20on%20page%20%2Fmathematics/numerical_methods/Runge_Kutta_method.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/primer-computational-mathematics/book/master?urlpath=tree/notebooks/mathematics/numerical_methods/Runge_Kutta_method.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#st-order-ode-integration" class="nav-link">1st order ODE integration</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#exercise" class="nav-link">Exercise</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#coupled-odes-integration" class="nav-link">Coupled ODEs integration</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#mass-hanging-from-a-spring" class="nav-link">Mass hanging from a spring</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#higher-order-odes" class="nav-link">Higher order ODEs</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#temperature-profile-in-a-rod" class="nav-link">Temperature profile in a rod</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="runge-kutta-integration-method">
<span id="runge-kutta-method"></span><h1>Runge-Kutta integration method<a class="headerlink" href="#runge-kutta-integration-method" title="Permalink to this headline">¶</a></h1>
<p id="index-0"><a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta</a> (RK4) is most commonly used method for integrating <a class="reference internal" href="../differential_equations/2_linear_des.html#ode-linear"><span class="std std-ref">Ordinary Differential Equations (ODEs)</span></a>. This method takes into account slope at the beginning, middle (twice) and the end of interval to integrate an ODE with a 4th order accuracy.</p>
<div class="section" id="st-order-ode-integration">
<h2>1st order ODE integration<a class="headerlink" href="#st-order-ode-integration" title="Permalink to this headline">¶</a></h2>
<p>Consider a continuous function \(f(x,y)\), where \(x\) is the independent variable and \(y\) is the dependent variable:
\[\frac{dy}{dx}=f(x,y).\]
Our aim is to find \(y(x)\) and to achieve that, we need to:</p>
<ul class="simple">
<li><p>know the value of \(y=y_0\) at some initial value of \(x=x_0\)</p></li>
<li><p>step forward from the initial point using finite steps of size \(\Delta x\)</p></li>
<li><p>know how much \(y\) changes for each step in \(x\)</p></li>
</ul>
<p>In RK4 method, the independent variable is incremented in steps and the new value for the dependent variable is calculated at the end of each step according to:
\[y_{i+1} = y_i + \frac{1}{6}(k_1+2k_2+2k_3+k_4),\\
x_{i+1} = x_i + \Delta x,\]</p>
<p>where \(\Delta x\) is the increment, \(k_1, k_2, k_3\) and \(k_4\) are slopes calculated as follow:
\[k_1 = \Delta x f(x_i, y_i),\\
k_2 = \Delta x f(x_i + 0.5 \Delta x, y_i + 0.5 k_1),\\
k_3 = \Delta x f(x_i + 0.5 \Delta x, y_i + 0.5 k_2).\\
k_4 = \Delta x f(x_i + \Delta x, y_i + k_3).\]</p>
<p>In this notebook, we will learn how to integrate ODEs with this method.</p>
<p>At first, let’s create a <code class="docutils literal notranslate"><span class="pre">RungeKutta</span></code> function that will calculate slopes and return \(x\) and \(y\) at new step.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">RungeKutta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx</span><span class="p">):</span>
    
    <span class="c1"># Calculate slopes</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k2</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">k4</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k3</span><span class="p">)</span>
    
    <span class="c1"># Calculate new x and y</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">+</span><span class="n">k4</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
    
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p>Analytical solution to the ODE
\[f(x,y)=\frac{dy}{dx}=x^2,\]
with initial values \(x_0 = 1\) and \(y_0=1\) is
\[y(x)=\frac{x^3}{3}+\frac{2}{3}.\]</p>
<p>Let’s solve this equation numerically with RK4 method, with increment \(\Delta x=0.1\) and final position \(x_{end}=2.\)</p>
<p>At first we will define our function \(f(x,y)\) as <code class="docutils literal notranslate"><span class="pre">dxdy1</span></code> and analaytical solution as <code class="docutils literal notranslate"><span class="pre">y1</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dydx1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">y1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">3.</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="mf">3.</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need to set up initial values in the problem - starting positions \(x_0\) and \(y_0\), as well as the increment and ending position:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">x_end</span> <span class="o">=</span> <span class="mf">2.</span>
</pre></div>
</div>
</div>
</div>
<p>To find a solution with RK4 method, we will need to loop over \(x\) values, increasing them by \(\Delta x\) each step until they reach \(x_{end}\). We will also create lists that calculated \(x\) and \(y\) values will be appended to, so that we can plot them afterwards.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x_rk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">y_rk</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>

<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x_end</span><span class="p">:</span>
    
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">RungeKutta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx1</span><span class="p">)</span>

    <span class="n">x_rk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_rk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>As mentioned before, RK4 method is 4th order accurate, while Euler method is 2nd order accurate. To compare the solutions, we will also define <code class="docutils literal notranslate"><span class="pre">Euler</span></code> function and solve the ODE accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Euler</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">x_eu</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">y_eu</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>

<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x_end</span><span class="p">:</span>
    
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Euler</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx1</span><span class="p">)</span>

    <span class="n">x_eu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_eu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can plot results together on one graph:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span> <span class="n">y1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">)),</span> 
         <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Analytical solution&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_rk</span><span class="p">,</span> <span class="n">y_rk</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Numerical solution:</span><span class="se">\n</span><span class="s2">Runge-Kutta&quot;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_eu</span><span class="p">,</span> <span class="n">y_eu</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Numerical solution:</span><span class="se">\n</span><span class="s2">Euler&quot;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
        <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Solution to ODE: $\quad\frac</span><span class="si">{dy}{dx}</span><span class="s2">=x^2$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Runge_Kutta_method_12_0.png" src="../../_images/Runge_Kutta_method_12_0.png" />
</div>
</div>
<p>As we can see, Runge-Kutta is much more accurate than Euler method. That’s the reson why it is more often used when integrating ODEs. In this case Euler method underestimated the analytical solution.</p>
<div class="section" id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h3>
<p>Let’s solve
\[\frac{dy}{dx}=\frac{1}{xy}\]
numerically with Runge-Kutta method. We will assume again that \(x_0 = 1\), \(y_0=1\), \(\Delta x=0.1\) and \(x_{end}=2.\). The analytical solution to this example is
\[\sqrt{1+2\log{x}}.\]</p>
<div class="dropdown tip admonition">
<p class="admonition-title">Define functions</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dydx2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="dropdown tip admonition">
<p class="admonition-title">Define necessary variables</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">xend</span> <span class="o">=</span> <span class="mf">2.</span>

<span class="n">x_rk</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">y_rk</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="dropdown tip admonition">
<p class="admonition-title">Solve the ODE with RK4 method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>

<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xend</span><span class="p">:</span>
    
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">RungeKutta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx2</span><span class="p">)</span>
    
    <span class="n">x_rk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_rk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="dropdown tip admonition">
<p class="admonition-title">Solve the ODE with Euler method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_eu</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">y_eu</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>

<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xend</span><span class="p">:</span>  

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Euler</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx2</span><span class="p">)</span>
    
    <span class="n">x_eu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y_eu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this example, Euler method overestimated the solution, while RK4 method proves to be very accurate:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../../_images/Runge_Kutta_method_16_0.png" src="../../_images/Runge_Kutta_method_16_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="coupled-odes-integration">
<h2>Coupled ODEs integration<a class="headerlink" href="#coupled-odes-integration" title="Permalink to this headline">¶</a></h2>
<p>Often systems will have more than one dependent variable. In order to be solved, we will need the same number of differential equations as the number of independent variables.</p>
<p>Let’s assume a system with two coupled ODEs, with two dependent variables \(y\) and \(z\), and one independent variable \(x\):</p>
<p>\[\frac{dy}{dx}=f(x,y,z),\quad \frac{dz}{dx}=g(x,y,z).\]</p>
<p>Solving it with Runge-Kutta will be very similar to solving one equation. We will now have to define slopes for two functions.</p>
<p>Initial slopes:
\[k_1 = \Delta x f(x_i, y_i, z_i),\]
\[h_1 = \Delta x g(x_i, y_i, z_i).\]
Middle slopes:
\[k_2 = \Delta x f(x_i + 0.5 \Delta x, y_i + 0.5 k_1, z_i+0.5h_1),\]
\[h_2 = \Delta x g(x_i + 0.5 \Delta x, y_i + 0.5 k_1, z_i+0.5h_1),\]
\[k_3 = \Delta x f(x_i + 0.5 \Delta x, y_i + 0.5 k_2, z_i+0.5h_2),\]
\[h_3 = \Delta x g(x_i + 0.5 \Delta x, y_i + 0.5 k_2, z_i+0.5h_2).\]
Final slopes:
\[k_4 = \Delta x f(x_i + \Delta x, y_i + k_3, z_i + h_3),\]
\[h_4 = \Delta x g(x_i + \Delta x, y_i + k_3, z_i + h_3).\]</p>
<p>Then, \(x, y, z\) are updated according to:
\[y_{i+1} = y_i + \frac{1}{6}(k_1+2k_2+2k_3+k_4),\]
\[z_{i+1} = z_i + \frac{1}{6}(h_1+2h_2+2h_3+h_4),\]
\[x_{i+1} = x_i + \Delta x.\]</p>
<p>To solve the ODEs, we will need starting positions \(x_0, y_0\) and \(z_0\).</p>
<p>We can define <code class="docutils literal notranslate"><span class="pre">RungeKuttaCoupled</span></code> for coupled ODEs solution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">RungeKuttaCoupled</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dydx</span><span class="p">,</span> <span class="n">dzdx</span><span class="p">):</span>
    
    <span class="n">k1</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dzdx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="n">h1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dzdx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k1</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="n">h1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k2</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="n">h2</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dzdx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k2</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="n">h2</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">k4</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dydx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k3</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="n">h3</span><span class="p">)</span>
    <span class="n">h4</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">dzdx</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">k3</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="n">h3</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k3</span><span class="o">+</span><span class="n">k4</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">h2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">h3</span><span class="o">+</span><span class="n">h4</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span>
    
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mass-hanging-from-a-spring">
<h3>Mass hanging from a spring<a class="headerlink" href="#mass-hanging-from-a-spring" title="Permalink to this headline">¶</a></h3>
<p>We can use RK4 for coupled ODEs to solve for position and velocity of a mass hanging from a spring as a function of time.</p>
<p>The spring obeys Hooke’s law:
\[F_x = -kx,\]
where \(x\) is the displacement of the spring and \(F_s\) is the force exerted by the spring. The force due to gravity can be written as:
\[F_g=-mg,\]
where \(m\) is the mass of the weight and \(g\) is the acceleration due to gravity. By force balance, we obtain:
\[m\frac{dv}{dt}=-kx-mg,\]
where \(v\) is the velocity of the mass. Dividing the equation by \(m\), we obtain:
\[\frac{dv}{dt}=-\frac{k}{m}x-g.\]
This is our first ODE to be solved.</p>
<p>We can also note, that by definition \(\frac{dx}{dt}=v\), therefore our coupled ODE system is:</p>
<ol class="simple">
<li><p>\(\frac{dv}{dt}=-\frac{k}{m}x-g\)</p></li>
<li><p>\(\frac{dx}{dt}=v\)</p></li>
</ol>
<p>We will know solve for position and velocity of the mass as a function of time, assuming that the mass is initially at rest (\(v_0=0\) at \(x_0=0\) and \(t_0=0\)). We will use \(g=1\), \(\frac{k}{m}=1\), \(\Delta t=0.1\) and \(t_{end}=30\).</p>
<p>We need to think what are our variables in terms of \((x, y, z)\) in the <code class="docutils literal notranslate"><span class="pre">RungeKuttaCoupled</span></code> funciton. We know that that \(v\) and \(x\) depend on time, therefore we will have \((x, y, z)\rightarrow (t, v, x)\). Now we can write functions for the variables accordingly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dvdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mf">1.</span>

<span class="k">def</span> <span class="nf">dxdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<p>We will again define initial values for our variables, increment and \(t_{end}\):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">t_end</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
</div>
</div>
<p>We can now iterate over time increments to obtain position and velocity. Make sure that the order of derivatives matches the order of independent variables taken by <code class="docutils literal notranslate"><span class="pre">RungeKuttaCoupled</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>
<span class="n">v_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">v0</span><span class="p">]</span>
<span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>

<span class="k">while</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">t_end</span><span class="p">:</span>
    
    <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">RungeKuttaCoupled</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dvdt</span><span class="p">,</span> <span class="n">dxdt</span><span class="p">)</span>
    
    <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The results show an oscillatory motion, with velocity being out of phase.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Spring movement without friction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_list</span><span class="p">,</span> <span class="n">v_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Position&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity/position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Runge_Kutta_method_26_0.png" src="../../_images/Runge_Kutta_method_26_0.png" />
</div>
</div>
<p>The numerical solution looks consistent with behaviour in real world, however, in reality friction dampens the motion.</p>
<p>Therefore, we can solve a new set of ODEs that take into account friction that obeys equation:
\[F_{friction} = -fv.\]</p>
<p>Our new system of ODEs is then:</p>
<ol class="simple">
<li><p>\(\frac{dv}{dt}=-g-\frac{k}{m}x-\frac{f}{m}v\)</p></li>
<li><p>\(\frac{dx}{dt}=v\)</p></li>
</ol>
<p>Assuming \(\frac{f}{m}=0.2\), we can calculate new trajectory of the mass.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dvdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">v</span>

<span class="k">def</span> <span class="nf">dxdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>
<span class="n">v_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">v0</span><span class="p">]</span>
<span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>

<span class="k">while</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">t_end</span><span class="p">:</span>
    
    <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">RungeKuttaCoupled</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dvdt</span><span class="p">,</span> <span class="n">dxdt</span><span class="p">)</span>
    
    <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Spring movement with friction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_list</span><span class="p">,</span> <span class="n">v_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Velocity&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_list</span><span class="p">,</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Position&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity/position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Runge_Kutta_method_28_0.png" src="../../_images/Runge_Kutta_method_28_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="higher-order-odes">
<h2>Higher order ODEs<a class="headerlink" href="#higher-order-odes" title="Permalink to this headline">¶</a></h2>
<p>Higher order ODEs are often encountered in nature. For example, diffusion and heat transfer are 2nd order ODEs. The order of an ODE indicates which derivatives it contains. Diffusion and heat transfer equations will therefire include second derivatives.</p>
<p>To solve a higher order ODE with Runge-Kutta method we must break it down into a set of 1st order ODEs. For example, if we have a second order ODE:
\[\frac{d^2y}{dx^2}=f(x,y,\frac{dy}{dx}),\]
we can make the following substitution to solve the system as two coupled 1st order ODEs:
\[\frac{dy}{dx}=z, \quad \frac{dz}{dx}=f(x,y,z).\]</p>
<div class="section" id="temperature-profile-in-a-rod">
<h3>Temperature profile in a rod<a class="headerlink" href="#temperature-profile-in-a-rod" title="Permalink to this headline">¶</a></h3>
<p>A long thin rod connects two bodies with different temperatures. At steady state, the temperature profile in a long thin rod is governed by the following equation:</p>
<p>\[\frac{d^2\tau}{dx^2}=-K(\tau-\tau_{ext}),\]</p>
<p>where \(\tau\) is a non-dimensional temperature, \(\tau_{ext}\) is the temperature of the environment to which heat is being lost. \(K\) is a ratio of the heat transfer to the environment versus the conduction along the rod.</p>
<p>The heat flux, \(H,\) is given by the following relationship:</p>
<p>\[H=-\frac{d\tau}{dx}.\]</p>
<p>We can rewrite the system into two 1st order ODEs by using heat flux \(H\).</p>
<p>At first we need to change the first equation to involve \(H\):
\[\frac{d^2\tau}{dx^2}=\frac{d}{dx}\left(\frac{dx}{d\tau}\right), \quad \frac{d\tau}{dx}=-H.\]
Therefore,</p>
<p>\[\frac{d(-H)}{dx}=-K(\tau-\tau_{ext}) \Rightarrow \frac{dH}{dx}=K(\tau-\tau_{ext}).\]</p>
<p>Assuming \(H_0=10\), \(\tau_0=100\), \(\tau_{ext}=0\), \(\Delta x = 0.01\) and \(K=1\), we can calculate the temperature and heat flux out of the other end of the rod of length 1.</p>
<p>We can define functions for derivatives:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dHdx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span><span class="p">):</span>
    <span class="c1"># dH/dx = K*(t-t_ext)</span>
    <span class="c1"># K = 1</span>
    <span class="c1"># t_ext = 0</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="k">def</span> <span class="nf">dtdx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">H</span>
</pre></div>
</div>
</div>
</div>
<p>Define variables:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">H0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x_end</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.01</span>
</pre></div>
</div>
</div>
</div>
<p>Solve for temperature and heat flux:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
<span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>
<span class="n">H_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">H0</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H0</span>

<span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x_end</span><span class="p">:</span>
    
    <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">RungeKuttaCoupled</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dtdx</span><span class="p">,</span> <span class="n">dHdx</span><span class="p">)</span>
    
    <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">H_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">t_list</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Length&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$\tau(1)=</span><span class="si">%.2f</span><span class="s2">^\circ$C&quot;</span> <span class="o">%</span> <span class="n">t_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">H_list</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;magenta&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Length&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Heat flux&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;$H(1)=</span><span class="si">%.2f</span><span class="s2">$ W/m$^2$&quot;</span> <span class="o">%</span> <span class="n">H_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Runge_Kutta_method_36_0.png" src="../../_images/Runge_Kutta_method_36_0.png" />
</div>
</div>
<p>What happens if we change the external temperature between 0 and 100\(^\circ\)C?</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">temp_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">flux_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">temps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">seismic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">temps</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temps</span><span class="p">)):</span>
    
    <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
    <span class="n">t_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>
    <span class="n">H_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">H0</span><span class="p">]</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t0</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">H0</span>
    
    <span class="k">def</span> <span class="nf">dHdx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">-</span><span class="n">temps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x_end</span><span class="p">:</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="n">RungeKuttaCoupled</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dtdx</span><span class="p">,</span> <span class="n">dHdx</span><span class="p">)</span>
        
        <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">t_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">H_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
        
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">t_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">H_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">$^\circ$C&quot;</span> <span class="o">%</span> <span class="n">temps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Length&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature&quot;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Length&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Heat flux&quot;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;External temperature&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Effect of external temperature on temperature and heat flux in the rod&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Runge_Kutta_method_38_0.png" src="../../_images/Runge_Kutta_method_38_0.png" />
</div>
</div>
<p>As the external temperature decreases, the temperature profile in the rod decreases as well. Heat flux, however, increases at the other end of the rod as the gradient in temperature becomes sharper.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "primer-computational-mathematics/book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./mathematics/numerical_methods"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Numerical_integration.html" title="previous page">Numerical integration</a>
    <a class='right-next' id="next-link" href="Solving_PDEs_SOR.html" title="next page">Successive over-relaxation (SOR)</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Imperial College London<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>