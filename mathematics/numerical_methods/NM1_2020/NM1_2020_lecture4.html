

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Numerical Methods I &#8212; ESE Jupyter Material</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/mystnb.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".cell"
        const thebe_selector_input = ".cell_input div.highlight"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ESE Jupyter Material</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../../../intro.html">Landing page</a>
  </li>
  <li class="">
    <a href="../../../coding/intro.html">Coding</a>
  </li>
  <li class="">
    <a href="../../../geosciences/intro.html">Geosciences</a>
  </li>
  <li class="">
    <a href="../../intro.html">Mathematics</a>
  </li>
  <li class="">
    <a href="../../../z_extra_resources_for_researchers/intro.html">Extra resources for researchers</a>
  </li>
  <li class="">
    <a href="../../../genindex.html">Index</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/mathematics/numerical_methods/NM1_2020/NM1_2020_lecture4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/primer-computational-mathematics/book/issues/new?title=Issue%20on%20page%20%2Fmathematics/numerical_methods/NM1_2020/NM1_2020_lecture4.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/primer-computational-mathematics/book/master?urlpath=tree/notebooks/mathematics/numerical_methods/NM1_2020/NM1_2020_lecture4.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Numerical Methods I</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#lecture-4-roots-of-equations" class="nav-link">Lecture 4: Roots of Equations</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#learning-objectives" class="nav-link">Learning objectives:</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#contents" class="nav-link">Contents</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#i-linear-equations-and-nonlinearity" class="nav-link">I.      Linear Equations and Nonlinearity</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#ii-picard-s-method-of-successive-approximations-or-fixed-point-iteration" class="nav-link">II.     Picard’s method of successive approximations (or fixed point iteration)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#iii-roots-of-equations" class="nav-link">III.    Roots of Equations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#iv-subintervals-and-initial-guess" class="nav-link">IV.    Subintervals and Initial Guess</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#v-root-bracketing" class="nav-link">V.     Root Bracketing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#vi-bisection-method" class="nav-link">VI.    Bisection Method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#vii-newton-method" class="nav-link">VII.   Newton Method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#viii-quasi-newton-method" class="nav-link">VIII.  Quasi Newton Method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#ix-secant-method" class="nav-link">IX.    Secant Method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#x-potential-convergence-issues" class="nav-link">X.     Potential Convergence Issues</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#i-linear-equations-and-non-linearity" class="nav-link">I.   Linear Equations and Non linearity</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#examples-of-nonlinearity" class="nav-link">Examples of nonlinearity</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#an-example-nonlinear-equation" class="nav-link">An example nonlinear equation</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id1" class="nav-link">II.    Picard’s method of successive approximations (or fixed point iteration)</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#fixed-points" class="nav-link">Fixed points</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#observations" class="nav-link">Observations</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#algorithm-picard-iteration" class="nav-link">Algorithm (Picard iteration)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-1-span" class="nav-link"><span style="color:blue">Exercise 4.1: </span></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id2" class="nav-link">III. Roots of equations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#iv-subintervals-and-initial-guesses" class="nav-link">IV.   Subintervals and initial guesses</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-2-span" class="nav-link"><span style="color:blue">Exercise 4.2:</span></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id3" class="nav-link">V.    Root bracketing</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-3-span" class="nav-link"><span style="color:blue">Exercise 4.3: </span></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id4" class="nav-link">VI.    Bisection method</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-4-span" class="nav-link"><span style="color:blue">Exercise 4.4: </span></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id5" class="nav-link">VII.    Newton Method</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-5-span" class="nav-link"><span style="color:blue">Exercise 4.5: </span></a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#viii-quasi-newton-with-approximate-derivative" class="nav-link">VIII.    (Quasi-) Newton with approximate derivative</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-6-span" class="nav-link"><span style="color:blue">Exercise 4.6: </span></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id6" class="nav-link">IX.   Secant Method</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#span-style-color-blue-exercise-4-7-span" class="nav-link"><span style="color:blue">Exercise 4.7:</span></a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id7" class="nav-link">X.  Potential convergence Issues</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#multiple-roots" class="nav-link">Multiple roots</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#nearly-singular-numerical-overflow" class="nav-link">Nearly singular/numerical overflow</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#oscillation" class="nav-link">Oscillation</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="numerical-methods-i">
<h1>Numerical Methods I<a class="headerlink" href="#numerical-methods-i" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="lecture-4-roots-of-equations">
<h1>Lecture 4: Roots of Equations<a class="headerlink" href="#lecture-4-roots-of-equations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="learning-objectives">
<h2>Learning objectives:<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Identify nonlinear equations</p></li>
<li><p>Solve these equations using the <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> functions <code class="docutils literal notranslate"><span class="pre">bisect</span></code> and <code class="docutils literal notranslate"><span class="pre">newton</span></code></p></li>
<li><p>Explain the algorithms that underlie the Bisection, Newton and Secant method</p></li>
<li><p>Explain why these methods are considered <em>iterative</em> and <em>approximative</em> and how this relates to <em>tolerances</em></p></li>
<li><p>Explain three types of <em>convergence</em> errors</p></li>
</ul>
</div>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="i-linear-equations-and-nonlinearity">
<h2>I.      Linear Equations and Nonlinearity<a class="headerlink" href="#i-linear-equations-and-nonlinearity" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="ii-picard-s-method-of-successive-approximations-or-fixed-point-iteration">
<h2>II.     Picard’s method of successive approximations (or fixed point iteration)<a class="headerlink" href="#ii-picard-s-method-of-successive-approximations-or-fixed-point-iteration" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="iii-roots-of-equations">
<h2>III.    Roots of Equations<a class="headerlink" href="#iii-roots-of-equations" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="iv-subintervals-and-initial-guess">
<h2>IV.    Subintervals and Initial Guess<a class="headerlink" href="#iv-subintervals-and-initial-guess" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="v-root-bracketing">
<h2>V.     Root Bracketing<a class="headerlink" href="#v-root-bracketing" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="vi-bisection-method">
<h2>VI.    Bisection Method<a class="headerlink" href="#vi-bisection-method" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="vii-newton-method">
<h2>VII.   Newton Method<a class="headerlink" href="#vii-newton-method" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="viii-quasi-newton-method">
<h2>VIII.  Quasi Newton Method<a class="headerlink" href="#viii-quasi-newton-method" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="ix-secant-method">
<h2>IX.    Secant Method<a class="headerlink" href="#ix-secant-method" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="x-potential-convergence-issues">
<h2>X.     Potential Convergence Issues<a class="headerlink" href="#x-potential-convergence-issues" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># some imports we will make at the start of every notebook</span>
<span class="c1"># later notebooks may add to this with specific SciPy modules</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># scipy&#39;s optimization</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">sop</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="i-linear-equations-and-non-linearity">
<h1>I.   Linear Equations and Non linearity<a class="headerlink" href="#i-linear-equations-and-non-linearity" title="Permalink to this headline">¶</a></h1>
<p>A <strong>system is said to be linear</strong> if it can be represented by a <strong>linear function</strong> (<em>i.e.</em> a straight line in 1D):</p>
<div class="math notranslate nohighlight">
\[ f(x) := a + kx, \]</div>
<p>where <span class="math notranslate nohighlight">\(f(x)\)</span> is a quantity of interest that depends on some variable <span class="math notranslate nohighlight">\(x\)</span>, which can be quantified through measurements or observations.</p>
<p>For example, if you put the money in your bank which gives <strong>simple</strong> interest based as a percentage of money in your 1st year, and well, you kind of forgot about this money in your bank. Years later, you rediscover the money in the bank, but your forgetfullness prevents you from remembering the details of the bank contract. However, by sifting through the bank letters in your past years, we obtain some measurement and observation about the growth of your money in the bank, and using these measurements and observations, you find the amount of money you have now in the bank, i.e. the quantity of money you currently have in the bank, which depend on some variable, i.e. the initial amount of money you put in the bank.</p>
<p>Then you discover taxes and inflation, and you realize that your money depreciated through its years in the bank. Luckily, your currency of choice is not the German Marks in the 1920s Weimar Republic that might have contributed to well certain developments in the future.</p>
<p>To a linear system we can associate a <strong>linear equation</strong>, where we basically set the function to be equal to something, hence the word <strong>equation</strong>, which can be written in the form:</p>
<div class="math notranslate nohighlight">
\[ f(x) = 0 \;\;\;\; \text{where} \;\;\;\; f(x) := a + kx. \]</div>
<p>We’ve set the <em>function</em> equal to something (here we chose zero) to obtain an <em>equation</em>.</p>
<p>[Our aim will be to find a solution <span class="math notranslate nohighlight">\(x\)</span> to this equation. Note that for linear problems this is trivial if the problem is scalar valued, meaning that solving the above linear equation should be not be a problem for any of you. In the following lectures we will consider linear systems for vectors - i.e. matrix systems, where instead of <span class="math notranslate nohighlight">\(x\)</span> we have a matrix, and instead of <span class="math notranslate nohighlight">\(f(x)\)</span> we have another matrix. <span class="math notranslate nohighlight">\(a and b\)</span> could also be matrices too! You should have done these in your mathematics modules. In the rest of this lecture, we will stick to scalars, but we will deal with equations that are non linear, since scalar linear equation shown above should be easily solvable for all of you!]</p>
<div class="section" id="examples-of-nonlinearity">
<h2>Examples of nonlinearity<a class="headerlink" href="#examples-of-nonlinearity" title="Permalink to this headline">¶</a></h2>
<p>Note that the majority of real world systems cannot be expressed in such simple (linear) terms.</p>
<p>[Note also that discretisations of nonlinear ODEs or PDEs (e.g. being nonlinear in order to accurately represent the nonlinear real world) results in nonlinear discrete systems for which we need to make use of techniques such as those introduced in this lecture. Discretization is the process of transferring continuous functions, models, variables, and equations into discrete counterparts. Discretizing ODEs or PDEs often mean we concenrn ourselves with a limited range for the ODEs and the PDEs, where we are actually interested. For example, ODEs and PDEs can be used to describe fluid motion, and a key parameter in the motion of material in Earth’s mantle (Earth’s mantle can be considered, on the geological time scale of things, to be a fluid with no strength - Dr. Rebecca Bell) is temperature (Geodynamics 2nd edition - Turcotte &amp; Schubert). However, we know that the Earth’s mantle could only possibly be within a certain temperature range, i.e. we are not expecting the mantle to be close to absolute zero, or to be hotter than the Sun, so we limit ourselves to analyzing a limited range of temperatures for our PDEs and ODEs. So if your solution to ODE or PDE somehow ends up telling you that the interior of the Earth is hotter than the Sun in your simulations, you might want to double check why Earth is not undergoing nuclear fusion.]</p>
<p>They are then called nonlinear systems, and equations representing them contain terms like:</p>
<ul class="simple">
<li><p>$ x^2,; x^3,\ldots;;;$ e.g. higher (<span class="math notranslate nohighlight">\(&gt;1\)</span>) order powers that would appear in polynomials.</p></li>
<li><p>$ \sqrt{x},; x^{1/3}, x^{\pi},\ldots ;;; $ e.g. roots, radicals and other non-integer polynomials.</p></li>
<li><p>$\tan(x),; \sin(x), ; \log(x),; \text{erf}(x), \ldots ;;; $ e.g. trigonometric and other <a class="reference external" href="https://en.wikipedia.org/wiki/Special_functions"><em>special functions</em></a>.</p></li>
</ul>
<p>You should be familiar, for example, with quadratic equations <span class="math notranslate nohighlight">\(f(x) := a x^2 + bx + c = 0\)</span>, for which there exist the well known analytic solutions:</p>
<div class="math notranslate nohighlight">
\[
x^*_{1,2} := \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}\,.
\]</div>
<p>The solutions <span class="math notranslate nohighlight">\(\,x^*_{1,2}\,\)</span> are commonly referred to as the <strong>roots</strong> of the equation - this means that <span class="math notranslate nohighlight">\(\,f(x^*_{1}) = f(x^*_{2}) =0\)</span>.</p>
</div>
<div class="section" id="an-example-nonlinear-equation">
<h2>An example nonlinear equation<a class="headerlink" href="#an-example-nonlinear-equation" title="Permalink to this headline">¶</a></h2>
<p>An example of a nonlinear problem without trivial solution is:</p>
<div class="math notranslate nohighlight">
\[ x = \tan(x). \]</div>
<p>There is no exact analytic solution to this equation, so we have to devise methods to find approximate solutions of this equation.</p>
<p>That is, we are looking for  <span class="math notranslate nohighlight">\(x_{\text{approx}}\)</span> such that</p>
<div class="math notranslate nohighlight">
\[x _{\text{approx}} \approx \tan(x_{\text{approx}}), \]</div>
<p>to a set <em>tolerance</em> (or <em>precision</em>).</p>
<p>Note that we can of course equivalently look to solve the problem</p>
<div class="math notranslate nohighlight">
\[ f(x) \approx 0 \;\;\;\;\text{where}\;\;\;\; f(x):= x - \tan(x), \]</div>
<p>[or of course equivalently we could instead choose to define <span class="math notranslate nohighlight">\(\,f(x):= \tan(x) - x\)</span>].</p>
<p>We will often do this (move all terms of our equation to one side and set equal to zero) to make our presentation of the theory below, as well as our implementation of solvers, generic. In this context a solution to the problem <span class="math notranslate nohighlight">\(f(x)=0\)</span> is called a <strong>root</strong>.</p>
<p>Basically, moving everything to the one side, and letting the other side be 0 make you, the programmer, and maybe the computer’s life slightly easier, so we often do this when wanting to solve equations.</p>
<p>Q. Why is this equation nonlinear ? How many roots does this equation have ?</p>
<p>We will see a plot of this problem in a couple of cells.</p>
</div>
</div>
<div class="section" id="id1">
<h1>II.    Picard’s method of successive approximations (or fixed point iteration)<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="fixed-points">
<h2>Fixed points<a class="headerlink" href="#fixed-points" title="Permalink to this headline">¶</a></h2>
<p>Before moving on to problems written in the completely general form <span class="math notranslate nohighlight">\(\,f(x) = 0\,\)</span>, in this section we will consider equations that can be written as:</p>
<div class="math notranslate nohighlight">
\[ x = g(x), \]</div>
<p>where <span class="math notranslate nohighlight">\(g\)</span> is a given function.</p>
<p>[Of course if we’re given a problem of the second type we can make it look like the first simply by defining <span class="math notranslate nohighlight">\(\,f(x) := x-g(x)\,\)</span> or <span class="math notranslate nohighlight">\(\,f(x) = g(x)-x,\,\)</span> as we did for the problem involving <span class="math notranslate nohighlight">\(\,\tan\,\)</span> above]</p>
<p>An <span class="math notranslate nohighlight">\(x\)</span> that satisfies this equation is sometimes called a <strong>fixed point</strong> of the function <span class="math notranslate nohighlight">\(g\)</span>.</p>
<p>It’s called this since if we keep applying the function <span class="math notranslate nohighlight">\(g\)</span> to the output, then the output never changes, i.e.</p>
<div class="math notranslate nohighlight">
\[x = g(x) = g(g(x)) = g(g(g(x))) = \ldots \]</div>
<p>As an example, consider the function</p>
<div class="math notranslate nohighlight">
\[ g(x) := x^{2}-3x+4. \]</div>
<p>This has the fixed point 2, since <span class="math notranslate nohighlight">\(g(2)=2\)</span>.</p>
<p>While the example</p>
<div class="math notranslate nohighlight">
\[ g(x) = x+1, \]</div>
<p>clearly has no fixed points - every application of the function adds another one to our <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>If we plot the function <span class="math notranslate nohighlight">\(y = g(x)\)</span> as a curve in <span class="math notranslate nohighlight">\((x,y)\)</span> space then the fixed points (if they exist) are the locations where this curve intersects with the line <span class="math notranslate nohighlight">\(y=x\)</span>.</p>
<p>Let’s see some examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y = g(x) = x^2-3x+4$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y = x$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fixed point example 1&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y = g(x)=x+1$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y = x$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fixed point example 2&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># don&#39;t plot large values - comment out next two lines to see issue</span>
<span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">&gt;</span><span class="mf">100.</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">&lt;-</span><span class="mf">100.</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y = g(x)=\tan(x)$&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y = x$&#39;</span><span class="p">)</span>
<span class="c1"># I know that tan(0) = 0, so I already know one of the roots </span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
<span class="c1"># NB. the following values found below using bisection</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">4.493409156799316</span><span class="p">,</span> <span class="mf">4.493409156799316</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">7.725251197814941</span><span class="p">,</span> <span class="mf">7.725251197814941</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fixed point example 3&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x134344f0&gt;
</pre></div>
</div>
<img alt="../../../_images/NM1_2020_lecture4_8_1.png" src="../../../_images/NM1_2020_lecture4_8_1.png" />
</div>
</div>
<div class="section" id="observations">
<h3>Observations<a class="headerlink" href="#observations" title="Permalink to this headline">¶</a></h3>
<p>The first example has a single unique fixed point, the second has no fixed point, and the third has infinitely many.</p>
</div>
</div>
<div class="section" id="algorithm-picard-iteration">
<h2>Algorithm (Picard iteration)<a class="headerlink" href="#algorithm-picard-iteration" title="Permalink to this headline">¶</a></h2>
<p>The simplest method to find approximate fixed points/roots to this kind of equation consists in guessing <span class="math notranslate nohighlight">\(x\)</span>, plugging it into the right-hand-side <span class="math notranslate nohighlight">\(g(\cdot)\)</span> and evaluating the function.</p>
<p>The resulting new value for <span class="math notranslate nohighlight">\(x\)</span> is then used as an updated guess.</p>
<p>A sequence of <span class="math notranslate nohighlight">\(x^{(k)}\)</span> values are thus defined via the iteration:</p>
<div class="math notranslate nohighlight">
\[ x^{(k+1)} = g\left(x^{(k)}\right), \]</div>
<p>starting from some initial guess <span class="math notranslate nohighlight">\(x^{(0)}\)</span>.</p>
<p>This procedure can be repeated until some stopping criteria is met, e.g. when two consecutive values for <span class="math notranslate nohighlight">\(x\)</span> differ by less than some user-defined tolerance.</p>
<p>Note that here</p>
<div class="math notranslate nohighlight">
\[x^{(k+1)} - x^{(k)} = g\left(x^{(k)}\right) - x^{(k)}\]</div>
<p>and so the ‘change in <span class="math notranslate nohighlight">\(x\)</span>’ value dropping below our tolerance is equivalent to us satisfying <span class="math notranslate nohighlight">\(x=g(x)\)</span> to that same tolerance!</p>
<p>This strategy is often referred to as (Picard’s) method of successive approximations.</p>
<p>A pseudo-code description of this solution strategy looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guess</span> <span class="n">x</span>
<span class="n">x_previous</span> <span class="o">:=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">tolerance</span>   <span class="c1"># so that the initial evaluation in the while loop is true.</span>
<span class="k">while</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_previous</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance</span> <span class="p">)</span> <span class="n">do</span>   
    <span class="n">x_previous</span> <span class="o">:=</span> <span class="n">x</span>
    <span class="n">x</span> <span class="o">:=</span> <span class="n">g</span><span class="p">(</span><span class="n">x_previous</span><span class="p">)</span>
</pre></div>
</div>
<p><span style="color:red"> The superscript here does not always mean raising something to a certain power as we usually mean. In mathematics, superscript is also used to note the steps of an iteration. The first step would be 0 (remember: Python index starts from 0), i.e. <span class="math notranslate nohighlight">\(x^0\)</span> and <span class="math notranslate nohighlight">\(g(x)^0\)</span> and the next step would be 1 i.e. <span class="math notranslate nohighlight">\(x^1\)</span> and <span class="math notranslate nohighlight">\(g(x)^1\)</span> </span></p>
<p>Basically, Picard Iteration starts with your equation in the form of</p>
<div class="math notranslate nohighlight">
\[x=g(x)\]</div>
<p>We can take an initial guess for <span class="math notranslate nohighlight">\(x\)</span> and see what does <span class="math notranslate nohighlight">\(g(x)\)</span> result in. Your initial guess would probably result in <span class="math notranslate nohighlight">\(x\)</span> not equal to <span class="math notranslate nohighlight">\(g(x)\)</span> that you found. That is not a problem, that is okay. You cannot expect to get the answer to the equation through simple guessing alone. There will be certain difference between your initial guess of <span class="math notranslate nohighlight">\(x\)</span> and the initial <span class="math notranslate nohighlight">\(g(x)\)</span> you found, let’s call this difference <span class="math notranslate nohighlight">\(d^0\)</span></p>
<p>Since we are doing iteration, and since Python index starts from <span class="math notranslate nohighlight">\(0\)</span>. Let’s call the initial guess to be <span class="math notranslate nohighlight">\(x^0\)</span> and the result you get from the initial guess to be <span class="math notranslate nohighlight">\(g(x)^0\)</span>.</p>
<p>We could try to guess again, and maybe this time, our guess will be better, or maybe not. Picard Iteration basically tells you to take the <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step and replace <span class="math notranslate nohighlight">\(x\)</span> in the new step with this value, and then find a new <span class="math notranslate nohighlight">\(g(x)\)</span>.</p>
<p>Therefore, this time
You will use the result you have obtained from <span class="math notranslate nohighlight">\(g(x)^0\)</span> as your next guess for <span class="math notranslate nohighlight">\(x\)</span> and use that to obtain <span class="math notranslate nohighlight">\(g(x)^1\)</span></p>
<div class="math notranslate nohighlight">
\[x^1 = g(x)^0\]</div>
<div class="math notranslate nohighlight">
\[x^1 = g(x)^1\]</div>
<p>Now your <span class="math notranslate nohighlight">\(x^1\)</span> and your <span class="math notranslate nohighlight">\(g(x)^1\)</span> are probably still not the same. And that’s is still okay. We again note down the difference between <span class="math notranslate nohighlight">\(x^1\)</span> and <span class="math notranslate nohighlight">\(g(x)^1\)</span>, and we can call this difference <span class="math notranslate nohighlight">\(d^1\)</span></p>
<p>Now, there are <span class="math notranslate nohighlight">\(2\)</span> possible outcomes.</p>
<p>The outcome desired is that <span class="math notranslate nohighlight">\(d^1\)</span> is smaller than <span class="math notranslate nohighlight">\(d^0\)</span>, i.e. <span class="math notranslate nohighlight">\(d^1&lt;d^0\)</span>, which means that the difference between <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> is decreasing. In our case here, it is that the difference between <span class="math notranslate nohighlight">\(x^0\)</span> and <span class="math notranslate nohighlight">\(g(x)^0\)</span> decreased when we moved forward one iteration step to find the difference between <span class="math notranslate nohighlight">\(x^1\)</span> and <span class="math notranslate nohighlight">\(g(x)^1\)</span>. Remember, you are trying to solve for the equation that <span class="math notranslate nohighlight">\(x = g(x)\)</span>, which means that you want to find the value of <span class="math notranslate nohighlight">\(x\)</span> so that there is no difference in between <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(g(x)\)</span>. If the difference decreases, it is good. If the difference keeps decreasing, it is very good, since eventually the difference becomes so small, that <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(g(x)\)</span> becomes effectively the same. Even though you may argue that <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(g(x)\)</span> will always have a teeny tiny difference no matter how many steps you go, would you really care about that difference like on the (insert random large numebr)th decimal place, when the (the random large number from before, but minus 1) decimal place are all the same? Probably not. Your lecturers and professors always advice against like writing lots of decimals places on your test, and may even mark you down for that. You should also note that your computer hardware may not even support that many decimal places and even for the most expensive of hardware, there is a certain limit to their floating point precision.</p>
<p>If the difference between the <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> keeps on decreasing, then you can state that <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> are moving closer to one another, and you can say that <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> are converging towards a certain value. When they have moved so close that they are essentially the same, then you haved solved the equation  <span class="math notranslate nohighlight">\(x = g(x)\)</span>. We note that for us to arrive at the solution to the equation, we need <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> to move ever closer to one another during our iteration process. In other wrods, our iterations needs to be <strong>Converging</strong>.</p>
<p>The outcome undesired is when it is <strong>Diverging</strong>. Since we know that to arrive at our solution, we need the <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> are moving closer to one another, so that eventually they could be the same, and satisfy the statement that <span class="math notranslate nohighlight">\(x = g(x)\)</span>, if <span class="math notranslate nohighlight">\(g(x)^{sth}\)</span> and <span class="math notranslate nohighlight">\(x^{sth}\)</span> are moving away from one another, a.k.a <strong>Diverging</strong>, then they would be getting further away from each other with every iteration, and thus we will never arrive at <span class="math notranslate nohighlight">\(x=g(x)\)</span></p>
<p>Let’s see an example using <span class="math notranslate nohighlight">\(x=e^{-x}\)</span></p>
<p><span style="color:red"> The superscript here does not always mean raising something to a certain power as we usually mean. In mathematics, superscript is also used to note the steps of an iteration. The first step would be 0 (remember: Python index starts from 0), and the next step would be 1 etc. Yeah, this is kinda confusing, but maybe you’ll get used to it?</span></p>
<p>So Picard’s iteration had the form of</p>
<div class="math notranslate nohighlight">
\[x = g(x)\]</div>
<p>Since the equation we are trying to solve this <span class="math notranslate nohighlight">\(x = e^{-x}\)</span>, comparing the two, I can state that the <span class="math notranslate nohighlight">\(g(x)\)</span> for this case is:</p>
<div class="math notranslate nohighlight">
\[g(x)=e^{-x}\]</div>
<p><strong>Step 1:</strong></p>
<p>Let’s start with an initial guess, that <span class="math notranslate nohighlight">\(x = 1\)</span>, and thus we would write that <span class="math notranslate nohighlight">\(x\)</span> at our first step would be <span class="math notranslate nohighlight">\(1\)</span>.</p>
<div class="math notranslate nohighlight">
\[x^0 = 1\]</div>
<p>I know that <span class="math notranslate nohighlight">\(g(x) = e^{-x}\)</span>. Since <span class="math notranslate nohighlight">\(x^0 = 1\)</span>, I know that my corresponding <span class="math notranslate nohighlight">\(g(x)^0 = e^{-1} = 0.36788\)</span></p>
<p>Since my <span class="math notranslate nohighlight">\(x^0 = 1\)</span> and my <span class="math notranslate nohighlight">\(g(x)^0 = 0.36788\)</span>, I see that <span class="math notranslate nohighlight">\(x^0 \neq g(x)^0\)</span>. <span class ="irony">Gasp, my initial guess was wrong. How dreadful!</span></p>
<p>I note down that the difference between <span class="math notranslate nohighlight">\(x^0\)</span> and <span class="math notranslate nohighlight">\(g(x)^0\)</span> is 0.63212, so I write that</p>
<div class="math notranslate nohighlight">
\[d^0 = 0.63212\]</div>
<p>To summarize, I have obtained the following from this Step 1:</p>
<div class="math notranslate nohighlight">
\[x^0 = 1\]</div>
<div class="math notranslate nohighlight">
\[g(x)^0 = 0.36788\]</div>
<div class="math notranslate nohighlight">
\[d^0 = 0.63212\]</div>
<p><strong>Step 2:</strong></p>
<p>We could try to guess again, and maybe this time, our guess will be better, or maybe not. Picard Iteration basically tells you to take the <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step and replace <span class="math notranslate nohighlight">\(x\)</span> in the new step with this value, and then find a new <span class="math notranslate nohighlight">\(g(x)\)</span>.</p>
<p>From my previous step, so step 1, I have</p>
<div class="math notranslate nohighlight">
\[x^0 = 1\]</div>
<div class="math notranslate nohighlight">
\[g(x)^0 = 0.36788\]</div>
<div class="math notranslate nohighlight">
\[d^0 = 0.63212\]</div>
<p>Picard Iteration basically tells you to take the <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step and replace <span class="math notranslate nohighlight">\(x\)</span> in the new step with this value, and then find a new <span class="math notranslate nohighlight">\(g(x)\)</span>.</p>
<p>The step previous to step 2 is step 1.</p>
<p>The <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step, so step 1, is</p>
<div class="math notranslate nohighlight">
\[g(x)^0 = 0.36788\]</div>
<p>Picard Iteration basically tells you to take the <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step and replace <span class="math notranslate nohighlight">\(x\)</span> in the new step with this value. The <span class="math notranslate nohighlight">\(x\)</span> in the new step, so step 2, is <span class="math notranslate nohighlight">\(x^1\)</span>. The value of <span class="math notranslate nohighlight">\(g(x)\)</span> in the previous step is <span class="math notranslate nohighlight">\(g(x)^0 = 0.36788\)</span>, thus I will write that</p>
<div class="math notranslate nohighlight">
\[x^1 = 0.36788\]</div>
<p>Picard iteration then tell me to find a new <span class="math notranslate nohighlight">\(g(x)\)</span> using <span class="math notranslate nohighlight">\(x\)</span> in the new step. The new step is step 2, and the <span class="math notranslate nohighlight">\(x\)</span> in step 2 is <span class="math notranslate nohighlight">\(x^1 = 0.36788\)</span></p>
<p>Thus I obtain the new <span class="math notranslate nohighlight">\(g(x)\)</span> called <span class="math notranslate nohighlight">\(g(x)^1\)</span> as</p>
<div class="math notranslate nohighlight">
\[g(x)^1 = e^{-x^1} = e^{-0.36788} = 0.69220\]</div>
<p>Since my <span class="math notranslate nohighlight">\(x^1 = 0.36788\)</span> and my <span class="math notranslate nohighlight">\(g(x)^1 = 0.69220\)</span>, I see that <span class="math notranslate nohighlight">\(x^1 \neq g(x)^1\)</span>.</p>
<p>I note down that the difference between <span class="math notranslate nohighlight">\(x^1\)</span> and <span class="math notranslate nohighlight">\(g(x)^1\)</span> is 0.32432, so I write that</p>
<div class="math notranslate nohighlight">
\[d^1 = 0.32432\]</div>
<p>At this point, it is important to see whether your iteration is <strong>converging or diverging</strong>. It is only worthwhile, for the equation we are solving, to continue doing the iterative process if the iteration is <strong>converging</strong>. To see if it is converging, we compare the difference we found at <strong>Step 1</strong> and the difference we found at <strong>Step 2</strong>.</p>
<div class="math notranslate nohighlight">
\[d^0 = 0.63212\]</div>
<div class="math notranslate nohighlight">
\[d^1 = 0.32432\]</div>
<p>I observe that the difference we found at <strong>Step 2</strong> is smaller than the we found at <strong>Step 1</strong>, i.e. <span class="math notranslate nohighlight">\(d_1 &lt; d_0\)</span>, thus, I can say, at least from <strong>Step 1</strong> to <strong>Step 2</strong>, the difference is decreasing, so the iteration is <strong>converging</strong>. Converging is good.</p>
<p>Concluding</p>
<div class="math notranslate nohighlight">
\[x^1 = 0.36788\]</div>
<div class="math notranslate nohighlight">
\[g(x)^1 = 0.69220\]</div>
<div class="math notranslate nohighlight">
\[d^1 = 0.32432\]</div>
<p><strong>Step 3:</strong></p>
<p>This is basic doing <strong>Step 2</strong> all over again. You could skip this if you wish.</p>
<p>From my previous step, so step 2, I have</p>
<div class="math notranslate nohighlight">
\[x^1 = 0.36788\]</div>
<div class="math notranslate nohighlight">
\[g(x)^1 = 0.69220\]</div>
<div class="math notranslate nohighlight">
\[d^1 = 0.32432\]</div>
<p>Picard Iteration basically tells you to take the <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step and replace <span class="math notranslate nohighlight">\(x\)</span> in the new step with this value, and then find a new <span class="math notranslate nohighlight">\(g(x)\)</span>.</p>
<p>The step previous to step 3 is step 2.</p>
<p>The <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step, so step 2, is</p>
<div class="math notranslate nohighlight">
\[g(x)^1 = 0.69220\]</div>
<p>Picard Iteration basically tells you to take the <span class="math notranslate nohighlight">\(g(x)\)</span> that you have found in the previous step and replace <span class="math notranslate nohighlight">\(x\)</span> in the new step with this value. The <span class="math notranslate nohighlight">\(x\)</span> in the new step, so step 3, is <span class="math notranslate nohighlight">\(x^2\)</span>. The value of <span class="math notranslate nohighlight">\(g(x)\)</span> in the previous step is <span class="math notranslate nohighlight">\(g(x)^1 = 0.69220\)</span>, thus I will write that</p>
<div class="math notranslate nohighlight">
\[x^2 = 0.69220\]</div>
<p>Picard iteration then tell me to find a new <span class="math notranslate nohighlight">\(g(x)\)</span> using <span class="math notranslate nohighlight">\(x\)</span> in the new step. The new step is step 3, and the <span class="math notranslate nohighlight">\(x\)</span> in step 3 is <span class="math notranslate nohighlight">\(x^2 = 0.69220\)</span></p>
<p>Thus I obtain the new <span class="math notranslate nohighlight">\(g(x)\)</span> called <span class="math notranslate nohighlight">\(g(x)^2\)</span> as</p>
<div class="math notranslate nohighlight">
\[g(x)^1 = e^{-x^2} = e^{-0.69220} = 0.50047\]</div>
<p>Since my <span class="math notranslate nohighlight">\(x^2 = 0.69220\)</span> and my <span class="math notranslate nohighlight">\(g(x)^2 = 0.50047\)</span>, I see that <span class="math notranslate nohighlight">\(x^2 \neq g(x)^2\)</span>.</p>
<p>I note down that the difference between <span class="math notranslate nohighlight">\(x^1\)</span> and <span class="math notranslate nohighlight">\(g(x)^1\)</span> is 0.32432, so I write that</p>
<div class="math notranslate nohighlight">
\[d^2 = 0.19173\]</div>
<p>At this point, it is important to see whether your iteration is <strong>converging or diverging</strong>. It is only worthwhile, for the equation we are solving, to continue doing the iterative process if the iteration is <strong>converging</strong>. To see if it is converging, we compare the difference we found at <strong>Step 2</strong> and the difference we found at <strong>Step 3</strong>.</p>
<div class="math notranslate nohighlight">
\[d^1 = 0.32432\]</div>
<div class="math notranslate nohighlight">
\[d^2 = 0.19173\]</div>
<p>I observe that the difference we found at <strong>Step 3</strong> is smaller than the we found at <strong>Step 2</strong>, i.e. <span class="math notranslate nohighlight">\(d_2 &lt; d_1\)</span>, thus, I can say, at least from <strong>Step 3</strong> to <strong>Step 2</strong>, the difference is decreasing, so the iteration is <strong>converging</strong>. Converging is good.</p>
<p>And so on and so forth. The cells below will show you the further steps of the iteration process.</p>
<p><span style="color:red">Note that, while we did some steps here, and we found that up until these steps, our iteration was converging, this does not neccesary mean that it will keep on converging in future steps. While for our case it does keep on converging for the next steps, it is not neccesary. Indeed, the only way you could know if it would keep on converging is through rigorous mathematical proof and you could always ask your lecturers for your mathematics modules to give you an introduction into this. However, note that, there is no universal way applicable to all iterative methods to prove that they will converge as their step number continues to increase. There has been many cases in history where the iterative method converged for the first tens of hundreds of steps, thus creating the illusion that it will keep on converging till infinity, when suddently at the thousandth term it starts diverging. Some have even weirder behaviour where it converges for a while, then diverges for another while, and cycles, regularly or irregularly in between, and possibly having a general converging pattern or a general diverging pattern, or maybe you’re just seeing patterns when there are actually none. Indeed, whether something converges or diverges is still a very active area of research in mathematics, and there are sometimes some nice prizes for anyone who can provide rigorous mathematical proof that something converges or diverges. </span></p>
</div>
<div class="section" id="span-style-color-blue-exercise-4-1-span">
<h2><span style="color:blue">Exercise 4.1: </span><a class="headerlink" href="#span-style-color-blue-exercise-4-1-span" title="Permalink to this headline">¶</a></h2>
<p>Complete the implementation of the method of successive approximations below to solve <span class="math notranslate nohighlight">\(x=\mathrm{e}^{-x}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">picard</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function implementing Picard&#39;s method.</span>
<span class="sd">    </span>
<span class="sd">    f here is the function g(.) described in the lecture and we are solving x = g(x).</span>
<span class="sd">    </span>
<span class="sd">    x is an initial guess.</span>
<span class="sd">    </span>
<span class="sd">    atol is a user-defined (absolute) error tolerance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># record number of function evaluations so we can later compare methods</span>
    <span class="n">fevals</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># initialise the previous x simply so that while loop argument is initially true</span>
    <span class="n">x_prev</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">atol</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_prev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">atol</span><span class="p">:</span>
        <span class="n">x_prev</span> <span class="o">=</span> <span class="n">x</span>
        
        
        <span class="c1"># ONE LINE OF MISSING CODE HERE</span>
        
        
        <span class="n">fevals</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current iteration solution: &#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Picard used&#39;</span><span class="p">,</span> <span class="n">fevals</span><span class="p">,</span> <span class="s1">&#39;function evaluations&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>



<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Solution from Picard: &#39;</span><span class="p">,</span> <span class="n">picard</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">))</span>  <span class="c1"># 0.9 is our initial guess</span>


<span class="c1"># let&#39;s check our answer against a SciPy function: sop.newton.</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check this against the solution from SciPy: sop.newton(f, 0.9)=&#39;</span><span class="p">,</span> <span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>

<span class="c1"># NB. if we tighten up the atol toelrance in our call to picard the answer gets closer to SciPy </span>
<span class="c1"># but of course takes more iterations.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Current iteration solution:  0.9

Picard used 1 function evaluations

Solution from Picard:  0.9

Check this against the solution from SciPy: sop.newton(f, 0.9)= 0.5671432904097843
</pre></div>
</div>
</div>
</div>
<p>To get a better idea of what is going on here let’s look at the progression of the intermediate results <span class="math notranslate nohighlight">\(\,x^{(k+1)}\,\)</span> from <span class="math notranslate nohighlight">\(\,x^{(k+1)} = g\left(x^{(k)}\right)\,\)</span>, and plot them on top of the curve <span class="math notranslate nohighlight">\(y = \mathrm{e}^{-x}\)</span>.</p>
<p>NB. I include the plotting code here for completeness, but you can ignore the details if you’re not interested.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_picard_convergence</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">max_labels</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-4</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function to demonstrate/plot the Picard algorithm and its convergence</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># variables to store solution iterations for plotting purposes</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># the following is identical to our iteration above, apart from storing iterations</span>
    <span class="n">x_prev</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">atol</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_prev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">atol</span><span class="p">:</span>
        <span class="n">x_prev</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_prev</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_</span><span class="si">{0:0&gt;2d}</span><span class="s1"> = </span><span class="si">{1:7.5f}</span><span class="s1">.   g(x_</span><span class="si">{0:0&gt;2d}</span><span class="s1">) = </span><span class="si">{2:7.5f}</span><span class="s1">.   |x_</span><span class="si">{0:0&gt;2d}</span><span class="s1"> - g(x_</span><span class="si">{0:0&gt;2d}</span><span class="s1">)| = </span><span class="si">{3:7.5f}</span><span class="s1">&#39;</span><span class="o">.</span>
              <span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_prev</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_prev</span><span class="p">)</span>
        <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># as x = g(x_prev) at this point we can store this</span>

    <span class="c1"># plot the iteration results</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="c1"># plot the convergence pattern</span>
    <span class="n">x_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">f_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)):</span>
        <span class="n">x_pattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">f_pattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x_pattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">f_pattern</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pattern</span><span class="p">,</span> <span class="n">f_pattern</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">)</span>

    <span class="c1"># plot the function over the x values considered</span>
    <span class="n">idx_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xs</span><span class="p">)[</span><span class="n">idx_sort</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fs</span><span class="p">)[</span><span class="n">idx_sort</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

    <span class="c1"># add some labels</span>
    <span class="c1"># figure out a reasonable offset for labels</span>
    <span class="n">dxt</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_pattern</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_pattern</span><span class="p">))</span><span class="o">/</span><span class="mf">50.</span>
    <span class="n">dyt</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f_pattern</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f_pattern</span><span class="p">))</span><span class="o">/</span><span class="mf">50.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dxt</span><span class="p">,</span> <span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dyt</span><span class="p">,</span> <span class="s1">&#39;$x_0$&#39;</span><span class="p">)</span>
    <span class="c1"># only plot a maximum of max_labels labels, so plot doesn&#39;t get too messy</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_labels</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;$x_{&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;}$&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">dxt</span><span class="p">,</span> <span class="n">fs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">dyt</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flabel</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="s1">&#39;$f(x)$&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">flabel</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Successive Approximations&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># set up a figure for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="c1"># set an initial guess - you can try different values for x_guess</span>
<span class="n">x_guess</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1"># call our plotting function with above choice of function g(.), use the default stopping criterion</span>
<span class="n">plot_picard_convergence</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x_guess</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$g(x) = \exp(-x)$&#39;</span><span class="p">)</span>

<span class="c1"># add a y=x line without extending the axes limits</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>x_00 = 1.00000.   g(x_00) = 0.36788.   |x_00 - g(x_00)| = 0.63212
x_01 = 0.36788.   g(x_01) = 0.69220.   |x_01 - g(x_01)| = 0.32432
x_02 = 0.69220.   g(x_02) = 0.50047.   |x_02 - g(x_02)| = 0.19173
x_03 = 0.50047.   g(x_03) = 0.60624.   |x_03 - g(x_03)| = 0.10577
x_04 = 0.60624.   g(x_04) = 0.54540.   |x_04 - g(x_04)| = 0.06085
x_05 = 0.54540.   g(x_05) = 0.57961.   |x_05 - g(x_05)| = 0.03422
x_06 = 0.57961.   g(x_06) = 0.56012.   |x_06 - g(x_06)| = 0.01950
x_07 = 0.56012.   g(x_07) = 0.57114.   |x_07 - g(x_07)| = 0.01103
x_08 = 0.57114.   g(x_08) = 0.56488.   |x_08 - g(x_08)| = 0.00626
x_09 = 0.56488.   g(x_09) = 0.56843.   |x_09 - g(x_09)| = 0.00355
x_10 = 0.56843.   g(x_10) = 0.56641.   |x_10 - g(x_10)| = 0.00201
x_11 = 0.56641.   g(x_11) = 0.56756.   |x_11 - g(x_11)| = 0.00114
x_12 = 0.56756.   g(x_12) = 0.56691.   |x_12 - g(x_12)| = 0.00065
x_13 = 0.56691.   g(x_13) = 0.56728.   |x_13 - g(x_13)| = 0.00037
x_14 = 0.56728.   g(x_14) = 0.56707.   |x_14 - g(x_14)| = 0.00021
x_15 = 0.56707.   g(x_15) = 0.56719.   |x_15 - g(x_15)| = 0.00012
x_16 = 0.56719.   g(x_16) = 0.56712.   |x_16 - g(x_16)| = 0.00007
</pre></div>
</div>
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x124a9b80&gt;]
</pre></div>
</div>
<img alt="../../../_images/NM1_2020_lecture4_17_2.png" src="../../../_images/NM1_2020_lecture4_17_2.png" />
</div>
</div>
<p>Recall that we introduced this so-called <a class="reference external" href="https://en.wikipedia.org/wiki/Cobweb_plot">“cobweb plot”</a> in ACSE-2.</p>
<ul class="simple">
<li><p>We start from <span class="math notranslate nohighlight">\(x^{(0)}=1.0\)</span> - shown as <span class="math notranslate nohighlight">\(x_0\)</span> in the plot.</p></li>
<li><p>We evaluate <span class="math notranslate nohighlight">\(g(x^{(0)}) = 0.36788...\)</span>. The red cross marked as <span class="math notranslate nohighlight">\(x_0\)</span> is plotted at the location <span class="math notranslate nohighlight">\((x^{(0)},g(x^{(0)}))\)</span>.</p></li>
<li><p>We set our new iteration value, <span class="math notranslate nohighlight">\(x^{(1)}\)</span>, to this ‘<span class="math notranslate nohighlight">\(y\)</span>’ value (i.e. <span class="math notranslate nohighlight">\(0.36788...\)</span>) - the lowest green dashed horizontal  line takes us from <span class="math notranslate nohighlight">\(x^{(0)}\)</span> to this new <span class="math notranslate nohighlight">\(x^{(1)}\)</span> - we jump horizontally to the <span class="math notranslate nohighlight">\(y=x\)</span> line given by the black dashed line.</p></li>
<li><p>We then evaluate <span class="math notranslate nohighlight">\(g(x^{(1)}) = 0.69220...\)</span> - the left most vertical green dashed line takes us to this value on the <span class="math notranslate nohighlight">\(y\)</span> axis where the second red cross marked with <span class="math notranslate nohighlight">\(x_1\)</span> is plotted at the location <span class="math notranslate nohighlight">\((x^{(1)},g(x^{(1)})\)</span>.</p></li>
<li><p>We set our new <span class="math notranslate nohighlight">\(x\)</span> value to this (0.69220), and this is indicated by the top most horizontal green dashed line taking us back to the <span class="math notranslate nohighlight">\(y=x\)</span> black dashed line.</p></li>
<li><p>Evaluate <span class="math notranslate nohighlight">\(g\)</span> of this value giving us 0.50047, this is our next vertical line</p></li>
<li><p>and so on, converging to our fixed point</p></li>
</ul>
<p>This plot shows that our algorithm <em>converges</em> to the point where <span class="math notranslate nohighlight">\(x = g(x)\)</span>, which in our case is <span class="math notranslate nohighlight">\(x = \mathrm{e}^{-x}\)</span>.</p>
<p>For this example this is the point where both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(g(x)\)</span> equal ~0.57.</p>
<p>It should be obvious that this method is iterative in nature and that the solution can be expected to be an approximation accurate to a tolerance of <span class="math notranslate nohighlight">\(e \leq\)</span> <code class="docutils literal notranslate"><span class="pre">atol</span></code>.</p>
<p>As we said at the start of this lecture, another way to visualise this is to plot the functions <span class="math notranslate nohighlight">\(y = x\)</span> and <span class="math notranslate nohighlight">\(y = \mathrm{e}^{-x}\)</span> in <span class="math notranslate nohighlight">\((x,y)\)</span> space and find the intersection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$y(x) = g(x) = \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y(x)=x$&#39;</span><span class="p">)</span>
<span class="c1"># our solution from Picard above: 0.5671430835570621</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">0.5671430835570621</span><span class="p">,</span> <span class="mf">0.5671430835570621</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fixed point as the intersection of two curves&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Fixed point as the intersection of two curves&#39;)
</pre></div>
</div>
<img alt="../../../_images/NM1_2020_lecture4_21_1.png" src="../../../_images/NM1_2020_lecture4_21_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h1>III. Roots of equations<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h1>
<p>This graphical method shows the intersection point, <span class="math notranslate nohighlight">\(x = \mathrm{e}^{-x}\)</span>, also at ~0.57.</p>
<p>This value is also termed a <em>root</em> of a closely related problem, as it satisfies</p>
<div class="math notranslate nohighlight">
\[ 0 = f(x) := x - \mathrm{e}^{-x}. \]</div>
<p>[So a “fixed point” can always be defined as a “root” of a related problem, but the opposite is not strictly speaking true. However, we will see below how it is possible to update the problem of finding a “root” to finding a “fixed point”, and hence reapply this sort of fixed point iteration approach to this more general problem].</p>
<p>In this expression we rearranged <span class="math notranslate nohighlight">\(\,x = \mathrm{e}^{-x}\,\)</span> to <span class="math notranslate nohighlight">\(\,0 = x - \mathrm{e}^{-x}\,\)</span> and defined <span class="math notranslate nohighlight">\(\,f(x) := x - \mathrm{e}^{-x}\)</span>.</p>
<p>Thus, another solution strategy is to find a value <span class="math notranslate nohighlight">\(x^*\)</span> such that <span class="math notranslate nohighlight">\(f(x^*) = 0\)</span>, or, in our case, <span class="math notranslate nohighlight">\(x^* - \mathrm{e}^{-x^*} = 0\)</span>.</p>
<p>We can of course plot a similar intersection figure for this modified problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y(x) = f(x) = x - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
<span class="c1"># add a zero line extending across axes</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y(x)=0$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">0.5671</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fixed point as a root of $f(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_24_0.png" src="../../../_images/NM1_2020_lecture4_24_0.png" />
</div>
</div>
</div>
<div class="section" id="iv-subintervals-and-initial-guesses">
<h1>IV.   Subintervals and initial guesses<a class="headerlink" href="#iv-subintervals-and-initial-guesses" title="Permalink to this headline">¶</a></h1>
<p>As we have seen from the iterative method above, having a good initial guess is helpful when iterating for a solution to an equation. If you have made an initial guess that is very close to the solution, then it would take much fewer steps to get to the solution, while if you have made an initial guess that is very far from the solution, then it would take many more steps to get to the solution.</p>
<p>We also should seek to improve upon our iterative methods. We will introduce you to some of the most common solution seeking iterative methods below. Many of these methods share many similarities and have certain differences. In particular, we are interested in the number of steps taken to reach the solution for each method of seeking the solution. If a solution is reached quickly, the computer can spend less time finding the solution. While this may seem trivial when we are doing scalar equations, it would become important when trying to solve equations involving large and complicated matrixes. The fewer number of steps also means there is a much smaller chance that the program will catastrophically fail when trying to reach the solution. You will know the frustration when you are running numerical simulations lasting several hours only for the computer to catastrophically fail in the middle of it, and having to run it again, when the sun is already rising from the horizon.</p>
<p>The graph shows the root of <span class="math notranslate nohighlight">\(f(x)\)</span> at our solution <span class="math notranslate nohighlight">\(x^* \approx 0.57\)</span>. By visual inspection, we see that <span class="math notranslate nohighlight">\(f(x)\)</span> has a root <span class="math notranslate nohighlight">\(f(x^*) = 0\)</span> in the interval <span class="math notranslate nohighlight">\(x^* \in (-1,1)\)</span>.</p>
<div class="section" id="span-style-color-blue-exercise-4-2-span">
<h2><span style="color:blue">Exercise 4.2:</span><a class="headerlink" href="#span-style-color-blue-exercise-4-2-span" title="Permalink to this headline">¶</a></h2>
<p>Let’s consider an example:</p>
<div class="math notranslate nohighlight">
\[2\,x + x \, \sin(x-3) = 5\;\;\;\; \text{for}\;\;\;\; x \in (-10,10).\]</div>
<p>By means of visual inspection (i.e. do some plotting) find a subinterval <span class="math notranslate nohighlight">\((a,b)\)</span> such that</p>
<ol class="simple">
<li><p>there exists an <span class="math notranslate nohighlight">\(x^* \in (a,b)\)</span> such that <span class="math notranslate nohighlight">\(f(x^*) = 0\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(f(x)\)</span> is <a class="reference external" href="https://en.wikipedia.org/wiki/Monotonic_function">monotonic</a>.</p></li>
</ol>
<p>Where we define <span class="math notranslate nohighlight">\(f\)</span> such that the solution to the above equation is a root - i.e. move all the terms on to one side and set equal to zero. Below we make the choice to define <span class="math notranslate nohighlight">\(f\)</span> as <span class="math notranslate nohighlight">\(f(x) = 2\,x + x \, \sin(x-3) - 5\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># for this problem we can define f as 5 - (2*x + x*np.sin(x-3)), or (2*x + x*np.sin(x-3)) - 5.</span>
<span class="c1"># it makes no difference to the root-finding, just the plots</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">..............</span>

<span class="c1"># plot the function over the whole interval being considered</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># now plot the function over a smaller interval</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">.....</span> <span class="p">,</span><span class="o">.....</span> <span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-15-4bd9b984d5c9&gt;&quot;</span><span class="gt">, line </span><span class="mi">4</span>
    <span class="k">return</span> <span class="o">..............</span>
              <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
<p>You should find that in <span class="math notranslate nohighlight">\((0,5)\)</span>, i.e. an interval with upper and lower bounds <span class="math notranslate nohighlight">\(a\)</span> = 0 and <span class="math notranslate nohighlight">\(b\)</span> = 5, there exists a root, and also the function is monotonically increasing over this interval - we have excluded any local maxima or minima that we see do occur in the function outside this restricted interval.</p>
<p>[Note the caveat that in general we will assume the evaluation of <span class="math notranslate nohighlight">\(\,f\)</span> (or <span class="math notranslate nohighlight">\(g\)</span>) is expensive and so we want to do this as few times as possible - generating a nice high resolution plot like this is not something we will be able to do in general].</p>
<p>We can make use of this knowledge to help us identify a good starting guess for the root.</p>
</div>
</div>
<div class="section" id="id3">
<h1>V.    Root bracketing<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<p>Where the root lies can be important.</p>
<p>By visual inspection we can identify if roots exist for a function, and narrow down the interval in which a root can be found.</p>
<p>For the equation</p>
<div class="math notranslate nohighlight">
\[f(x) := x - \text{e}^{-x},\]</div>
<p>we have shown by plotting (above in two images, see also below, where we noted a root around <span class="math notranslate nohighlight">\(x\approx ~0.57\)</span>) that a root is bounded in <span class="math notranslate nohighlight">\((-1,1)\)</span>, and that <span class="math notranslate nohighlight">\(f(x)\)</span> is monotonically increasing over this interval.</p>
<p>With this in mind, we can define a <a class="reference external" href="https://en.wikipedia.org/wiki/Root-finding_algorithm#Bracketing_methods"><em>root bracketing algorithm</em></a> that marches along <span class="math notranslate nohighlight">\(f(x)\)</span> in increments of <span class="math notranslate nohighlight">\(\Delta x\)</span> and identifies a new, tighter (i.e. smaller) bracket around the root by detecting a <em>change in sign of <span class="math notranslate nohighlight">\(f(x)\)</span></em>.</p>
<p>This algorithm is also referred to as <em>incremental search</em>.</p>
<p>Basically, it is important to know where the root is to sovle the equation. Of course, if we would have known exactly where the root was, then there would be no need for iterative method. However, we could maybe try to narrow down the location where the root lies.</p>
<p>Your seismology courses would teach you that to find the location of an earthquake, you will use multiple seismometers, and each will give a measurement of the distance from the seismometer to the earthquake location by using arrival times and P wave velocity. Each seismometer will give you a circle. Combining two seismometer narrows down the area, and three seismometers would give you the location of the earthquake. However, because earthquakes are very complex (we are not talking about massive earthquakes where an entire zone just rips apart since the earthquake center is more like a belt rather than a point for earthquakes of this scale), you will use way more than just 3 seismometers to locate your earthquake, and each additional seismometer will improve your confidence of where is the center of the earthquake.</p>
<p>Similarly, we could try to narrow down the area where our root is located. You will use multiple iterations to find the location of your root, and each iteration will improve upon the previous iteration to narrow down where the root is located. We call this root bracketing, since we are trying to find the location of the root by narrowing down the area where the root could be, but also incremental search, since each iteration is based on the previous iteration, and incrementally improves our search for the root.</p>
<p>For our root bracketing algorithm, we will start with a wide area, and check if there is a root located in that area. If there is a root, then we will break this area we found into smaller subintervals, and then try to find if there is root in them. If we find a root in a subinterval, then we would break this subinterval into even smaller pieces, i.e. subintervals of subinterval, and try to find a root in it. If we don’t find a root in a subinterval, or subinterval of subinterval, or subinterval of subinterval of subinterval (you get the idea :)), then we just ignore it, and only work with subintervals which have root in them.</p>
<p>The approach can be visualised as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_root_bracketing</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xbounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">),</span> <span class="n">ybounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1"># plot the sub-intervals in blue</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># plot the sub-interval where the sign changes in red</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;ro-&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flabel</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="s1">&#39;$f(x)$&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">flabel</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Root bracketing</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;(red indicates the bracket containing the root)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    
<span class="n">lower_bound</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">plot_root_bracketing</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = x - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_30_0.png" src="../../../_images/NM1_2020_lecture4_30_0.png" />
</div>
</div>
<div class="section" id="span-style-color-blue-exercise-4-3-span">
<h2><span style="color:blue">Exercise 4.3: </span><a class="headerlink" href="#span-style-color-blue-exercise-4-3-span" title="Permalink to this headline">¶</a></h2>
<p>For <span class="math notranslate nohighlight">\(2x + x \mathrm{sin}(x-3) = 5\)</span>, use the subinterval <span class="math notranslate nohighlight">\(x \in(a,b)\)</span> you found in Exercise 4.2 and complete the code below to implement a function for the root bracketing algorithm. Derive the concept from the Figure above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>


<span class="k">def</span> <span class="nf">root_bracketing</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function to perform root bracketing on the function f(.)</span>
<span class="sd">    between a and b, with fixed interval size dx.</span>
<span class="sd">    Returns the bracket of size dx that contains the root.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="c1"># The sign function returns:  -1 if x &lt; 0;  0 if x==0;  1 if x &gt; 0.</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="k">while</span> <span class="o">...</span>
        <span class="o">.....</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>


<span class="n">a</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">5.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="c1"># print out the output from our root_bracketing function</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bracket = &#39;</span><span class="p">,</span> <span class="n">root_bracketing</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dx</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-17-bbc1b21e490b&gt;&quot;</span><span class="gt">, line </span><span class="mi">12</span>
    <span class="k">while</span> <span class="o">...</span>
             <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h1>VI.    Bisection method<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h1>
<p>Once we know that a root can be found in <span class="math notranslate nohighlight">\(x \in (a,b)\)</span>, we can close in on it with an algorithm similar to root-bracketing/incremental search described above, but with a smart switch to gradually <em>decrease</em> <span class="math notranslate nohighlight">\(\Delta x\)</span> <em>by a factor</em> of 1/2, and <em>change the marching direction</em> depending on the sign of <span class="math notranslate nohighlight">\(f(x_1)f(x_2)\)</span>, where <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>  are the local bounds considered during the marching process.</p>
<p>The algorithm works as follows:</p>
<ul class="simple">
<li><p>If there is a root in the interval <span class="math notranslate nohighlight">\([x_1, x_2]\)</span>, then <span class="math notranslate nohighlight">\(f(x_1)f(x_2) &lt; 0\)</span> (as <span class="math notranslate nohighlight">\(f(x_1)\)</span> and <span class="math notranslate nohighlight">\(f(x_2)\)</span> will be of different signs)</p></li>
<li><p>In order to halve the interval, we compute <span class="math notranslate nohighlight">\(f(x_3)\)</span>, where <span class="math notranslate nohighlight">\(x_3 := (x_1 + x_2)/2\)</span> is the midpoint of the current interval.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(f(x_2)f(x_3) &lt; 0\)</span>, then the root must be in <span class="math notranslate nohighlight">\([x_2, x_3]\)</span>, and we record this by replacing the original bound <span class="math notranslate nohighlight">\(x_1\)</span> by <span class="math notranslate nohighlight">\(x_3\)</span>,</p></li>
<li><p>otherwise, the root must lie in <span class="math notranslate nohighlight">\([x_1, x_3]\)</span>, in which case <span class="math notranslate nohighlight">\(x_2\)</span> is replaced by <span class="math notranslate nohighlight">\(x_3\)</span>.</p></li>
<li><p>In either case, the new updated interval <span class="math notranslate nohighlight">\([x_1, x_2]\)</span> is half the size of the original interval.</p></li>
<li><p>The bisection is repeated until the interval has been reduced to some user-defined convergence tolerance.</p></li>
</ul>
<p>Ok, so what you do during the bisection method is simple, and should have probably been covered in A Level Maths.</p>
<p>Nevertheless, let’s start with our equation, and we note that it is important that we move our equation in such a way that there is a 0 on either the left hand side or the right hand side of the equation.</p>
<p>For example, if our equation was say given in the form of:</p>
<div class="math notranslate nohighlight">
\[x = sin(x)\]</div>
<p>Then it is important that we change our equation to be:</p>
<div class="math notranslate nohighlight">
\[x-sin(x) = 0\]</div>
<p>And then we could define a function such that:</p>
<div class="math notranslate nohighlight">
\[f(x) = x - sin(x)\]</div>
<p>Since we are seeking to find <span class="math notranslate nohighlight">\(x\)</span> when the statement <span class="math notranslate nohighlight">\(x = sin(x)\)</span> is true, then this is equivalent to finding <span class="math notranslate nohighlight">\(x\)</span> when <span class="math notranslate nohighlight">\(f(x) = 0\)</span> is true. Thus we can say that by finding the <span class="math notranslate nohighlight">\(x\)</span> when <span class="math notranslate nohighlight">\(f(x)=0\)</span> is True, we will also find the <span class="math notranslate nohighlight">\(x\)</span> when <span class="math notranslate nohighlight">\(x = sin(x) is True\)</span></p>
<p>If we assume that our function is monotonic around when <span class="math notranslate nohighlight">\(f(x)=0\)</span>, so the function is only increasing or decreasing, then</p>
<p>if the function was increasing from left to right, then to the left of <span class="math notranslate nohighlight">\(f(x)=0\)</span>, we will have the function <span class="math notranslate nohighlight">\(f(value\;\; immediately\;\; left\;\; of\;\; x)&lt;0\)</span>, and to the right, we will have function <span class="math notranslate nohighlight">\(f(value \;\; immediately\;\; right\;\; of\;\; x)&gt;0\)</span></p>
<p>if the function was decreasing from left to right, then to the left of <span class="math notranslate nohighlight">\(f(x)=0\)</span>, we will have the function <span class="math notranslate nohighlight">\(f(value\;\; immediately\;\; left\;\; of\;\; x)&gt;0\)</span>, and to the right, we will have function <span class="math notranslate nohighlight">\(f(value \;\; immediately\;\; right\;\; of\;\; x)&lt;0\)</span></p>
<p>Below I have quickly made two graphs for two monotonic function to illustrate what I said.</p>
<p>Since the left and right have opposite signs, then multiplying their values together would give a negative number, since positive * negative = negative.</p>
<p>Now, let’s say that we already have let’s say an idea in our minds where our root might be, and we know that its between the intervals <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>.</p>
<p>Then let’s divide the interval into 2 equal subintervals, thus we are bisecting the interval. The midpoint of the interval will be called <span class="math notranslate nohighlight">\(x_3\)</span> and is defined as <span class="math notranslate nohighlight">\(x_3 = (x_1+x_2)/2\)</span>. Thus, we have <span class="math notranslate nohighlight">\(x_1&lt;x_3&lt;x_2\)</span></p>
<p>For each subinterval, we try to find if there is a root inside.</p>
<p>For the subinterval from <span class="math notranslate nohighlight">\(x_1\)</span> to <span class="math notranslate nohighlight">\(x_3\)</span>, to know if there is a root inside, we will find the product of <span class="math notranslate nohighlight">\(f(x_1)\)</span> and <span class="math notranslate nohighlight">\(f(x_3)\)</span> and see if the product is positive or negative. We know that if there is a root, then the product will be negative, while if there is not a root, then the product will be positive.</p>
<p>For the subinterval from <span class="math notranslate nohighlight">\(x_3\)</span> to <span class="math notranslate nohighlight">\(x_2\)</span>, to know if there is a root inside, we will find the product of <span class="math notranslate nohighlight">\(f(x_3)\)</span> and <span class="math notranslate nohighlight">\(f(x_2)\)</span> and see if the product is positive or negative. We know that if there is a root, then the product will be negative, while if there is not a root, then the product will be positive.</p>
<p>If a subinterval has root inside, we will continue searching in that subinerval; else, we will ignore that subinterval.</p>
<p>For the subinterval that has root inside, we will do bisection again, and find, in the same manner as outlined before, if there is a root inside. We bisect the subinterval into two subsubintervals, and we check both subsubintervals if there is root inside.</p>
<p>Thus, we narrow down the space where the root could be, and eventually we will be able to find the location of the root.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>


<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Monotic Increase Function&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Solution Location&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>


<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Monotic Decrease Function&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Solution Location&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_36_0.png" src="../../../_images/NM1_2020_lecture4_36_0.png" />
<img alt="../../../_images/NM1_2020_lecture4_36_1.png" src="../../../_images/NM1_2020_lecture4_36_1.png" />
</div>
</div>
<p>You can find <a href="https://en.wikipedia.org/wiki/Bisection_method#Algorithm">pseudo-code here</a>.</p>
<p>A visualisation of the method illustrates the narrowing in of an ever-smaller bracket:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">zoomed_inset_axes</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">mark_inset</span>

<span class="k">def</span> <span class="nf">plot_bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.0e-2</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="c1"># start by plotting the function over the given bounds (x1, x2)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="c1"># initialise the first interval</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">x1s</span> <span class="o">=</span> <span class="n">x1</span>
    <span class="n">x2s</span> <span class="o">=</span> <span class="n">x2</span>
    <span class="c1"># plot initial interval</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="c1"># plot midpoint, and update the appropriate interval limit</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="p">[</span><span class="n">x3</span><span class="p">],</span> <span class="p">[</span><span class="n">f3</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f2</span><span class="o">*</span><span class="n">f3</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x3</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">f3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x3</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">f3</span>

    <span class="c1"># add a zero line to the plot to help identify the root</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            
    <span class="c1"># add a zoomed inset if &#39;inset=True&#39;</span>
    <span class="k">if</span> <span class="n">inset</span><span class="p">:</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">x1s</span><span class="p">,</span> <span class="n">x2s</span>
        <span class="n">ax_ins</span> <span class="o">=</span> <span class="n">zoomed_inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc0</span><span class="p">)</span>
        <span class="c1"># same code/algorithm as above</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
            <span class="n">f3</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x3</span><span class="p">)</span>
            <span class="n">ax_ins</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="p">[</span><span class="n">x3</span><span class="p">],</span> <span class="p">[</span><span class="n">f3</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f2</span><span class="o">*</span><span class="n">f3</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x3</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="n">f3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">x3</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="n">f3</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ixmin</span><span class="p">,</span><span class="n">ixmax</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ixmin</span><span class="p">,</span> <span class="n">ixmax</span><span class="p">)</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">iymin</span><span class="p">,</span> <span class="n">iymax</span><span class="p">)</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax_ins</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># draw a box of area covered in main image and lines from corners to indicate zoom</span>
        <span class="n">mark_inset</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax_ins</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">)</span>
        
    <span class="n">xf</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flabel</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="s1">&#39;$f(x)$&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">flabel</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bisection&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    

<span class="c1"># Let&#39;s see what it looks like for our example.</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plot_bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.0e-2</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
               <span class="n">ixmin</span><span class="o">=</span><span class="mf">2.6</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = 2x + x\sin(x-3) - 5$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_38_0.png" src="../../../_images/NM1_2020_lecture4_38_0.png" />
</div>
</div>
<p>This algorithm has been <a href="http://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.optimize.bisect.html#scipy.optimize.bisect">implemented</a> in the <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>0.5671432904109679
</pre></div>
</div>
</div>
</div>
<div class="section" id="span-style-color-blue-exercise-4-4-span">
<h2><span style="color:blue">Exercise 4.4: </span><a class="headerlink" href="#span-style-color-blue-exercise-4-4-span" title="Permalink to this headline">¶</a></h2>
<p>For <span class="math notranslate nohighlight">\(2x + x \mathrm{sin}(x-3) = 5\)</span>, use the subinterval <span class="math notranslate nohighlight">\(x \in(a,b)\)</span> you found in Exercise 4.2 and complete the code below to implement a bisection algorithm. Derive the concept from a <a href="https://en.wikipedia.org/wiki/Bisection_method#Algorithm">pseudo-code description</a> and compare the result to <code class="docutils literal notranslate"><span class="pre">scipy.optimize.bisect</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bisection</span><span class="p">(</span><span class="n">fct</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0E-6</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">nmax</span><span class="p">:</span>
        
        <span class="c1"># complete</span>
    
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;no root found within [a,b]&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1"># complete</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="c1"># complete</span>

<span class="nb">print</span><span class="p">(</span><span class="n">bisection</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-21-8d6759643c14&gt;&quot;</span><span class="gt">, line </span><span class="mi">7</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;no root found within [a,b]&#39;</span><span class="p">)</span>
    <span class="o">^</span>
<span class="ne">IndentationError</span>: expected an indented block
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h1>VII.    Newton Method<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h1>
<p>While the previously introduced bisection method is nice, there are other methods which take less steps to arrive at the solution, and one such method is the Newton Method. To arrive more quickly at the solution, unlike the previous bisection method that only used <span class="math notranslate nohighlight">\(f(x)\)</span>, i.e. $f(x_1), f(x_2), f(x_3), f(x_4) etc. $ depending on the number of iterative steps, Newton Method also uses derivatives of <span class="math notranslate nohighlight">\(f(x)\)</span>, such as <span class="math notranslate nohighlight">\(f'(x) and f''(x)\)</span> to infer the trend of the function in the vicinity of <span class="math notranslate nohighlight">\(x\)</span>. This slope, together with the function value <span class="math notranslate nohighlight">\(f(x)\)</span>, is used to find the intersection of the tangent at <span class="math notranslate nohighlight">\(x\)</span> with zero to get an improved iteration method for the root.</p>
<p><span class="math notranslate nohighlight">\(x_{i+1}\)</span> is our updated or new or the closer to the solution value for <span class="math notranslate nohighlight">\(x\)</span>, and <span class="math notranslate nohighlight">\(x_i\)</span> is our previous value for <span class="math notranslate nohighlight">\(x\)</span>. We understand that our updated value <span class="math notranslate nohighlight">\(x_{i+1}\)</span> will not be in the same place as our previous value, and could be some distance away from our previous value. We remind ourselves that the Taylor expansion of function <span class="math notranslate nohighlight">\(f(x)\)</span> around a value, say <span class="math notranslate nohighlight">\(c\)</span> is written in the form of:</p>
<div class="math notranslate nohighlight">
\[ f(x) = f(c) + f'(c)(x-c) + \frac{1}{2!}f''(c)(x-c)^2 + \ldots   \]</div>
<p>Therefore, to find our updated value, we can use the Taylor series expansion around our updated value. We can say that the Taylor series expansion around our updated or new or the closer for solution value for <span class="math notranslate nohighlight">\(x\)</span>, so <span class="math notranslate nohighlight">\(x_{i+1}\)</span> can be expressed as</p>
<div class="math notranslate nohighlight">
\[ f(x_{i+1}) = f(x_i) + f'(x_i)(x_{i+1}-x_i) + \frac{1}{2!}f''(x_i)(x_{i+1}-x_i)^2 + \ldots   \]</div>
<p>or</p>
<p>The formula for Newton Method, also called Newton Raphson Method for some of you who might have covered this in A Levels can be derived from the Taylor series expansion:</p>
<p>\begin{equation}
f(x_{i+1}) = f(x_i) + f’(x_i)(x_{i+1}-x_i) + O(x_{i+1} - x_i)^2
\end{equation}</p>
<p>Since we think that the updated value needs to be closer to the root, we understand that <span class="math notranslate nohighlight">\(f(x_{i+1})\)</span> should become ever closer and closer to <span class="math notranslate nohighlight">\(0\)</span>. Remember, since we have moved everything to one side, finding the location where <span class="math notranslate nohighlight">\(f(x) =0\)</span> is the same as finding the solution to our equation.  Let <span class="math notranslate nohighlight">\(f(x_{i+1}) = 0\)</span> to find</p>
<p>\begin{equation}
0 = f(x_i) + f’(x_i)(x_{i+1}-x_i) + O(x_{i+1} - x_i)^2
\end{equation}</p>
<p>assuming <span class="math notranslate nohighlight">\(x_{i+1}\)</span> close to <span class="math notranslate nohighlight">\(x_{i}\)</span> we drop the higher order terms, since they are very small (this might come to bite us later, but it should work fine for most cases) and rearrange the equation slightly to find that</p>
<p>\begin{equation}
x_{i+1} = x_i - \frac{f(x_i)}{f’(x_i)}
\end{equation}</p>
<p>which is the <strong>Newton-Raphson formula</strong>.</p>
<p>A pseudo pseudo-code for the algorithm looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guess</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">do</span>
    <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">dfdx</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">tolerance</span>
</pre></div>
</div>
<p>The expression of the associated error indicates quadratic convergence:</p>
<p>\begin{equation}
\epsilon_{i+1} = -\frac{f’’(x)}{2f’(x)} \epsilon_{i}^2
\end{equation}</p>
<p>Illustrated, for <span class="math notranslate nohighlight">\(f(x) = x - \mathrm{e}^{-x}\)</span>, this approximation looks like the following.</p>
<p>Note that the green dashed lines extend off from the current iteration in the direction given by the slope of the blue line:</p>
<p>While I would definitely like to see you going through the code and understanding its implementation to reinforce and help you with reading code in the future, I would write out here the iterative process of the code to help you a bit in case you get confused at the code from below.</p>
<p>Let’s try to take an inital guess to solve this problem, say <span class="math notranslate nohighlight">\(x_0 = 1\)</span></p>
<p>To use the Newton Raphson Method, I need to find both <span class="math notranslate nohighlight">\(f'(x)\)</span></p>
<div class="math notranslate nohighlight">
\[f(x) = x-e^{-x}\]</div>
<div class="math notranslate nohighlight">
\[f'(x) = 1 + e^{-x} \]</div>
<p>To find our improved value for <span class="math notranslate nohighlight">\(x\)</span>, so <span class="math notranslate nohighlight">\(x_1\)</span>, we use the formula from above and we have</p>
<div class="math notranslate nohighlight">
\[x_{i+1} = x_i - \frac{f(x_i)}{f'(x_i)}\]</div>
<div class="math notranslate nohighlight">
\[x_{1} = x_0 - \frac{f(x_0)}{f'(x_0)}\]</div>
<div class="math notranslate nohighlight">
\[x_{1} = 1 - \frac{f(0)}{f'(0)}\]</div>
<div class="math notranslate nohighlight">
\[x_{1} = 1 - \frac{f(0)}{f'(0)}\]</div>
<div class="math notranslate nohighlight">
\[x_{1} = 1 - \frac{1-e^{-1}}{1 + e^{-1}}\]</div>
<div class="math notranslate nohighlight">
\[x_{1} = 1 - \frac{1-e^{-1}}{1 + e^{-1}}\]</div>
<div class="math notranslate nohighlight">
\[x_{1} = 0.5379\]</div>
<p>Now, you have <span class="math notranslate nohighlight">\(x_{1} = 0.5379\)</span> which is closer to the actual solution. Let’s do another iteration and find <span class="math notranslate nohighlight">\(x_2\)</span>, and even more improved value for <span class="math notranslate nohighlight">\(x\)</span> compared to <span class="math notranslate nohighlight">\(x_1\)</span></p>
<p>To find our even more improved value for <span class="math notranslate nohighlight">\(x\)</span>, so <span class="math notranslate nohighlight">\(x_2\)</span>, we use the formula from above and we have</p>
<div class="math notranslate nohighlight">
\[x_{i+1} = x_i - \frac{f(x_i)}{f'(x_i)}\]</div>
<div class="math notranslate nohighlight">
\[x_{2} = x_1 - \frac{f(x_1)}{f'(x_1)}\]</div>
<div class="math notranslate nohighlight">
\[x_{2} = 0.5379 - \frac{f(0.5379)}{f'(0.5379)}\]</div>
<div class="math notranslate nohighlight">
\[x_{2} = 0.5379 - \frac{f(0.5379)}{f'(0.5379)}\]</div>
<div class="math notranslate nohighlight">
\[x_{2} = 0.5379 - \frac{0.5379-e^{-0.5379}}{1 + e^{-0.5379}}\]</div>
<div class="math notranslate nohighlight">
\[x_{2} = 0.5379 - \frac{0.5379-e^{-0.5379}}{1 + e^{-0.5379}}\]</div>
<div class="math notranslate nohighlight">
\[x_{2} = 0.5670\]</div>
<p>And we keep on doing this, and so on and so forth!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">atol</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> 
                <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">resfct</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">x_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_0</span><span class="p">]</span>
    <span class="n">y_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x_0</span><span class="p">)]</span>    
    
    <span class="c1"># Newton iteration</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># iterate until we hit break either as we hit tolerance or maximum number iterations</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># approximate gradient - computed using a dx value - note comments below on quasi-newton</span>
        <span class="n">dfdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dx</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="c1"># Newton-Raphson update</span>
        <span class="n">x_zero</span> <span class="o">=</span> <span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dfdx</span> <span class="p">)</span>
        <span class="n">x_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_zero</span><span class="p">)</span>        
        <span class="n">y_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">atol</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">x_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_zero</span><span class="p">)</span>
        <span class="n">y_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_zero</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">maxiter</span><span class="p">:</span>
            <span class="k">break</span>
        
    <span class="c1"># the iteration results</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_n</span><span class="p">)),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    
    <span class="c1"># the convergence pattern</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        
    <span class="c1"># the function</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_n</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_n</span><span class="p">),</span> <span class="n">resfct</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
    
    <span class="c1"># zero line</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="c1"># zoomed inset</span>
    <span class="k">if</span> <span class="n">inset</span><span class="p">:</span>
        <span class="n">axins</span> <span class="o">=</span> <span class="n">zoomed_inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc0</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_n</span><span class="p">)),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ixmin</span><span class="p">,</span><span class="n">ixmax</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ixmin</span><span class="p">,</span> <span class="n">ixmax</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">iymin</span><span class="p">,</span> <span class="n">iymax</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mark_inset</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">axins</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flabel</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="s1">&#39;$f(x)$&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">flabel</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Newton&#39;s method iteration&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="c1"># case 1</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-3</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-2</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = x - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>

<span class="c1"># case 2</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-3</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-2</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">2.9</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = 2x + x\sin(x-3) - 5$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_51_0.png" src="../../../_images/NM1_2020_lecture4_51_0.png" />
<img alt="../../../_images/NM1_2020_lecture4_51_1.png" src="../../../_images/NM1_2020_lecture4_51_1.png" />
</div>
</div>
<p>This algorithm has been <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.newton.html">implemented</a> in the <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> module:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dfdx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="c1"># initial guess</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dfdx</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>0.567143290409784
</pre></div>
</div>
</div>
</div>
<div class="section" id="span-style-color-blue-exercise-4-5-span">
<h2><span style="color:blue">Exercise 4.5: </span><a class="headerlink" href="#span-style-color-blue-exercise-4-5-span" title="Permalink to this headline">¶</a></h2>
<p>For <span class="math notranslate nohighlight">\(2x + x \mathrm{sin}(x-3) = 5\)</span>, use <span class="math notranslate nohighlight">\(a\)</span> from the subinterval <span class="math notranslate nohighlight">\(x \in(a,b)\)</span> you found in Exercise 4.2 as initial guess <span class="math notranslate nohighlight">\(x_0\)</span> and complete the code below to implement a Newton algorithm. Compare the result to <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.newton.html">scipy.optimize.newton</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dfdx</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0e-6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function to implement the Newton-Raphson method</span>
<span class="sd">    </span>
<span class="sd">    f is the function we are trying to find a root of</span>
<span class="sd">    </span>
<span class="sd">    and dfdx is another function which return the derivative of f</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
    <span class="n">fevals</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">...............</span>
        <span class="n">fevals</span> <span class="o">+=</span>  <span class="o">...................</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">atol</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Newton (analytical derivative) used&#39;</span><span class="p">,</span> <span class="n">fevals</span><span class="p">,</span> <span class="s1">&#39;function evaluations&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1"># complete ...</span>

<span class="k">def</span> <span class="nf">dfdx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1"># complete ...</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.</span> <span class="c1"># initial guess somwhere in interval</span>
<span class="nb">print</span><span class="p">(</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dfdx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dfdx</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-24-e559600f71d9&gt;&quot;</span><span class="gt">, line </span><span class="mi">11</span>
    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="o">...............</span>
                 <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="viii-quasi-newton-with-approximate-derivative">
<h2>VIII.    (Quasi-) Newton with approximate derivative<a class="headerlink" href="#viii-quasi-newton-with-approximate-derivative" title="Permalink to this headline">¶</a></h2>
<p>Basically, this is still the Newton Method. Just this time instead of using the exact <span class="math notranslate nohighlight">\(f'(x)\)</span>, you would use an approximate for <span class="math notranslate nohighlight">\(f'(x)\)</span> in the form of</p>
<div class="math notranslate nohighlight">
\[ f'(x) \approx \frac{f(x+\Delta x) - f(x)}{\Delta x}. \]</div>
<p>either because the exact derivatives of some function may be difficult to compute, non existent, or your dexterity stat is too low, and you are unable to type the full exact derivative of the function without spelling mistakes.</p>
<p>The implementation of the Newton method above assumes that the derivative <span class="math notranslate nohighlight">\(f^\prime(x)\)</span> is readily available.</p>
<p>[Although note that this was not the case in the plotting function <code class="docutils literal notranslate"><span class="pre">plot_newton</span></code> where we computed an approximation to it].</p>
<p>For many problems, however, the derivative is not easy to express analytically or we just don’t want to bother working it out and writing a function to implement it.</p>
<p>In these cases <span class="math notranslate nohighlight">\(f^\prime(x)\)</span> can be replaced by a difference approximation such as</p>
<div class="math notranslate nohighlight">
\[ f'(x) \approx \frac{f(x+\Delta x) - f(x)}{\Delta x}. \]</div>
<p>Use of an approximate derivative renders the corresponding root finding algorithm a co-called <em>quasi-Newton</em> method.</p>
<p>Note that since we only have an approximate derivative we cannot in general expect this method to converge as well as Newton when we supply it with an exact derivative. This manifests in a reduction from perfect quadratic convergence - but still generally closer to quadratic that linear!</p>
</div>
<div class="section" id="span-style-color-blue-exercise-4-6-span">
<h2><span style="color:blue">Exercise 4.6: </span><a class="headerlink" href="#span-style-color-blue-exercise-4-6-span" title="Permalink to this headline">¶</a></h2>
<p>Extend the Newton algorithm to compute <span class="math notranslate nohighlight">\(f^\prime(x)\)</span> using a finite difference approximation. Compare the result to <code class="docutils literal notranslate"><span class="pre">scipy.optimize.newton</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quasi_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.0E-7</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0E-6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function to implement quasi-newton</span>
<span class="sd">    </span>
<span class="sd">    f is the function we are trying to find a root of</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="o">......</span>
        <span class="o">......</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">atol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="c1"># complete ...</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quasi_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-25-a7de430363a4&gt;&quot;</span><span class="gt">, line </span><span class="mi">8</span>
    <span class="o">......</span>
       <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h1>IX.   Secant Method<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h1>
<p>Now that you have gone through the Bisection and the Newton Method, you should have a good grasp at what these methods for finding the numerical solution entail, and also how to program these methods in Python so well, this is a new method, go ahead and program it! ;)</p>
<p>The Secant method replaces the local derivative in the Newton method by a difference approximation based on two consecutive <span class="math notranslate nohighlight">\(x_n\)</span>. It follows that</p>
<p>\begin{equation}
f’(x_n) \approx \frac{f(x_n) - f(x_{n-1})}{x_n - x_{n-1}}
\end{equation}</p>
<p>which leads to the secant method</p>
<p>\begin{equation}
x_{n+1} = x_n - f(x_n) \left ( \frac{x_n - x_{n-1}}{f(x_n) - f(x_{n-1})} \right )
\end{equation}</p>
<p>The algorithm can be visualized as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_secant</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">atol</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">max_labels0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">3.2</span><span class="p">,</span> 
                <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">resfct</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="c1"># variables to store to convergence pattern, initialise with two initial guess values</span>
    <span class="n">x_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_0</span><span class="p">,</span> <span class="n">x_1</span><span class="p">]</span> 
    <span class="n">y_n</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x_0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x_1</span><span class="p">)]</span>    
    <span class="n">x_its</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_0</span><span class="p">,</span> <span class="n">x_1</span><span class="p">]</span>
    <span class="c1"># iterate secant method and store iteration convergence pattern</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># iterate until we hit break either as we hit tolerance or maximum number iterations</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>     
        <span class="c1"># Secant update</span>
        <span class="n">x_zero</span> <span class="o">=</span> <span class="n">x_its</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_its</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">x_its</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_its</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_its</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_its</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span> <span class="p">)</span>
        <span class="n">x_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_zero</span><span class="p">)</span>        
        <span class="n">y_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">x_its</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_zero</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_n</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">atol</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">x_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_zero</span><span class="p">)</span>
        <span class="n">y_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_zero</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">maxiter</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="c1"># the iteration results</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_its</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_its</span><span class="p">)),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    
    <span class="c1"># the convergence pattern</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
     
    <span class="c1"># the function</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_n</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_n</span><span class="p">),</span> <span class="n">resfct</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

    <span class="c1"># zero line</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="c1"># zoomed inset</span>
    <span class="k">if</span> <span class="n">inset</span><span class="p">:</span>
        <span class="n">axins</span> <span class="o">=</span> <span class="n">zoomed_inset_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc0</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_its</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_its</span><span class="p">)),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">y_n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">ixmin</span><span class="p">,</span><span class="n">ixmax</span><span class="p">],[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ixmin</span><span class="p">,</span> <span class="n">ixmax</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">iymin</span><span class="p">,</span> <span class="n">iymax</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axins</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mark_inset</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">axins</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>        
        
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flabel</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="s1">&#39;$f(x)$&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">flabel</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Secant method iteration&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="c1"># case 1</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span><span class="o">+</span><span class="mf">0.75</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plot_secant</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="mf">1E-3</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                            <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = x - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>

<span class="c1"># case 2</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span><span class="o">+</span><span class="mf">0.1</span>
<span class="n">plot_secant</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="mf">1E-3</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ixmin</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">2.85</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = 2x + x\sin(x-3) - 5$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_60_0.png" src="../../../_images/NM1_2020_lecture4_60_0.png" />
<img alt="../../../_images/NM1_2020_lecture4_60_1.png" src="../../../_images/NM1_2020_lecture4_60_1.png" />
</div>
</div>
<div class="section" id="span-style-color-blue-exercise-4-7-span">
<h2><span style="color:blue">Exercise 4.7:</span><a class="headerlink" href="#span-style-color-blue-exercise-4-7-span" title="Permalink to this headline">¶</a></h2>
<p>For <span class="math notranslate nohighlight">\(2x + x \mathrm{sin}(x-3) = 5\)</span>, use <span class="math notranslate nohighlight">\(a\)</span> from the subinterval <span class="math notranslate nohighlight">\(x \in(a,b)\)</span> you found in Exercise 4.2 to find <span class="math notranslate nohighlight">\(x_0 = a\)</span> and <span class="math notranslate nohighlight">\(x_1 = a+0.1\)</span> and complete the code below to implement a Secant algorithm. Compare the result to <code class="docutils literal notranslate"><span class="pre">scipy.optimize.newton</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">secant</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1.0E-6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function to implement the secant method</span>
<span class="sd">    </span>
<span class="sd">    x0 and x1 are the two required guesses</span>
<span class="sd">    </span>
<span class="sd">    f is the function we are trying to find a root of</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">]</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">dfdx</span> <span class="o">=</span> <span class="o">.....</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">.......</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">atol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span><span class="o">+</span><span class="mf">0.1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">secant</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-27-cbdc294213f0&gt;&quot;</span><span class="gt">, line </span><span class="mi">10</span>
    <span class="n">dfdx</span> <span class="o">=</span> <span class="o">.....</span>
               <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h1>X.  Potential convergence Issues<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h1>
<p>It’s important to understand the ways some of the methods we’ve introduced can go wrong, and again to emphasise the value of a good starting guess.</p>
<p>Let’s start by illustrating the basic concept of Newton root-finding methods for a well-behaved function</p>
<div class="math notranslate nohighlight">
\[ f(x) := x^4 - 5. \]</div>
<p>Let’s first reillustrate the basic concept of Newton root-finding methods for a well behaved function</p>
<p>\begin{equation}
f(x) = x^4 - 5
\end{equation}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">loc0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">loc2</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                            <span class="n">ixmin</span><span class="o">=</span><span class="mf">1.45</span><span class="p">,</span> <span class="n">ixmax</span><span class="o">=</span><span class="mf">1.85</span><span class="p">,</span> <span class="n">iymin</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">iymax</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x) = x^4 - 5$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_65_0.png" src="../../../_images/NM1_2020_lecture4_65_0.png" />
</div>
</div>
<p>We’ve said several times now that the convergence of many algorithms often depends on the initial values provided to them.</p>
<p>Complex equations, or systems thereof, provide plenty of situations that prevent convergence all together, lead to slow convergence, or cause convergence to an undesired root (e.g. one that is far from, and not the closest to, the initial guess).</p>
<p>Their solution strongly depends on having a <em>good</em> initial guess.</p>
<p>For example,</p>
<div class="math notranslate nohighlight">
\[ f(x) = x\, \sin(\pi x) - e^{-x}, \]</div>
<p>provides for ample pitfalls, in particular for gradient-based methods (e.g. Newton and Secant).</p>
<p>We will illustrate these convergence issues below.</p>
<p>They mostly fall into one of three categories:</p>
<ol class="simple">
<li><p>Multiple roots in the vicinity - the algorithm converges to one of them, but this “one” could change with only slight changes to the initial guess.</p></li>
<li><p>Nearly singular/numerical overflow - the local gradient at guess <span class="math notranslate nohighlight">\(x^{(k)}\)</span> is near zero, so that <span class="math notranslate nohighlight">\(x^{(k+1)}\)</span>, the intersection of the local gradient approximation with the <span class="math notranslate nohighlight">\(x\)</span> axis is beyond the representable range. Even if we don’t get overflow, we can still jump to a location a long distance away from our initial guess and end up converging to the wrong root.</p></li>
<li><p>Oscillations - the algorithm bounces back and forth between (near) identical <span class="math notranslate nohighlight">\(x^{(k)}\)</span>.</p></li>
</ol>
<div class="section" id="multiple-roots">
<h2>Multiple roots<a class="headerlink" href="#multiple-roots" title="Permalink to this headline">¶</a></h2>
<p>For many functions multiple roots exist, and the algorithm depends on and can be sensitive to the initial guess.</p>
<p>Let’s see an example where we choose two initial guesses (0.0 and 0.1) and visualise how this relatively small difference leads to convergence to different roots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_69_0.png" src="../../../_images/NM1_2020_lecture4_69_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1"># a small perturbation to the initial guess</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_70_0.png" src="../../../_images/NM1_2020_lecture4_70_0.png" />
</div>
</div>
<p>We see from the first plot that this problem has roots at just under 0.6 and just over 0.8.  The initial guess of 0 leads to convergence of the Newton iteration to the larger root, whereas a slightly higher initial guess of 0.1 leads to the smaller root!</p>
<p>We confirm this behaviour is not a product of an issue with our implementation, and print the two actual root values, using calls to the SciPy function below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>0.8191177934425945
0.578262577864515
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="nearly-singular-numerical-overflow">
<h2>Nearly singular/numerical overflow<a class="headerlink" href="#nearly-singular-numerical-overflow" title="Permalink to this headline">¶</a></h2>
<p>In this case the gradient <span class="math notranslate nohighlight">\(\,f'(x^{(k)})\,\)</span> is close to zero, so that the new iteration value, <span class="math notranslate nohighlight">\(x^{(k+1)}\)</span>, is orders of magnitude offset, perhaps too big even to be representable on our finite computer (<a class="reference external" href="https://en.wikipedia.org/wiki/Integer_overflow"><em>overflow</em></a>).</p>
<p>We see this with the following example.</p>
<p>Remember how the formula for the Newton method was</p>
<p>\begin{equation}
x_{i+1} = x_i - \frac{f(x_i)}{f’(x_i)}
\end{equation}</p>
<p>Thus remember how for every iteration, you had to divide by <span class="math notranslate nohighlight">\(f'(x_i)\)</span>?</p>
<p>If your <span class="math notranslate nohighlight">\(f(x_i)\)</span> is very close to <span class="math notranslate nohighlight">\(0\)</span>, then since <span class="math notranslate nohighlight">\(f(x_i)\)</span> is very small, when you divide the numerator by this, this will most certainly result in a very small number.</p>
<p>Remember how a computer can only deal with limited number of decimals places, well the same goes the other way too, so a computer can only deal with a finite large number, and not very well with infinity. While you could program it out and Python does provide support for infinity, inifinity is still usually something that computer neither like nor understand very well.</p>
<p>This results in numerical overflow, meaning that the number is too large for your computer to handle and the computer just gets really confused …</p>
<p>A method to deal with this problem is to use the Quasi Newton Method or the Secant Method, or even the Bisection method instead. However, note that these methods also have situations where they fail, so it is important to note the capabilities of each method. There may be nothing wrong with your code, it may simply be the method at fault.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.27</span><span class="p">]</span>
<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$root_I$&#39;</span><span class="p">,</span> <span class="s1">&#39;$root_</span><span class="si">{II}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;$nearly singular/overflow$&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">])],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">xlim</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y(x)=0$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Near singularity/overflow example&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_75_0.png" src="../../../_images/NM1_2020_lecture4_75_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">resfct</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_76_0.png" src="../../../_images/NM1_2020_lecture4_76_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.25</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">resfct</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_77_0.png" src="../../../_images/NM1_2020_lecture4_77_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.268</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">resfct</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_78_0.png" src="../../../_images/NM1_2020_lecture4_78_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.269</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">resfct</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="stderr docutils container">
<pre class="stderr literal-block">&lt;ipython-input-36-5921017847f3&gt;:2: RuntimeWarning: overflow encountered in exp
  return x*np.sin(np.pi*x)-np.exp(-x)
&lt;ipython-input-22-2a95dd3ffbb6&gt;:11: RuntimeWarning: invalid value encountered in double_scalars
  dfdx = (f(x_n[-1]+dx) - f(x_n[-1])) / dx
</pre>
</div>
<img alt="../../../_images/NM1_2020_lecture4_79_1.png" src="../../../_images/NM1_2020_lecture4_79_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># do we converge for a slightly larger initial guess?</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2684</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>

<span class="c1"># but see what happens if you make this x0 very slightly smaller!</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2685</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>



<span class="c1"># we converge to the first root in the image above if we start with an appropriate value</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>


<span class="c1"># and similarly the second root shown in the above plot</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sop</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>4.999570827870424
24017.65375762087
0.578262577864515
0.8191177934426115
</pre></div>
</div>
<div class="stderr docutils container">
<pre class="stderr literal-block">&lt;ipython-input-37-920b2c53e186&gt;:2: RuntimeWarning: overflow encountered in exp
  return x*np.sin(np.pi*x)-np.exp(-x)
</pre>
</div>
</div>
</div>
</div>
<div class="section" id="oscillation">
<h2>Oscillation<a class="headerlink" href="#oscillation" title="Permalink to this headline">¶</a></h2>
<p>In this scenario the iterations are trapped in a region with gradients of approximately equal magnitude but opposite directions.</p>
<p>Basically, our numerial solution methods here use an iterative approach to get closer and closer to the solution and narrow down the location that the solution is in. However, this is done with the assumption that within our initial guess as to the range where our solution is, there is actually a solution. If there is no solution, and you apply Newton method, then the method will just try to search for something that does not exist and get confused.</p>
<p>Oscillation problems could also happen when the iterations are trapped in a region where gradients to either side have equal magnitude but oppisite direction, sorta something like symmetry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> 
                                            <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= x \mathrm</span><span class="si">{sin}</span><span class="s1">(\pi x) - \mathrm</span><span class="si">{e}</span><span class="s1">^{-x}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_82_0.png" src="../../../_images/NM1_2020_lecture4_82_0.png" />
</div>
</div>
<p>What happens if you increase the number of iterations?</p>
<p>Another similar example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.3917</span>
<span class="n">plot_newton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.e-7</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> 
                                            <span class="n">flabel</span><span class="o">=</span><span class="s1">&#39;$f(x)= \mathrm</span><span class="si">{tan}</span><span class="s1">^{-1}(x)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/NM1_2020_lecture4_84_0.png" src="../../../_images/NM1_2020_lecture4_84_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "primer-computational-mathematics/book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./mathematics/numerical_methods/NM1_2020"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Imperial College London<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../../_static/js/index.js"></script>
    
  </body>
</html>