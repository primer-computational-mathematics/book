

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Numerical Methods &#8212; ESE Jupyter Material</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".cell"
        const thebe_selector_input = ".cell_input div.highlight"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ESE Jupyter Material</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../../../intro.html">Landing page</a>
  </li>
  <li class="">
    <a href="../../../a_modules/intro.html">Modules</a>
  </li>
  <li class="">
    <a href="../../../b_coding/intro.html">Coding</a>
  </li>
  <li class="">
    <a href="../../intro.html">Mathematics</a>
  </li>
  <li class="">
    <a href="../../../d_geosciences/intro.html">Geosciences</a>
  </li>
  <li class="">
    <a href="../../../e_extra/intro.html">Further resources</a>
  </li>
  <li class="">
    <a href="../../../genindex.html">Index</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/c_mathematics/numerical_methods/NM1_2020/NM1_2020_lecture7.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/primer-computational-mathematics/book/issues/new?title=Issue%20on%20page%20%2Fc_mathematics/numerical_methods/NM1_2020/NM1_2020_lecture7.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/primer-computational-mathematics/book/master?urlpath=tree/notebooks/c_mathematics/numerical_methods/NM1_2020/NM1_2020_lecture7.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Numerical Methods</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#lecture-7-numerical-linear-algebra-iii" class="nav-link">Lecture 7: Numerical Linear Algebra III</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#contents" class="nav-link">Contents</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#i-ill-conditioned-matrices" class="nav-link">I.     Ill - Conditioned Matrices</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#ii-round-off-errors" class="nav-link">II.    Round Off Errors</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#iii-algorithm-stability" class="nav-link">III.   Algorithm Stability</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#iv-direct-vs-iterative-methods" class="nav-link">IV.   Direct vs Iterative Methods</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#v-iterative-methods-jacobi-s-method" class="nav-link">V.    Iterative Methods - Jacobi’s Method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#vi-iterative-methods-gauss-seidel-method" class="nav-link">VI.   Iterative Methods - Gauss - Seidel Method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#vii-sparse-matrices" class="nav-link">VII.  Sparse Matrices</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#viii-extra-how-to-guide" class="nav-link">VIII.  EXTRA: How to Guide</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#learning-objectives" class="nav-link">Learning objectives:</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#viii-sparse-matrices" class="nav-link">VIII.    Sparse matrices</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#an-example-of-a-sparse-matrix" class="nav-link">An example of a sparse matrix</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#extra-how-to-guide" class="nav-link">EXTRA.    How - to - Guide</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="numerical-methods">
<h1>Numerical Methods<a class="headerlink" href="#numerical-methods" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="lecture-7-numerical-linear-algebra-iii">
<h1>Lecture 7: Numerical Linear Algebra III<a class="headerlink" href="#lecture-7-numerical-linear-algebra-iii" title="Permalink to this headline">¶</a></h1>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="i-ill-conditioned-matrices">
<h2>I.     Ill - Conditioned Matrices<a class="headerlink" href="#i-ill-conditioned-matrices" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="ii-round-off-errors">
<h2>II.    Round Off Errors<a class="headerlink" href="#ii-round-off-errors" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="iii-algorithm-stability">
<h2>III.   Algorithm Stability<a class="headerlink" href="#iii-algorithm-stability" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="iv-direct-vs-iterative-methods">
<h2>IV.   Direct vs Iterative Methods<a class="headerlink" href="#iv-direct-vs-iterative-methods" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="v-iterative-methods-jacobi-s-method">
<h2>V.    Iterative Methods - Jacobi’s Method<a class="headerlink" href="#v-iterative-methods-jacobi-s-method" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="vi-iterative-methods-gauss-seidel-method">
<h2>VI.   Iterative Methods - Gauss - Seidel Method<a class="headerlink" href="#vi-iterative-methods-gauss-seidel-method" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="vii-sparse-matrices">
<h2>VII.  Sparse Matrices<a class="headerlink" href="#vii-sparse-matrices" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="viii-extra-how-to-guide">
<h2>VIII.  EXTRA: How to Guide<a class="headerlink" href="#viii-extra-how-to-guide" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="learning-objectives">
<h2>Learning objectives:<a class="headerlink" href="#learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Introduce ill-conditioned matrices (via matrix norms and condition number)</p></li>
<li><p>Consider direct vs iterative/indirect methods</p></li>
<li><p>Example iterative algorithm: the Jacobi and Gauss-Seidel methods</p></li>
<li><p>Sparse matrices and a pointer to more advanced algorithms (supplementary readings)</p></li>
</ul>
</div>
<div class="section" id="viii-sparse-matrices">
<h2>VIII.    Sparse matrices<a class="headerlink" href="#viii-sparse-matrices" title="Permalink to this headline">¶</a></h2>
<p>Note that the matrices which result from the numerical solution of differential equations are generally  <em>sparse</em> (<a class="reference external" href="https://en.wikipedia.org/wiki/Sparse_matrix">https://en.wikipedia.org/wiki/Sparse_matrix</a>) which means that most entries are zero (the alternative is termed <em>dense</em>).  Knowing which entries are zero means that we can devise more efficient matrix storage methods, as well as more efficient implementations of the above algorithms (e.g. by not bothering to do operations that we know involve multiplications by zero - we know the answer will be zero).</p>
<p>As an example, for the two iterative methods shown above (Jacobi and Gauss Seidel), the cost of <em>each</em> iteration is quadratically dependent on the number of unknowns <span class="math notranslate nohighlight">\(n\)</span>, since we need to loop through all the entries of the <span class="math notranslate nohighlight">\(n\times n\)</span> matrix <span class="math notranslate nohighlight">\(A\)</span>. For a fixed number of iterations the computational cost of these methods therefore scales as <span class="math notranslate nohighlight">\(n^2\)</span>. If we know that each row only contains a fixed, small number of non-zero entries however (as for example the matrix in the example below), we can simply skip the zero entries and the cost <em>per iteration</em> becomes linear in <span class="math notranslate nohighlight">\(n\)</span>. These scalings of <span class="math notranslate nohighlight">\(n^2\)</span> for <em>dense</em> and <span class="math notranslate nohighlight">\(n\)</span> for <em>sparse</em> matrices for the cost per iteration are typical for iterative methods. Unfortunately this does not mean that the overall cost of an iterative method is also <span class="math notranslate nohighlight">\(n^2\)</span> or <span class="math notranslate nohighlight">\(n\)</span>, as the number of iterations that is needed to achieve a certain accuracy quite often also increases for larger problem sizes. The number of required iterations typically only increases very slowly however, so that the cost of the method is still considerably cheaper than direct methods, in particular for very large problems.</p>
<p>A huge range of iterative solution methods exist and the literature on this topic is massive. Below is an example of using scipy to access the Conjugate Gradient algorithm which is a popular example of a method suitable for matrices which result from the numerical solution of differential equations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">main_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>   <span class="c1">#just a vector of ones</span>
<span class="n">off_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># to make it a bit more interesting make the off-diagonals random</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">main_diag</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">off_diag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">off_diag</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># A random RHS vector</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="c1"># print our A in &quot;dense&quot; matrix format</span>

<span class="n">sA</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="c1"># The same matrix in a &quot;sparse&quot; matrix data structure where only non-zeros stored</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This is the same matrix but now stored in a sparse matrix data structure.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sA</span><span class="p">)</span>

<span class="c1"># now use a scipy iterative algorithm (Conjugate Gradient) to solve</span>

<span class="c1"># First define a (callback) function which we are allowed to pass to the solver; here this is coded such that it will store and print the iteration numbers and residuals - basically a method to output some diagnostic information on the solver as it executes</span>
<span class="k">def</span> <span class="nf">gen_callback_cg</span><span class="p">():</span>
    <span class="n">diagnostics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="p">[])</span> 
    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">xk</span><span class="p">):</span>   <span class="c1"># xk is the solution computed by CG at each iteration</span>
        <span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;it&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;residuals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span> <span class="o">@</span> <span class="n">xk</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;it&quot;</span><span class="p">],</span> <span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span> <span class="o">@</span> <span class="n">xk</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">callback</span>    

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Now we execute the CG algorithm on our problem, with our callback function returning information on the residual at each iteration.&#39;</span><span class="p">)</span>
<span class="n">x_sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cg</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">gen_callback_cg</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-2.          0.01579799  0.         ...  0.          0.
   0.        ]
 [ 0.01579799 -2.          0.96907927 ...  0.          0.
   0.        ]
 [ 0.          0.96907927 -2.         ...  0.          0.
   0.        ]
 ...
 [ 0.          0.          0.         ... -2.          0.293628
   0.        ]
 [ 0.          0.          0.         ...  0.293628   -2.
   0.02000908]
 [ 0.          0.          0.         ...  0.          0.02000908
  -2.        ]]
This is the same matrix but now stored in a sparse matrix data structure.
  (0, 0)	-2.0
  (0, 1)	0.01579798887096051
  (1, 0)	0.01579798887096051
  (1, 1)	-2.0
  (1, 2)	0.9690792657586554
  (2, 1)	0.9690792657586554
  (2, 2)	-2.0
  (2, 3)	0.4426848628892317
  (3, 2)	0.4426848628892317
  (3, 3)	-2.0
  (3, 4)	0.33287797242853423
  (4, 3)	0.33287797242853423
  (4, 4)	-2.0
  (4, 5)	0.8349961890669807
  (5, 4)	0.8349961890669807
  (5, 5)	-2.0
  (5, 6)	0.2759243129018931
  (6, 5)	0.2759243129018931
  (6, 6)	-2.0
  (6, 7)	0.5899642313423469
  (7, 6)	0.5899642313423469
  (7, 7)	-2.0
  (7, 8)	0.5338100213881314
  (8, 7)	0.5338100213881314
  (8, 8)	-2.0
  :	:
  (41, 41)	-2.0
  (41, 42)	0.6990321498971347
  (42, 41)	0.6990321498971347
  (42, 42)	-2.0
  (42, 43)	0.44120676550363935
  (43, 42)	0.44120676550363935
  (43, 43)	-2.0
  (43, 44)	0.6627012118552
  (44, 43)	0.6627012118552
  (44, 44)	-2.0
  (44, 45)	0.08354089874916015
  (45, 44)	0.08354089874916015
  (45, 45)	-2.0
  (45, 46)	0.06076481090638697
  (46, 45)	0.06076481090638697
  (46, 46)	-2.0
  (46, 47)	0.2600948682739955
  (47, 46)	0.2600948682739955
  (47, 47)	-2.0
  (47, 48)	0.29362800321791604
  (48, 47)	0.29362800321791604
  (48, 48)	-2.0
  (48, 49)	0.02000907848336786
  (49, 48)	0.02000907848336786
  (49, 49)	-2.0
Now we execute the CG algorithm on our problem, with our callback function returning information on the residual at each iteration.
1 2.3562251696335856
2 1.0239182056504734
3 0.401992541842747
4 0.223770573282838
5 0.10784772944319773
6 0.04528275512406776
7 0.016783187792529596
8 0.007841550759271124
9 0.003427366089593852
10 0.0013261858767582826
11 0.0005783870772007964
12 0.0002434899030345161
13 7.049175749160568e-05
14 2.7297491399353727e-05
15 9.758147321408194e-06
16 2.1383778140400358e-06
17 8.453340360899756e-07
18 4.027234283292924e-07
19 1.244334213076751e-07
20 3.765897211891967e-08
21 1.380157208085994e-08
22 3.2245429787673083e-09
23 1.211810534395043e-09
24 3.697853422438397e-10
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="an-example-of-a-sparse-matrix">
<h2>An example of a sparse matrix<a class="headerlink" href="#an-example-of-a-sparse-matrix" title="Permalink to this headline">¶</a></h2>
<p>Let us consider an electric circuit arranged in a regular grid of <span class="math notranslate nohighlight">\(n\)</span> rows and <span class="math notranslate nohighlight">\(m\)</span> columns. The nodes in the grid are numbered from 0 to <span class="math notranslate nohighlight">\(nm-1\)</span> as indicated in the diagram below.</p>
<p><img alt="bla" src="c_mathematics/numerical_methods/NM1_2020/images/circuit.png" /></p>
<p>We want to calculate the electric potential <span class="math notranslate nohighlight">\(V_i\)</span> in all of the nodes <span class="math notranslate nohighlight">\(i\)</span>. A node <span class="math notranslate nohighlight">\(i\)</span> somewhere in the middle of the circuit is connected via resistor to nodes <span class="math notranslate nohighlight">\(i-1\)</span> and <span class="math notranslate nohighlight">\(i+1\)</span> to the left and right respectively, and to the nodes <span class="math notranslate nohighlight">\(i-m\)</span> and <span class="math notranslate nohighlight">\(i+m\)</span> in the rows above and below. For simplicity we assume that all resistors have the same resistance value <span class="math notranslate nohighlight">\(R\)</span>. The first and last node of the circuit (0 and <span class="math notranslate nohighlight">\(nm-1\)</span>) to a battery via two additional resistors, with the same resistance value <span class="math notranslate nohighlight">\(R\)</span>.</p>
<p>The sum of the currents coming into a node is zero (if we use a sign convention where a current coming into a node is positive and a current going out is negative. The currents between two nodes can be calculated using Ohm’s law: <span class="math notranslate nohighlight">\(I=V/R\)</span> where <span class="math notranslate nohighlight">\(R\)</span> is the resistance of the resistor, and <span class="math notranslate nohighlight">\(V\)</span> is the potential difference between two nodes, say <span class="math notranslate nohighlight">\(V=V_i-V_{i-1}\)</span>. Therefore we can write:</p>
<p>\begin{eqnarray}
0 &amp;=&amp; I_{i-1\to i} + I_{i+1\to i} + I_{i-m\to i} + I_{i+m\to i} \
&amp;=&amp; V_{i-1\to i}/R + V_{i+1\to i}/R + V_{i-m\to i}/R + V_{i+m\to i}/R \
&amp;=&amp; (V_{i}-V_{i-1})/R + (V_{i}-V_{i+1})/R + (V_{i}-V_{i-m})/R + (V_{i}-V_{i+m})/R \
&amp;=&amp; (4V_{i}-V_{i-1}-V_{i+1}-V_{i-m}-V_{i+m})/R
\end{eqnarray}</p>
<p>This gives us one linear equation for each node in the circuit (with slight modifications for nodes that are not in the interior). These can be combined into a linear system <span class="math notranslate nohighlight">\(Ax=b\)</span> which is assembled in the code below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># number of rows</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># number of columns</span>
<span class="n">V_battery</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="c1"># voltage on the right of the battery</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">))</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">row</span><span class="o">*</span><span class="n">m</span> <span class="o">+</span> <span class="n">column</span> <span class="c1"># node number</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># left neighbour</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">column</span><span class="o">&lt;</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># right neighbour</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># neighbour above</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">&lt;</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># neighbour below</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>

<span class="c1"># connecting node 0 to the battery: I = (V_0 - 0)/R</span>
<span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span> 
<span class="c1"># connecting last node nm-1 to the battery: I = (V_0 - V_battery)/R = V_0/R - V_battery/R</span>
<span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
<span class="c1"># the V_battery/R term is a constant that does not depend on the unknowns, so ends up in the rhs vector b</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_battery</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 3. -1.  0. -1.  0.  0.  0.  0.  0.  0.  0.  0.]
 [-1.  3. -1.  0. -1.  0.  0.  0.  0.  0.  0.  0.]
 [ 0. -1.  2.  0.  0. -1.  0.  0.  0.  0.  0.  0.]
 [-1.  0.  0.  3. -1.  0. -1.  0.  0.  0.  0.  0.]
 [ 0. -1.  0. -1.  4. -1.  0. -1.  0.  0.  0.  0.]
 [ 0.  0. -1.  0. -1.  3.  0.  0. -1.  0.  0.  0.]
 [ 0.  0.  0. -1.  0.  0.  3. -1.  0. -1.  0.  0.]
 [ 0.  0.  0.  0. -1.  0. -1.  4. -1.  0. -1.  0.]
 [ 0.  0.  0.  0.  0. -1.  0. -1.  3.  0.  0. -1.]
 [ 0.  0.  0.  0.  0.  0. -1.  0.  0.  2. -1.  0.]
 [ 0.  0.  0.  0.  0.  0.  0. -1.  0. -1.  3. -1.]
 [ 0.  0.  0.  0.  0.  0.  0.  0. -1.  0. -1.  3.]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extra-how-to-guide">
<h2>EXTRA.    How - to - Guide<a class="headerlink" href="#extra-how-to-guide" title="Permalink to this headline">¶</a></h2>
<p>Always check the solvability before actually trying to solve it! You could use determinant and Norms, or the Gaussian - Jordan to check!</p>
<p>For system of linear equations</p>
<ul class="simple">
<li><p>If the problem you are solving has very few unknowns and very few equations, i.e. 3 or less, maybe more for some of you who are more math savvy, then solve it by hand</p></li>
<li><p>If the problem you are solving has few unknowns and few equations, use Gaussian Elimination, preferably through LU decomposition using Doolittle Algorithm and maybe implement partial pivoting for <span class="math notranslate nohighlight">\(0\)</span> on the diagonal</p></li>
<li><p>f the problem you are solving has lots of unknowns and lots of equation, and finding the exact solution would take ages, and well you don’t have ages of time to solve the problem, then preferably Iterative Methods, such as the Jacobi Method or Gauss - Seidel Method.</p></li>
</ul>
<p>For numerical solutions to differential equations that are generally sparse - maybe use Conjugate Gradient Algorithm or some other algorithm that reduces the number of operations for sparse matrices, especially for very large sparse matrices.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "primer-computational-mathematics/book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./c_mathematics/numerical_methods/NM1_2020"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Imperial College London<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../../_static/js/index.js"></script>
    
  </body>
</html>