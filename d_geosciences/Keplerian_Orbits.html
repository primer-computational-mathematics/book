

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Keplerian orbits &#8212; ESE Jupyter Material</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".cell"
        const thebe_selector_input = ".cell_input div.highlight"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Milankovitch cycles" href="Milankovitch_cycles.html" />
    <link rel="prev" title="Seafloor ages" href="Dynamic_Earth.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ESE Jupyter Material</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../intro.html">Landing page</a>
  </li>
  <li class="">
    <a href="../a_modules/intro.html">Modules</a>
  </li>
  <li class="">
    <a href="../b_coding/intro.html">Coding</a>
  </li>
  <li class="">
    <a href="../c_mathematics/intro.html">Mathematics</a>
  </li>
  <li class="active">
    <a href="intro.html">Geosciences</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="1D_Heat_Conduction.html">1D heat conduction (layered medium)</a>
    </li>
    <li class="">
      <a href="1D_Resistivity_Forward_Modelling.html">1D resistivity forward modelling</a>
    </li>
    <li class="">
      <a href="Climate_Model.html">Climate model</a>
    </li>
    <li class="">
      <a href="Dynamic_Earth.html">Seafloor ages</a>
    </li>
    <li class="active">
      <a href="">Keplerian orbits</a>
    </li>
    <li class="">
      <a href="Milankovitch_cycles.html">Milankovitch cycles</a>
    </li>
    <li class="">
      <a href="Seismology.html">Downloading earthquake data</a>
    </li>
    <li class="">
      <a href="Tides.html">Tides</a>
    </li>
    <li class="">
      <a href="Wave_dispersion.html">Wave dispersion</a>
    </li>
    <li class="">
      <a href="Fluid_Dynamics/intro.html">Fluid Dynamics</a>
    </li>
    <li class="">
      <a href="remote_sensing/intro.html">Remote sensing</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="../e_extra/intro.html">Further resources</a>
  </li>
  <li class="">
    <a href="../genindex.html">Index</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/d_geosciences/Keplerian_Orbits.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/primer-computational-mathematics/book/issues/new?title=Issue%20on%20page%20%2Fd_geosciences/Keplerian_Orbits.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/primer-computational-mathematics/book/master?urlpath=tree/notebooks/d_geosciences/Keplerian_Orbits.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#theory" class="nav-link">Theory</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#restricted-three-body-problem-numerical-solution" class="nav-link">Restricted three-body problem - numerical solution</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#centre-of-mass-coordinate-system" class="nav-link">Centre of mass coordinate system</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#initial-velocities" class="nav-link">Initial velocities</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#gravity-force" class="nav-link">Gravity force</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#derivatives-in-the-equations-of-motion" class="nav-link">Derivatives in the equations of motion</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#runge-kutta-method" class="nav-link">Runge-Kutta method</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#solution-in-the-intertial-frame" class="nav-link">Solution in the intertial frame</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#solution-in-the-rotating-frame" class="nav-link">Solution in the rotating frame</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#adding-perturbations" class="nav-link">Adding perturbations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#references" class="nav-link">References</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="keplerian-orbits">
<h1>Keplerian orbits<a class="headerlink" href="#keplerian-orbits" title="Permalink to this headline">¶</a></h1>
<div class="section" id="theory">
<span id="index-0"></span><h2>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p id="index-1">Kepler laws were published in 17th century by Johannes Kepler based on observations of motion of planetary objects in the sky.</p>
<div class="admonition-kepler-s-laws admonition">
<p class="admonition-title">Kepler’s laws:</p>
<ol class="simple">
<li><p>First law - the orbit of each planets is an ellipse with the Sun at the focus.</p></li>
<li><p>Second law - the line joining the planet to the Sun sweeps out equal areas in equal times.</p></li>
<li><p>Third law - <span class="math notranslate nohighlight">\(T^2\propto a^3\)</span>, where <span class="math notranslate nohighlight">\(T\)</span> is the period and <span class="math notranslate nohighlight">\(a\)</span> is the distance from the Sun.</p></li>
</ol>
</div>
<p>These laws are good approximations of planetary motion in Solar System and are a consequence of gravitational attraction between planetary bodies.</p>
<p id="index-2">The gravity force between two point masses is described as</p>
<div class="math notranslate nohighlight">
\[F_G =-G\frac{mM}{r^2}\hat{\mathbf{r}},\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the distance between these masses, G is a gravitational constant <span class="math notranslate nohighlight">\(G=6.674210\times 10^{-11}\)</span> m<span class="math notranslate nohighlight">\(^3\)</span>kg<span class="math notranslate nohighlight">\(^{-1}\)</span>s<span class="math notranslate nohighlight">\(^{-2}\)</span> and <span class="math notranslate nohighlight">\(\hat{\mathbf{r}}\)</span> is the unit vector in the direction of two point masses.</p>
<p>For two mutually gravitating bodies, an analytical solution to Kepler’s first law exists. The equation of motion in Cartesian coordinates is:</p>
<div class="math notranslate nohighlight">
\[-\frac{d^2\mathbf{r}}{dt^2}+\mu\frac{\mathbf{r}}{r^3}=0.\]</div>
<p>The analytical solution to this equation reveals trajectories of bodies to be of conical sections:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/conic_sections.png"><img alt="../_images/conic_sections.png" src="../_images/conic_sections.png" style="width: 300px;" /></a>
</div>
<p>For three body problem, only in restricted cases analytical solutions can be found. One of such cases is when a test particle is placed in a system that does not move with respect to the centre of mass of the system and does not rotate with respect to itself:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/restricted_three_body_problem.PNG"><img alt="../_images/restricted_three_body_problem.PNG" src="../_images/restricted_three_body_problem.PNG" style="width: 400px;" /></a>
</div>
<p>The solution to this problem reveals Lagrangian equilibrium points, where the test particle will maintain its position relative to larger bodies:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/lagrangian_points.PNG"><img alt="../_images/lagrangian_points.PNG" src="../_images/lagrangian_points.PNG" style="width: 400px;" /></a>
</div>
</div>
<div class="section" id="restricted-three-body-problem-numerical-solution">
<h2>Restricted three-body problem - numerical solution<a class="headerlink" href="#restricted-three-body-problem-numerical-solution" title="Permalink to this headline">¶</a></h2>
<p>In this notebook we will be solving a three body problem numerically using Runge-Kutta integration method. We will be solving coupled equations of motion for velocity and position:</p>
<p>\[\frac{d\mathbf{r}}{dt} = \mathbf{v},\]
\[\frac{d\mathbf{v}}{dt} = \frac{\mathbf{F}(\mathbf{r(t)})}{m},\]</p>
<p>where <span class="math notranslate nohighlight">\(\mathbf{r}\)</span> is the position vector relative to centre of mass, <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> is the velocity vector and <span class="math notranslate nohighlight">\(\mathbf{F}\)</span> is the net force on a body.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>At first, let’s define masses of our bodies, constants such as radius of planet’s orbit and position vectors with Sun placed at [0, 0]. The planet will be placed along the x-axis and the test particle will be placed at 60$^\circ$ from the Sun.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Masses of bodies in the system</span>
<span class="n">m_sun</span> <span class="o">=</span> <span class="mf">1.989</span><span class="o">*</span><span class="mf">1e30</span>
<span class="n">m_planet</span> <span class="o">=</span> <span class="mf">5.972</span><span class="o">*</span><span class="mf">1e24</span>
<span class="n">m_particle</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Constants</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">6.673210</span><span class="o">*</span><span class="mf">1e-11</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">151.99</span><span class="o">*</span><span class="mf">1e6</span><span class="o">*</span><span class="mi">1000</span>

<span class="c1"># Position vectors</span>
<span class="n">r_sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">r_planet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="o">+</span><span class="n">r_sun</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">])</span>
<span class="n">r_particle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot position vectors</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r_sun</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_sun</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sun&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r_planet</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_planet</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Earth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r_particle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_particle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test particle&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x position (km)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y position (km)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sun at [0,0]&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Keplerian_Orbits_4_0.png" src="../_images/Keplerian_Orbits_4_0.png" />
</div>
</div>
<div class="section" id="centre-of-mass-coordinate-system">
<h3>Centre of mass coordinate system<a class="headerlink" href="#centre-of-mass-coordinate-system" title="Permalink to this headline">¶</a></h3>
<p>The centre of mass of the system can be calculated with
\[R=\frac{\sum m_i r_i}{\sum m_i}.\]
We can shift the position vectors with respect to the centre of mass then:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate centre of mass</span>
<span class="c1"># Test particle has mass so small, can be omitted</span>
<span class="n">r_mass_centre</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_planet</span><span class="o">*</span><span class="n">m_planet</span><span class="o">+</span><span class="n">r_sun</span><span class="o">*</span><span class="n">m_sun</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m_planet</span><span class="o">+</span><span class="n">m_sun</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position vectors with Sun at [0, 0]:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sun:&quot;</span><span class="p">,</span> <span class="n">r_sun</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Earth:&quot;</span><span class="p">,</span> <span class="n">r_planet</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test particle:&quot;</span><span class="p">,</span> <span class="n">r_particle</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Convert into centre of mass coordinates</span>
<span class="n">r_sun</span> <span class="o">=</span> <span class="n">r_sun</span> <span class="o">-</span> <span class="n">r_mass_centre</span>
<span class="n">r_planet</span> <span class="o">=</span> <span class="n">r_planet</span> <span class="o">-</span> <span class="n">r_mass_centre</span>
<span class="n">r_particle</span> <span class="o">=</span> <span class="n">r_particle</span> <span class="o">-</span> <span class="n">r_mass_centre</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Position vectors with centre of mass at [0, 0]:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sun:&quot;</span><span class="p">,</span> <span class="n">r_sun</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Earth:&quot;</span><span class="p">,</span> <span class="n">r_planet</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test particle:&quot;</span><span class="p">,</span> <span class="n">r_particle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Position vectors with Sun at [0, 0]:
Sun: [0 0]
Earth: [1.5199e+11 0.0000e+00]
Test particle: [7.59950000e+10 1.31627201e+11]


Position vectors with centre of mass at [0, 0]:
Sun: [-456350.70622101       0.        ]
Earth: [1.51989544e+11 0.00000000e+00]
Test particle: [7.59945436e+10 1.31627201e+11]
</pre></div>
</div>
</div>
</div>
<p>The mass of Sun is so big, shifting to centre of mass coordinates is very small compared to the distance between the Sun and the Earth:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot position vectors with centre of mass at [0, 0]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r_sun</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_sun</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sun&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r_planet</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_planet</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Earth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r_particle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_particle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test particle&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x position (km)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y position (km)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Centre of mass at [0,0]&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Keplerian_Orbits_8_0.png" src="../_images/Keplerian_Orbits_8_0.png" />
</div>
</div>
</div>
<div class="section" id="initial-velocities">
<h3>Initial velocities<a class="headerlink" href="#initial-velocities" title="Permalink to this headline">¶</a></h3>
<p>Now, let’s calculate the starting velocities of each object. According to Kepler’s 3rd law, Earth’s period can be calculated as:</p>
<p>\[T^2=\frac{4\pi^2}{\mu}R^3,\quad\text{where }\mu=G(m_{Sun}+m_{Earth}).\]</p>
<p>Thus, we can calculate the angular velocity in z-direction:</p>
<p>\[\omega = \frac{2\pi}{T}=\sqrt{\frac{\mu}{R^3}}.\]</p>
<p>Recall that, velocity vector and <span class="math notranslate nohighlight">\(\mathbf{\Omega}=[0,0, \omega]\)</span> are related by relationship:</p>
<p>\[\mathbf{v}=\mathbf{\Omega}\times\mathbf{r}.\]</p>
<p>Therefore, we can calculate starting velocities of the system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate angular velocity in z-direction</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">m_planet</span><span class="o">+</span><span class="n">m_sun</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="o">/</span><span class="n">R</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Omega:&quot;</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>

<span class="c1"># Take vector cross product between omega vector and position vectors</span>
<span class="n">v_sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">omega</span><span class="p">],(</span><span class="n">r_sun</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">v_planet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">omega</span><span class="p">],(</span><span class="n">r_planet</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">v_particle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">omega</span><span class="p">],</span> <span class="p">(</span><span class="n">r_particle</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># All of them are within the same plane so third coordinate can be omitted</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sun&#39;s velocity:&quot;</span><span class="p">,</span> <span class="n">v_sun</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Planet&#39;s velocity:&quot;</span><span class="p">,</span> <span class="n">v_planet</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Particle&#39;s velocity:&quot;</span><span class="p">,</span> <span class="n">v_particle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Omega: 1.9442983920749965e-07
Sun&#39;s velocity: [-0.         -0.08872819]
Planet&#39;s velocity: [   -0.         29551.30253295]
Particle&#39;s velocity: [-25592.25554933  14775.60690238]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="gravity-force">
<h3>Gravity force<a class="headerlink" href="#gravity-force" title="Permalink to this headline">¶</a></h3>
<p>Now we can define functions that we can use to solve the equations of motion. First, let’s define gravitational force between two bodies <span class="math notranslate nohighlight">\(m_1\)</span> and <span class="math notranslate nohighlight">\(m_2\)</span>, with position vectors <span class="math notranslate nohighlight">\(\mathbf{r_1}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{r_2}\)</span> and vector between the bodies <span class="math notranslate nohighlight">\(\mathbf{r}=\mathbf{r_1}-\mathbf{r_2}\)</span>. The gravity force is calculated from:</p>
<p>\[ F_G = -G\frac{m_1 m_2}{r^2}\hat{\mathbf{r}}.\]</p>
<p>By definition <span class="math notranslate nohighlight">\(\hat{\mathbf{r}}=\frac{\mathbf{r}}{|\mathbf{r}|}\)</span>, therefore gravity force is:</p>
<p>\[ F_g = -G\frac{m_1 m_2}{r^3}\mathbf{r}.\]</p>
<p>To obtain vector’s length in Python we can use numpy function:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>np.linalg.norm(vector)
</pre></div>
</div>
<p>We can now define GravityForce() function that will return gravitational force for these bodies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="n">m2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r1</span><span class="o">-</span><span class="n">r2</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">r1</span><span class="o">-</span><span class="n">r2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="derivatives-in-the-equations-of-motion">
<h3>Derivatives in the equations of motion<a class="headerlink" href="#derivatives-in-the-equations-of-motion" title="Permalink to this headline">¶</a></h3>
<p>Now we need write a function that will calculate the derivatives in the motion equations <span class="math notranslate nohighlight">\(\frac{d\mathbf{r}}{dt}=\mathbf{v}\)</span> and <span class="math notranslate nohighlight">\(\frac{d\mathbf{v}}{dt}=\frac{\mathbf{F}(\mathbf{r}(t))}{m}\)</span>. The first one is easy, as it is the velocity vector. The second one takes the net force. For example, for Sun, the net force would be:</p>
<p>\[\mathbf{F_{Sun}}=\mathbf{F_{\text{planet on Sun}}+\mathbf{F_{\text{particle on Sun}}}}.\]</p>
<p>For easier calculations we will define a main vector:</p>
<p>\[\mathbf{y_{vector} = [r_{sun}, r_{planet}, r_{particle}, v_{sun}, v_{planet}, v_{particle}]}.\]</p>
<p>The function to calculate derivatives will take respective parts of the <span class="math notranslate nohighlight">\(\mathbf{y_{vector}}\)</span> and create an updated vector with these derivatives according to motion equations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">CalcDerivatives</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">y_vector</span><span class="p">):</span>
    
    <span class="n">r1</span> <span class="o">=</span> <span class="n">y_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">y_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r3</span> <span class="o">=</span> <span class="n">y_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">drdt_1</span> <span class="o">=</span> <span class="n">y_vector</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">drdt_2</span> <span class="o">=</span> <span class="n">y_vector</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">drdt_3</span> <span class="o">=</span> <span class="n">y_vector</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    
    <span class="n">dvdt_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">r3</span><span class="p">))</span><span class="o">/</span><span class="n">m1</span>
    <span class="n">dvdt_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">r1</span><span class="p">)</span> <span class="o">+</span> <span class="n">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">r3</span><span class="p">))</span><span class="o">/</span><span class="n">m2</span>
    <span class="n">dvdt_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span> <span class="o">+</span> <span class="n">GravityForce</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">r1</span><span class="p">))</span><span class="o">/</span><span class="n">m3</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">drdt_1</span><span class="p">,</span> <span class="n">drdt_2</span><span class="p">,</span> <span class="n">drdt_3</span><span class="p">,</span><span class="n">dvdt_1</span><span class="p">,</span> <span class="n">dvdt_2</span><span class="p">,</span> <span class="n">dvdt_3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="runge-kutta-method">
<h4>Runge-Kutta method<a class="headerlink" href="#runge-kutta-method" title="Permalink to this headline">¶</a></h4>
<p>We will use <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta method</a> method to integrate over time the position and velocity vector. The problem can be formulated as follows. We have an initial value <span class="math notranslate nohighlight">\(y(t_0)=y_0\)</span> and the derivative equation <span class="math notranslate nohighlight">\(\frac{d y}{dt}=f(t,y)\)</span>. We will iterate over <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(t\)</span> according to:</p>
<p>\[ y_{n+1}=y_n+\frac{dt}{6}\times(h_1+2\times h_2+2\times h_3+h_4),\]
\[ t_{n+1}=t_n + dt,\]</p>
<p>where <span class="math notranslate nohighlight">\(h_1,\)</span>, <span class="math notranslate nohighlight">\(h_2\)</span>, <span class="math notranslate nohighlight">\(h_3\)</span> and <span class="math notranslate nohighlight">\(h_4\)</span> are slopes at the beginning of the interval, at the midpoint using <span class="math notranslate nohighlight">\(h_1\)</span>, at the midpoint using <span class="math notranslate nohighlight">\(h_2\)</span> and at the end of interval. The graphical representation can be viewed <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Runge-Kutta_slopes.svg">here</a>.</p>
<p>The slopes are calculated according to:</p>
<p>\[h_1 = f(t_n, y_n),\]
\[h_2 = f(t_n+\frac{dt}{2}, y_n+dt\times \frac{h_1}{2}),\]
\[h_3 = f(t_n+\frac{dt}{2}, y_n + dt\times \frac{h_2}{2}),\]
\[h_4 = f(t_n+dt, y_n + dt\times h_3).\]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set y vector</span>
<span class="n">y_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_sun</span><span class="p">,</span> <span class="n">r_planet</span><span class="p">,</span> <span class="n">r_particle</span><span class="p">,</span> <span class="n">v_sun</span><span class="p">,</span> <span class="n">v_planet</span><span class="p">,</span> <span class="n">v_particle</span><span class="p">])</span>

<span class="c1"># Set initial time and period</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="p">(</span><span class="n">m_planet</span><span class="o">+</span><span class="n">m_sun</span><span class="p">))</span><span class="o">*</span><span class="n">R</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Set time step</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">period</span><span class="o">/</span><span class="mi">1000</span>

<span class="c1"># Empty lists to plot positions later</span>
<span class="n">x_positions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_positions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Create while loop</span>
<span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">:</span>
    
    <span class="c1"># Append only position parts of the y vector</span>
    <span class="n">x_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_vector</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_vector</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1"># Calculate all slopes</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">CalcDerivatives</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">m_sun</span><span class="p">,</span> <span class="n">m_planet</span><span class="p">,</span> <span class="n">m_particle</span><span class="p">,</span> <span class="n">y_vector</span><span class="p">)</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">CalcDerivatives</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">m_sun</span><span class="p">,</span> <span class="n">m_planet</span><span class="p">,</span> <span class="n">m_particle</span><span class="p">,</span> <span class="n">y_vector</span><span class="o">+</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="n">h1</span><span class="p">)</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">CalcDerivatives</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">m_sun</span><span class="p">,</span> <span class="n">m_planet</span><span class="p">,</span> <span class="n">m_particle</span><span class="p">,</span> <span class="n">y_vector</span><span class="o">+</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="n">h2</span><span class="p">)</span>
    <span class="n">h4</span> <span class="o">=</span> <span class="n">CalcDerivatives</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">m_sun</span><span class="p">,</span> <span class="n">m_planet</span><span class="p">,</span> <span class="n">m_particle</span><span class="p">,</span> <span class="n">y_vector</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">h3</span><span class="p">)</span>

    <span class="c1"># Update y vector</span>
    <span class="n">y_vector</span> <span class="o">=</span> <span class="n">y_vector</span><span class="o">+</span><span class="n">dt</span><span class="o">/</span><span class="mf">6.</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">h2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">h3</span><span class="o">+</span><span class="n">h4</span><span class="p">)</span>
    
    <span class="c1"># Update time</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span>
    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
       
<span class="n">x_positions</span><span class="p">,</span> <span class="n">y_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_positions</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="solution-in-the-intertial-frame">
<h3>Solution in the intertial frame<a class="headerlink" href="#solution-in-the-intertial-frame" title="Permalink to this headline">¶</a></h3>
<p>We can plot the trajectories in inertial frame:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>    

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
         <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sun - initial position&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
         <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test particle - starting position&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
         <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test particle - final position&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
         <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Earth - starting position&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
         <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Earth - final position&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sun trajectory&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Earth trajectory&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_positions</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">y_positions</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test particle trajectory&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x position (km)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y position (km)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Plot for $t = \frac</span><span class="si">{T}{2}</span><span class="s1">$ in the inertial frame&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Keplerian_Orbits_18_0.png" src="../_images/Keplerian_Orbits_18_0.png" />
</div>
</div>
</div>
<div class="section" id="solution-in-the-rotating-frame">
<h3>Solution in the rotating frame<a class="headerlink" href="#solution-in-the-rotating-frame" title="Permalink to this headline">¶</a></h3>
<p id="index-3">We can view the orbits in a frame where the planet is stationary. To do that we need to convert coordinates <span class="math notranslate nohighlight">\((x,y)\)</span> into rotating frame coordinates <span class="math notranslate nohighlight">\((x',y')\)</span>. The rotating coordinates can be calculated with:
\[x’ = x\cos{(-\theta)}-y\sin{(-\theta)},\]
\[y’ = x\sin{(-\theta)}+y\cos{(-\theta)},\]
where <span class="math notranslate nohighlight">\(\theta\)</span> is the angle between x-axis and position of the object we want the frame to be rotated to <span class="math notranslate nohighlight">\((x_p, y_p)\)</span> and can be calculated from <span class="math notranslate nohighlight">\(\theta=\tan^{-1}{(y_p/x_p)}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">TransformIntoRotatingFrame</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
    
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">-</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">theta</span><span class="p">),</span>
              <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>Previously we looked at a Lagranian equilibrium points. Instead, we can look at a particle placed at 45\(^\circ\) from the Sun that will create a differently shaped orbit.</p>
<div class="dropdown tip admonition">
<p class="admonition-title">Set up all variables</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Masses of bodies in the system
m_sun = 1.989*1e30
m_planet = 5.972*1e24
m_particle = 1

# Constants
G = 6.673210*1e-11
R = 151.99*1e6*1000

# Position vectors
r_sun = np.array([0,0])
r_planet = np.array([R+r_sun[0],0])
r_particle = np.array([R*np.cos(np.deg2rad(45)), R*np.sin(np.deg2rad(45))])
</pre></div>
</div>
</div>
<div class="dropdown tip admonition">
<p class="admonition-title">Calculate centre of mass and velocities</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Calculate centre of mass
# Test particle has mass so small, can be omitted
r_mass_centre = (r_planet*m_planet+r_sun*m_sun)/(m_planet+m_sun)

# Convert into centre of mass cooridantes
r_sun = r_sun - r_mass_centre
r_planet = r_planet - r_mass_centre
r_particle = r_particle - r_mass_centre


# Calculate angular velocity in z-direction
mu = G*(m_planet+m_sun)
omega = np.sqrt(mu/R**3)

# Take vector cross product between omega vector and position vectors
v_sun = np.cross([0,0,omega],(r_sun))[:-1]
v_planet = np.cross([0,0,omega],(r_planet))[:-1]
v_particle = np.cross([0,0,omega], (r_particle))[:-1]
</pre></div>
</div>
</div>
<div class="dropdown tip admonition">
<p class="admonition-title">Calculate derivatives</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Set y vector
y_vector = np.array([r_sun, r_planet, r_particle, v_sun, v_planet, v_particle])

# Set initial time and period
t = 0
period = np.sqrt(4*np.pi**2/(G*(m_planet+m_sun))*R**3)

# Set time step
dt = period/1000

# Empty lists to plot positions later
x_positions = []
y_positions = []

rot_particle_positions = []

times = []

# Create while loop
while t &lt; period:

    # Append only position parts of the y vector
    x_positions.append(y_vector[:3,0])
    y_positions.append(y_vector[:3,1])

    x = y_vector[2,0]
    y = y_vector[2,1]
    xp = y_vector[1,0]
    yp = y_vector[1,1]

    rot_particle_positions.append(TransformIntoRotatingFrame([xp, yp], [x, y]))


    # Calculate all slopes
    h1 = CalcDerivatives(t, G, m_sun, m_planet, m_particle, y_vector)
    h2 = CalcDerivatives(t+dt/2., G, m_sun, m_planet, m_particle, y_vector+dt/2.*h1)
    h3 = CalcDerivatives(t+dt/2., G, m_sun, m_planet, m_particle, y_vector+dt/2.*h2)
    h4 = CalcDerivatives(t+dt, G, m_sun, m_planet, m_particle, y_vector+dt*h3)

    # Update y vector
    y_vector = y_vector+dt/6.*(h1+2*h2+2*h3+h4)

    # Update time
    t = t + dt
    times.append(t)
</pre></div>
</div>
</div>
<div class="dropdown tip admonition">
<p class="admonition-title">Plot results in the rotating frame</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x_positions, y_positions = np.array(x_positions), np.array(y_positions)
rot_particle_positions = np.array(rot_particle_positions)

plt.figure(figsize=(7,7))    

plt.plot(x_positions[-1,0], y_positions[-1,0], &#39;*&#39;,
         color = &#39;r&#39;, mfc=&#39;w&#39;,ms=10, label=&#39;Sun&#39;)

plt.plot(x_positions[0,2], y_positions[0,2], &#39;*&#39;,
         color = &#39;b&#39;, mfc=&#39;b&#39;,ms=10, label=&#39;Test particle&#39;)


plt.plot(x_positions[0,1], y_positions[0,1], &#39;*&#39;,
         color = &#39;g&#39;, mfc=&#39;g&#39;,ms=10, label=&#39;Planet&#39;)

plt.plot(rot_particle_positions[:,0],rot_particle_positions[:,1], label=&quot;Test particle trajectory&quot;,
        color=&quot;blue&quot;, dashes=(4,2))


plt.xlabel(&#39;x position&#39;)
plt.ylabel(&#39;y position&#39;)
plt.title(r&#39;Plot for $t = T$ in rotating frame&#39;)

plt.gca().set_aspect(&#39;equal&#39;, adjustable=&#39;box&#39;)
plt.legend(loc=&#39;best&#39;, fontsize=&quot;small&quot;)

plt.show()
</pre></div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/Keplerian_Orbits_23_0.png" src="../_images/Keplerian_Orbits_23_0.png" />
</div>
</div>
<p>In the rotating frame, it looks that the particle has a tadpole orbit around Lagrangian point L4 in a very narrow band:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/Keplerian_Orbits_25_0.png" src="../_images/Keplerian_Orbits_25_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="adding-perturbations">
<h2>Adding perturbations<a class="headerlink" href="#adding-perturbations" title="Permalink to this headline">¶</a></h2>
<p>If we increase Earth’s mass by a factor of 1000, we obtain a much wider orbit:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/Keplerian_Orbits_27_0.png" src="../_images/Keplerian_Orbits_27_0.png" />
</div>
</div>
<p>Try yourself playing around with the numbers and placement of the test particle to see how the orbit can change!</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Material used in this notebook was based on lecture content of Gravity, Magnetism and Orbital Dynamics at Earth Science and Engineering Department at Imperial College London</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "primer-computational-mathematics/book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./d_geosciences"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Dynamic_Earth.html" title="previous page">Seafloor ages</a>
    <a class='right-next' id="next-link" href="Milankovitch_cycles.html" title="next page">Milankovitch cycles</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Imperial College London<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>