

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Lecture8_2D_Energy_Equation &#8212; ESE Jupyter Material</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".cell"
        const thebe_selector_input = ".cell_input div.highlight"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Remote sensing" href="../remote_sensing/intro.html" />
    <link rel="prev" title="Lecture7_Pipe_Flow_with_Heat" href="Lecture7_Pipe_Flow_with_Heat.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">ESE Jupyter Material</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../../intro.html">Landing page</a>
  </li>
  <li class="">
    <a href="../../a_modules/intro.html">Modules</a>
  </li>
  <li class="">
    <a href="../../b_coding/intro.html">Coding</a>
  </li>
  <li class="">
    <a href="../../c_mathematics/intro.html">Mathematics</a>
  </li>
  <li class="active">
    <a href="../intro.html">Geosciences</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="../1D_Heat_Conduction.html">1D heat conduction (layered medium)</a>
    </li>
    <li class="">
      <a href="../1D_Resistivity_Forward_Modelling.html">1D resistivity forward modelling</a>
    </li>
    <li class="">
      <a href="../Climate_Model.html">Climate model</a>
    </li>
    <li class="">
      <a href="../Dynamic_Earth.html">Seafloor ages</a>
    </li>
    <li class="">
      <a href="../Keplerian_Orbits.html">Keplerian orbits</a>
    </li>
    <li class="">
      <a href="../Milankovitch_cycles.html">Milankovitch cycles</a>
    </li>
    <li class="">
      <a href="../Seismology.html">Downloading earthquake data</a>
    </li>
    <li class="">
      <a href="../Tides.html">Tides</a>
    </li>
    <li class="">
      <a href="../Wave_dispersion.html">Wave dispersion</a>
    </li>
    <li class="">
      <a href="../Electromagnetism/intro.html">Electromagnetism</a>
    </li>
    <li class="active">
      <a href="intro.html">Fluid dynamics</a>
      <ul class="nav sidenav_l3">
      <li class="">
        <a href="Lecture5_1D_Pipe_Flow.html">Lecture5_1D_Pipe_Flow</a>
      </li>
      <li class="">
        <a href="Lecture6_Non_Linear_Viscosity_2D_Stokes.html">Lecture6_Non_Linear_Viscosity_2D_Stokes</a>
      </li>
      <li class="">
        <a href="Lecture7_Pipe_Flow_with_Heat.html">Lecture7_Pipe_Flow_with_Heat</a>
      </li>
      <li class="active">
        <a href="">Lecture8_2D_Energy_Equation</a>
      </li>
    </ul>
    </li>
    <li class="">
      <a href="../remote_sensing/intro.html">Remote sensing</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="../../e_extra/intro.html">Further resources</a>
  </li>
  <li class="">
    <a href="../../genindex.html">Index</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/d_geosciences/Fluid_Dynamics/Lecture8_2D_Energy_Equation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/primer-computational-mathematics/book/issues/new?title=Issue%20on%20page%20%2Fd_geosciences/Fluid_Dynamics/Lecture8_2D_Energy_Equation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/primer-computational-mathematics/book/master?urlpath=tree/notebooks/d_geosciences/Fluid_Dynamics/Lecture8_2D_Energy_Equation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#" class="nav-link">Lecture8_2D_Energy_Equation</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#navier-stoke-equation" class="nav-link">Navier-Stoke Equation</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#stress-tensor" class="nav-link">Stress Tensor</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p>(Lecture8_2D_Energy_Equation) =</p>
<div class="section" id="lecture8-2d-energy-equation">
<h1>Lecture8_2D_Energy_Equation<a class="headerlink" href="#lecture8-2d-energy-equation" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="navier-stoke-equation">
<h1>Navier-Stoke Equation<a class="headerlink" href="#navier-stoke-equation" title="Permalink to this headline">¶</a></h1>
<p>Navier-Stokes equation, in fluid mechanics, is a set of two partial differential equations that describes the flow of incompressible fluids.</p>
<div class="math notranslate nohighlight" id="equation-equation1">
<span class="eqno">(127)<a class="headerlink" href="#equation-equation1" title="Permalink to this equation">¶</a></span>\[\rho\left[\frac{\partial \vec{v}}{\partial t} + \vec{v}\cdot \nabla \vec{v}\right] = \rho g - \nabla p  +\mu \nabla^{2} \vec{v}\]</div>
<p>and</p>
<p>$<span class="math notranslate nohighlight">\(\rho (\nabla \cdot\vec{v}) = 0\)</span><span class="math notranslate nohighlight">\( (equation2) where \)</span>\rho<span class="math notranslate nohighlight">\( is density and \)</span>p<span class="math notranslate nohighlight">\( is pressure (scalars); \)</span>g<span class="math notranslate nohighlight">\( is gravity and \)</span>v$ is velocity (vectors).</p>
<p>The first equation (<a class="reference internal" href="#equation-equation1">(127)</a>) states that the motion of fluid is predominantly governed by gravity, pressure and viscosity. The second equation (<a class="reference internal" href="Lecture6_Non_Linear_Viscosity_2D_Stokes.html#equation-equation2">(79)</a>) represents the mass continuity.</p>
<p>Equation <a class="reference internal" href="#equation-equation1">(127)</a> and <a class="reference internal" href="Lecture6_Non_Linear_Viscosity_2D_Stokes.html#equation-equation2">(79)</a> is governed by and derived from the Newton’s second law of motion <a class="reference internal" href="#equation-equation3">(128)</a> and Law of Conservation of Mass (<a class="reference internal" href="#equation-equation4">(129)</a>) respectively.</p>
<div class="math notranslate nohighlight" id="equation-equation3">
<span class="eqno">(128)<a class="headerlink" href="#equation-equation3" title="Permalink to this equation">¶</a></span>\[\sum \vec{F}=m\vec{a}=\frac {m\vec{v}}{t}\]</div>
<div class="math notranslate nohighlight" id="equation-equation4">
<span class="eqno">(129)<a class="headerlink" href="#equation-equation4" title="Permalink to this equation">¶</a></span>\[\dot{m}_{in} = \dot{m}_{out}\]</div>
<p>The mass continuity equation is easy to obtain by equating all the mass flow rates into and out of the differential control volume. Hence, the following derivation is focused solely on the governing equation (<a class="reference internal" href="#equation-equation1">(127)</a>). We can start from the Newton’s second law of motion:</p>
<p>$<span class="math notranslate nohighlight">\(\sum \vec{F}= \vec{F_{p}}+\vec{F_{v}}+\vec{F_{g}} =m\vec{a}\)</span><span class="math notranslate nohighlight">\((equation5) where \)</span>\vec{F_{p}}<span class="math notranslate nohighlight">\( is force due to pressure and \)</span>\vec{F_{v}}<span class="math notranslate nohighlight">\( is force due to viscosity; they are known as the internal forces. There are many external forces due to gravity, electromagnetism and etc. However, we consider the gravity \)</span>\vec{F_{g}}$  as the only external force for simplicity.</p>
<p>The equation is developed by summing up the forces of an infinitesimal control volume V (<span class="math notranslate nohighlight">\(V=d_{x}d_{y}d_{z}\)</span>) in Cartesian coordinate system, and setting the result equal to <span class="math notranslate nohighlight">\(m\vec{a}\)</span>. This is demonstrated in the figure below.</p>
<img src='img/controlVolume3.PNG' width = 500>
Figure 1:Infinitesimal control volume V (left) and Cartesian coordinate system (right). Examples of stresses acting on different planes and directions are also shown. <p>We define x-planes are the planes that are perpendicular to x-axis; As shown above, we can see that
longitudinal stress <span class="math notranslate nohighlight">\(\sigma_{xx}\)</span> represents the stress that acts on <span class="math notranslate nohighlight">\(x-plane\)</span> in the direction of <span class="math notranslate nohighlight">\(x-axis\)</span>;
shear stress <span class="math notranslate nohighlight">\(\tau_{xy} \)</span> represents the stress that acts on <span class="math notranslate nohighlight">\(x-plane\)</span> in the direction of <span class="math notranslate nohighlight">\(y-axis\)</span>. <span class="math notranslate nohighlight">\(\langle\sigma_{xx} \rangle(x+dx)\)</span> is the longitudinal stress acting on <span class="math notranslate nohighlight">\(x-plane\)</span> at <span class="math notranslate nohighlight">\(x+dx\)</span>.</p>
<p>Due to the redundancy in 3D derivation, we shall analysis the stresses just in x-direction and conclude the resulting equation hold true for the other two directions by symmetry. Figure 2 shows the stresses in x-direction only.</p>
<img src='img/stresses_x_axis1.PNG' width=700>
Figure 2: Longitudinal stresses ($\sigma_{xx}$) in (a) and shear stresses ($\tau_{xy} $) in (b) \& (c) in x-direction from six planes. Shear stresses are due to viscosity and longitudinal stresses are created by pressure.<p>Note that the longitudinal stresses <span class="math notranslate nohighlight">\(\sigma_{xx}\)</span> acting on two x-planes are not the same. We can apply Taylor Series to interpolate the <span class="math notranslate nohighlight">\(\sigma_{xx}\)</span> evaluated at <span class="math notranslate nohighlight">\(x+dx\)</span> based on the value of <span class="math notranslate nohighlight">\(\sigma_{xx}\)</span> at <span class="math notranslate nohighlight">\(x\)</span>:</p>
<p>$<span class="math notranslate nohighlight">\(\langle\sigma_{xx} \rangle(x+dx) = \sigma_{xx}(x) + \frac{\partial \langle\sigma_{xx}\rangle(x)}{\partial x}\cdot dx \)</span><span class="math notranslate nohighlight">\( (equation6) where \)</span>\tau_{yx}(y+dy)<span class="math notranslate nohighlight">\( and \)</span>\tau_{zx}(z+dz)$ can be expressed by the same logic.</p>
<p>Once we obtain the stress and pressure, we can get the force by multiplying the surface area (<span class="math notranslate nohighlight">\(A=dx dy=dx dz= dy dz\)</span>):</p>
<div class="math notranslate nohighlight" id="equation-equation7">
<span class="eqno">(130)<a class="headerlink" href="#equation-equation7" title="Permalink to this equation">¶</a></span>\[F_i^x = A(-\sigma_{xx}(x)+\langle\sigma_{xx} \rangle(x+dx)-\tau_{yx}(y)+\langle\tau_{yx} \rangle(y+dy)-\tau_{zx}(z)+\langle\tau_{zx} \rangle(z+dz))\]</div>
<p>Plugging in <a class="reference internal" href="Lecture7_Pipe_Flow_with_Heat.html#equation-equation6">(112)</a> into <a class="reference internal" href="#equation-equation7">(130)</a> to replace <span class="math notranslate nohighlight">\(\langle\sigma_{xx} \rangle(x+dx)\)</span>, we have</p>
<p>$<span class="math notranslate nohighlight">\(F_i^x = A(\frac{\partial \sigma_{xx}(x) }{\partial x}\cdot dx+\frac{\partial \tau_{yx}(y) }{\partial y}\cdot dy+\frac{\partial \tau_{zx}(z) }{\partial z}\cdot dz) = V(\frac{\partial \sigma_{xx}(x) }{\partial x} +\frac{\partial \tau_{yx}(y) }{\partial y}+\frac{\partial \tau_{zx}(z) }{\partial z})=ma\)</span><span class="math notranslate nohighlight">\( (equation8) since \)</span>V=dxdydz$</p>
<p>Dividing <span class="math notranslate nohighlight">\(V\)</span> at the both sides, we have</p>
<div class="math notranslate nohighlight" id="equation-equation9">
<span class="eqno">(131)<a class="headerlink" href="#equation-equation9" title="Permalink to this equation">¶</a></span>\[\frac{\partial \sigma_{xx}(x) }{\partial x} +\frac{\partial \tau_{yx}(y) }{\partial y}+\frac{\partial \tau_{zx}(z) }{\partial z} = \frac{m}{V}a = \rho \cdot \frac{Du}{Dt}\]</div>
<p>Now, the question becomes how to express normal stress <span class="math notranslate nohighlight">\(\sigma_{xx}\)</span> and shear stress <span class="math notranslate nohighlight">\(\tau_{yx}\)</span> and <span class="math notranslate nohighlight">\(\tau_{zx}\)</span>?</p>
</div>
<div class="section" id="stress-tensor">
<h1>Stress Tensor<a class="headerlink" href="#stress-tensor" title="Permalink to this headline">¶</a></h1>
<p>Let’s consider the shear stress <span class="math notranslate nohighlight">\(\tau\)</span> in a 2d problem</p>
<img src='img/shear_stress.PNG' width=700>
Figure 3<p>If we assume the change of angle <span class="math notranslate nohighlight">\(\delta \alpha\)</span> (strain) is tiny, then we can say that</p>
<p>$<span class="math notranslate nohighlight">\(\delta \alpha \approx tan(\delta \alpha) = \frac{\delta x}{dy} =\frac{(u_0 - (u_0+\delta u))\cdot dt}{dy}=\frac{\delta u dt}{dy}\)</span><span class="math notranslate nohighlight">\( (equation10) where \)</span>u_0$ is the original horizontal velocity of the block.</p>
<p>We can define the rate of the change of the angle <span class="math notranslate nohighlight">\(\delta \alpha\)</span> as strain rate (<span class="math notranslate nohighlight">\(\frac{\delta \alpha}{dt}\)</span>)</p>
<div class="math notranslate nohighlight" id="equation-equation11">
<span class="eqno">(132)<a class="headerlink" href="#equation-equation11" title="Permalink to this equation">¶</a></span>\[\frac{\delta \alpha}{dt}=\frac{\delta u dt}{dy dt}=\frac{du}{dy}\]</div>
<p>Same logic applies to the rate of change of angle <span class="math notranslate nohighlight">\(\beta\)</span></p>
<div class="math notranslate nohighlight" id="equation-equation12">
<span class="eqno">(133)<a class="headerlink" href="#equation-equation12" title="Permalink to this equation">¶</a></span>\[\frac{\delta \beta}{dt}=\frac{\delta v dt}{dx dt}=\frac{dv}{dx}\]</div>
<p>So the total rate of change of angle (<span class="math notranslate nohighlight">\(\alpha+\beta\)</span>) is</p>
<div class="math notranslate nohighlight" id="equation-equation13">
<span class="eqno">(134)<a class="headerlink" href="#equation-equation13" title="Permalink to this equation">¶</a></span>\[\frac{(\delta \alpha + \delta \beta)}{dt} = \frac{du}{dy}+\frac{dv}{dx}\]</div>
<p>Open Anaconda Prompt (anaconda 3), then type</p>
<p>pip install ipyvolume</p>
<p>pip install bqplot</p>
<p>jupyter nbextension enable –py bqplot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#from ipywebrtc import CameraStream, ImageRecorder</span>
<span class="c1">#import ipywebrtc as webrtc</span>
<span class="c1">#camera = webrtc.CameraStream()</span>
<span class="c1">#camera</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#widgets.Widget.close_all()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#chatroom=webrtc.chat(room=&#39;scipy2018b&#39;,stream=fig)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipyvolume</span> <span class="k">as</span> <span class="nn">ipv</span>
<span class="kn">import</span> <span class="nn">bqplot.scales</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>    <span class="c1"># https://www.youtube.com/watch?v=hOKa8klJPyo</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>    <span class="c1"># for coloring temperature</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">9.8</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]);</span> <span class="c1"># external (gravitational) forces</span>
<span class="n">REST_DENS</span> <span class="o">=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="c1"># rest density of liquid</span>
<span class="n">GAS_CONST</span> <span class="o">=</span> <span class="mf">2000.0</span><span class="p">;</span> <span class="c1"># const for equation of state</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">;</span> <span class="c1"># kernel radius</span>
<span class="n">HSQ</span> <span class="o">=</span> <span class="n">H</span><span class="o">*</span><span class="n">H</span><span class="p">;</span> <span class="c1"># radius^2 for optimization</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mf">1.0</span>    <span class="c1"># initial temperature of the fluid</span>
<span class="n">T_bottom</span> <span class="o">=</span> <span class="mf">1.5</span>    <span class="c1"># bottom heating temperature</span>
<span class="n">T_ceiling</span> <span class="o">=</span> <span class="mf">0.5</span>    <span class="c1"># upper cooling temperature</span>
<span class="n">alpha_v</span> <span class="o">=</span> <span class="mf">0.0002</span>    <span class="c1"># thermal expansion coefficient</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">0.0003</span>    <span class="c1"># thermal conductivity of the particle</span>
<span class="n">k_wall</span> <span class="o">=</span> <span class="mf">100.0</span>    <span class="c1"># thermal conductivity of the wall</span>
<span class="n">MASS</span> <span class="o">=</span> <span class="mf">65.0</span><span class="p">;</span> <span class="c1"># assume all particles have the same mass</span>
<span class="n">VISC</span> <span class="o">=</span> <span class="mf">250.0</span><span class="p">;</span> <span class="c1"># viscosity constant</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0008</span><span class="p">;</span> <span class="c1"># integration timestep</span>

<span class="c1"># smoothing kernels defined in Müller and their gradients</span>
<span class="n">POLY6</span> <span class="o">=</span> <span class="mf">315.0</span><span class="o">/</span><span class="p">(</span><span class="mf">65.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">H</span><span class="o">**</span><span class="mi">9</span><span class="p">);</span>
<span class="n">SPIKY_GRAD</span> <span class="o">=</span> <span class="o">-</span><span class="mf">45.0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">H</span><span class="o">**</span><span class="mi">6</span><span class="p">);</span>
<span class="n">VISC_LAP</span> <span class="o">=</span> <span class="mf">45.0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">H</span><span class="o">**</span><span class="mi">6</span><span class="p">);</span>

<span class="c1"># simulation parameters</span>
<span class="n">EPS</span> <span class="o">=</span> <span class="n">H</span><span class="p">;</span> <span class="c1"># boundary epsilon</span>
<span class="n">BOUND_DAMPING_NORMAL</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">;</span>    <span class="c1"># particle does not bounce back vertically</span>
<span class="n">BOUND_DAMPING_HORIZONTAL</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>    <span class="c1"># no slip-boundary</span>

<span class="c1"># solver data</span>
<span class="n">Fluid_Particles_list</span> <span class="o">=</span> <span class="p">[];</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[[],[],[]]</span>    <span class="c1"># positions for all particles</span>
<span class="n">Ts</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># temperature of all particles</span>

<span class="c1"># interaction</span>
<span class="n">MAX_PARTICLES</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>

<span class="c1"># rendering projection parameters</span>
<span class="n">WINDOW_WIDTH</span> <span class="o">=</span> <span class="mi">425</span><span class="p">;</span>
<span class="n">WINDOW_HEIGHT</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
<span class="n">WINDOW_DEPTH</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">VIEW_WIDTH</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">WINDOW_WIDTH</span><span class="p">;</span>
<span class="n">VIEW_HEIGHT</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">WINDOW_HEIGHT</span><span class="p">;</span>
<span class="n">VIEW_DEPTH</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">WINDOW_DEPTH</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># particle data structure</span>
<span class="c1"># stores position, velocity, and force for integration</span>
<span class="c1"># stores density (rho) and pressure values for SPH</span>
<span class="k">class</span> <span class="nc">Particle</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>   <span class="c1"># x position vector</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span>    <span class="c1"># velocity vector</span>
      
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>    <span class="c1"># force vector</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># density of the fluid at the position of the particle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>    <span class="c1"># pressure of the fluid at the position of the particle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T0</span>    <span class="c1"># temperature of the fluid at the position of the particle</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">InitSPH</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">X</span>
    <span class="k">global</span> <span class="n">fig</span>
    <span class="k">global</span> <span class="n">scatter</span>
    <span class="k">global</span> <span class="n">ipv</span>
    <span class="k">global</span> <span class="n">Ts</span>
    
    <span class="c1">#for zi in range(int(2*EPS),int(WINDOW_DEPTH-EPS*2.0),int(H)):</span>
        <span class="c1">#zi += H</span>
    <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">EPS</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">WINDOW_HEIGHT</span><span class="o">-</span><span class="n">EPS</span><span class="o">*</span><span class="mf">1.0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">16</span><span class="p">)):</span>
        <span class="n">yi</span> <span class="o">+=</span> <span class="n">H</span> <span class="c1">#+random.rand()*H/1000</span>
        <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">WINDOW_WIDTH</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">H</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Fluid_Particles_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_PARTICLES</span><span class="p">:</span>
                <span class="n">xi</span> <span class="o">+=</span> <span class="n">H</span> <span class="c1">#+random.rand()*H/1000</span>

                <span class="n">Vx</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># gives the particle a random tiny initial velocity in the x-direction</span>
                <span class="n">Vy</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># gives the particle a random tiny initial velocity in the y-direction</span>
                <span class="n">Vz</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Vx</span><span class="p">,</span><span class="n">Vy</span><span class="p">,</span><span class="n">Vz</span><span class="p">])</span>
                
                <span class="n">Fx</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># gives the particle a random tiny initial force in the x-direction</span>
                <span class="n">Fy</span> <span class="o">=</span> <span class="mf">0.0</span>    <span class="c1"># gives the particle a random tiny initial force in the y-direction</span>
                <span class="n">Fz</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Fx</span><span class="p">,</span><span class="n">Fy</span><span class="p">,</span><span class="n">Fz</span><span class="p">])</span>
                
                <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">T0</span>

                <span class="n">zi</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">EPS</span>
                
                <span class="n">Xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span><span class="n">yi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">(),</span><span class="n">zi</span><span class="p">])</span><span class="c1"># + np.random.random_sample()</span>
                
                <span class="n">Fluid_Particles_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Particle</span><span class="p">(</span><span class="n">Xi</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
          
        <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">Ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">]))</span> 
        
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="c1"># the scale does not seem to work...</span>
    <span class="n">scales</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">bqplot</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">LinearScale</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">VIEW_WIDTH</span><span class="p">),</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">bqplot</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">LinearScale</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">VIEW_HEIGHT</span><span class="p">),</span>
    <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">bqplot</span><span class="o">.</span><span class="n">scales</span><span class="o">.</span><span class="n">LinearScale</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">VIEW_DEPTH</span><span class="p">),</span>
<span class="p">}</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">ipv</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">scales</span><span class="o">=</span><span class="n">scales</span><span class="p">)</span>
    <span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ts</span><span class="p">)</span>
    <span class="n">Ts</span> <span class="o">-=</span> <span class="n">Ts</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">Ts</span> <span class="o">/=</span> <span class="n">Ts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">Ts</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ipv</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
    
    <span class="n">scatter</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="n">ipv</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initializing dam break with &quot;</span> <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;particles&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ComputeDensityPressureTemperature</span><span class="p">():</span>
    
    <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
        <span class="n">pi</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">dT</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">pj</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">pj</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">h</span><span class="o">&lt;</span><span class="n">H</span><span class="p">):</span>
                <span class="n">pi</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span><span class="n">POLY6</span><span class="o">*</span><span class="p">(</span><span class="n">HSQ</span><span class="o">-</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">;</span>
                <span class="n">pi</span><span class="o">.</span><span class="n">rho</span> <span class="o">+=</span> <span class="n">MASS</span><span class="o">*</span><span class="n">POLY6</span><span class="o">*</span><span class="p">(</span><span class="n">HSQ</span><span class="o">-</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">;</span>
        
        <span class="n">pi</span><span class="o">.</span><span class="n">rho</span> <span class="o">-=</span> <span class="n">pi</span><span class="o">.</span><span class="n">rho</span> <span class="o">*</span> <span class="n">alpha_v</span> <span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span>
        <span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">GAS_CONST</span><span class="o">*</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">rho</span> <span class="o">-</span> <span class="n">REST_DENS</span><span class="p">)</span> <span class="o">*</span> <span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ComputeForces</span><span class="p">():</span>
    
    <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
        
        <span class="n">fpress</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">fvisc</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">pj</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
            
            <span class="n">d</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">X</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">h</span>

            
            <span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">==</span><span class="n">pj</span><span class="p">):</span>
                <span class="k">continue</span><span class="p">;</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">h</span><span class="o">&lt;</span><span class="n">H</span><span class="p">):</span>
                
                <span class="c1"># compute pressure force contribution</span>
                <span class="n">fpress</span> <span class="o">+=</span> <span class="o">-</span> <span class="n">r</span> <span class="o">*</span> <span class="n">MASS</span> <span class="o">*</span> <span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="n">pj</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pj</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>  <span class="o">*</span> <span class="n">SPIKY_GRAD</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span><span class="o">-</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
              
                <span class="c1"># compute viscosity force contribution</span>
                <span class="n">fvisc</span> <span class="o">+=</span> <span class="n">VISC</span> <span class="o">*</span> <span class="n">MASS</span> <span class="o">*</span> <span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">V</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pj</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>  <span class="o">*</span> <span class="n">VISC_LAP</span> <span class="o">*</span> <span class="p">(</span><span class="n">H</span><span class="o">-</span><span class="n">h</span><span class="p">);</span>
            

        <span class="n">fgrav</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">pi</span><span class="o">.</span><span class="n">rho</span>
        <span class="n">pi</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">fpress</span> <span class="o">+</span> <span class="n">fvisc</span> <span class="o">+</span> <span class="n">fgrav</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Integrate</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
        <span class="c1"># forward Euler integration</span>
        <span class="n">p</span><span class="o">.</span><span class="n">V</span> <span class="o">+=</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">F</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">rho</span><span class="p">;</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">X</span> <span class="o">+=</span> <span class="n">dt</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">;</span>
  
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">EPS</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>    <span class="c1"># left boundary condition</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="c1">#BOUND_DAMPING_NORMAL</span>
            <span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">WINDOW_WIDTH</span> <span class="o">-</span> <span class="n">EPS</span>    <span class="c1"># coming out from the right boundary</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_HORIZONTAL</span>
            <span class="c1">#p.Vz *= BOUND_DAMPING_HORIZONTAL</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">EPS</span> <span class="o">&gt;</span> <span class="n">WINDOW_WIDTH</span><span class="p">):</span>    <span class="c1"># right boundary condition</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="c1">#BOUND_DAMPING_NORMAL</span>
            <span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPS</span>    <span class="c1"># coming out from the left boundary</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_HORIZONTAL</span>
            <span class="c1">#p.Vz *= BOUND_DAMPING_HORIZONTAL</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">EPS</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>    <span class="c1"># bottom boundary condition</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_NORMAL</span>
            <span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPS</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_HORIZONTAL</span>
            
            <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="p">(</span><span class="n">T_bottom</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">k_wall</span> <span class="o">*</span> <span class="n">dt</span>    <span class="c1"># heating from the bottom</span>
            <span class="c1">#p.Vz *= BOUND_DAMPING_HORIZONTAL</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">EPS</span> <span class="o">&gt;</span> <span class="n">WINDOW_HEIGHT</span><span class="p">):</span>    <span class="c1"># upper boundary condition</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_NORMAL</span>
            <span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">WINDOW_HEIGHT</span> <span class="o">-</span> <span class="n">EPS</span> 
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_HORIZONTAL</span>
            
            <span class="n">p</span><span class="o">.</span><span class="n">T</span> <span class="o">+=</span> <span class="p">(</span><span class="n">T_ceiling</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">k_wall</span> <span class="o">*</span> <span class="n">dt</span>    <span class="c1"># cooling from the ceiling</span>
            <span class="c1">#p.Vz *= BOUND_DAMPING_HORIZONTAL</span>
         
        <span class="c1"># only for 3D boundary condition (in the z-direction)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">EPS</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>    <span class="c1"># front boundary condition</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_NORMAL</span>
            <span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">EPS</span>
            <span class="c1">#p.Vx *= BOUND_DAMPING_HORIZONTAL</span>
            <span class="c1">#p.Vy *= BOUND_DAMPING_HORIZONTAL</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">EPS</span> <span class="o">&gt;</span> <span class="n">WINDOW_DEPTH</span><span class="p">):</span>    <span class="c1"># back boundary condition</span>
            <span class="n">p</span><span class="o">.</span><span class="n">V</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">BOUND_DAMPING_NORMAL</span>
            <span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">WINDOW_DEPTH</span> <span class="o">-</span> <span class="n">EPS</span> 
            <span class="c1">#p.Vx *= BOUND_DAMPING_HORIZONTAL</span>
            <span class="c1">#p.Vy *= BOUND_DAMPING_HORIZONTAL</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Update</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start updating&quot;</span><span class="p">)</span>
    <span class="n">ComputeDensityPressureTemperature</span><span class="p">()</span>
    <span class="n">ComputeForces</span><span class="p">()</span>
    <span class="n">Integrate</span><span class="p">()</span>    
    <span class="n">x</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">z</span> <span class="o">=</span><span class="p">[]</span>
    <span class="n">Ts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">Fluid_Particles_list</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pi</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">Ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">pi</span><span class="o">.</span><span class="n">T</span><span class="p">]))</span> 
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Ts</span><span class="p">:</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">&gt;</span> <span class="n">max_</span><span class="p">):</span>
            <span class="n">max_</span> <span class="o">=</span> <span class="n">temperature</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">&lt;</span> <span class="n">min_</span><span class="p">):</span>
            <span class="n">min_</span> <span class="o">=</span> <span class="n">temperature</span>

            
    <span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ts</span><span class="p">)</span>
    <span class="n">Ts</span> <span class="o">-=</span> <span class="n">Ts</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">Ts</span> <span class="o">/=</span> <span class="n">Ts</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">Ts</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">scatter</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">InitSPH</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\JianouJiang\anaconda3\lib\site-packages\ipykernel_launcher.py:57: RuntimeWarning: invalid value encountered in true_divide
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d5795cb08ee5497bbfde11d8734e6008", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>initializing dam break with 
3000
particles
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TotalTime</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">TotalTime</span><span class="o">/</span><span class="n">DT</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start iterating&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
    <span class="n">Update</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;iterations&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>start iterating
start updating
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\JianouJiang\anaconda3\lib\site-packages\ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in true_divide
  if sys.path[0] == &#39;&#39;:
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterations
0
start updating
iterations
1
start updating
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\JianouJiang\anaconda3\lib\site-packages\ipykernel_launcher.py:4: RuntimeWarning: invalid value encountered in true_divide
  after removing the cwd from sys.path.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterations
2
start updating
iterations
3
start updating
iterations
4
start updating
iterations
5
start updating
iterations
6
start updating
iterations
7
start updating
iterations
8
start updating
iterations
9
start updating
iterations
10
start updating
iterations
11
start updating
iterations
12
start updating
iterations
13
start updating
iterations
14
start updating
iterations
15
start updating
iterations
16
start updating
iterations
17
start updating
iterations
18
start updating
iterations
19
start updating
iterations
20
start updating
iterations
21
start updating
iterations
22
start updating
iterations
23
start updating
iterations
24
start updating
iterations
25
start updating
iterations
26
start updating
iterations
27
start updating
iterations
28
start updating
iterations
29
start updating
iterations
30
start updating
iterations
31
start updating
iterations
32
start updating
iterations
33
start updating
iterations
34
start updating
iterations
35
start updating
iterations
36
start updating
iterations
37
start updating
iterations
38
start updating
iterations
39
start updating
iterations
40
start updating
iterations
41
start updating
iterations
42
start updating
iterations
43
start updating
iterations
44
start updating
iterations
45
start updating
iterations
46
start updating
iterations
47
start updating
iterations
48
start updating
iterations
49
start updating
iterations
50
start updating
iterations
51
start updating
iterations
52
start updating
iterations
53
start updating
iterations
54
start updating
iterations
55
start updating
iterations
56
start updating
iterations
57
start updating
iterations
58
start updating
iterations
59
start updating
iterations
60
start updating
iterations
61
start updating
iterations
62
start updating
iterations
63
start updating
iterations
64
start updating
iterations
65
start updating
iterations
66
start updating
iterations
67
start updating
iterations
68
start updating
iterations
69
start updating
iterations
70
start updating
iterations
71
start updating
iterations
72
start updating
iterations
73
start updating
iterations
74
start updating
iterations
75
start updating
iterations
76
start updating
iterations
77
start updating
iterations
78
start updating
iterations
79
start updating
iterations
80
start updating
iterations
81
start updating
iterations
82
start updating
iterations
83
start updating
iterations
84
start updating
iterations
85
start updating
iterations
86
start updating
iterations
87
start updating
iterations
88
start updating
iterations
89
start updating
iterations
90
start updating
iterations
91
start updating
iterations
92
start updating
iterations
93
start updating
iterations
94
start updating
iterations
95
start updating
iterations
96
start updating
iterations
97
start updating
iterations
98
start updating
iterations
99
start updating
iterations
100
start updating
iterations
101
start updating
iterations
102
start updating
iterations
103
start updating
iterations
104
start updating
iterations
105
start updating
iterations
106
start updating
iterations
107
start updating
iterations
108
start updating
iterations
109
start updating
iterations
110
start updating
iterations
111
start updating
iterations
112
start updating
iterations
113
start updating
iterations
114
start updating
iterations
115
start updating
iterations
116
start updating
iterations
117
start updating
iterations
118
start updating
iterations
119
start updating
iterations
120
start updating
iterations
121
start updating
iterations
122
start updating
iterations
123
start updating
iterations
124
start updating
iterations
125
start updating
iterations
126
start updating
iterations
127
start updating
iterations
128
start updating
iterations
129
start updating
iterations
130
start updating
iterations
131
start updating
iterations
132
start updating
iterations
133
start updating
iterations
134
start updating
iterations
135
start updating
iterations
136
start updating
iterations
137
start updating
iterations
138
start updating
iterations
139
start updating
iterations
140
start updating
iterations
141
start updating
iterations
142
start updating
iterations
143
start updating
iterations
144
start updating
iterations
145
start updating
iterations
146
start updating
iterations
147
start updating
iterations
148
start updating
iterations
149
start updating
iterations
150
start updating
iterations
151
start updating
iterations
152
start updating
iterations
153
start updating
iterations
154
start updating
iterations
155
start updating
iterations
156
start updating
iterations
157
start updating
iterations
158
start updating
iterations
159
start updating
iterations
160
start updating
iterations
161
start updating
iterations
162
start updating
iterations
163
start updating
iterations
164
start updating
iterations
165
start updating
iterations
166
start updating
iterations
167
start updating
iterations
168
start updating
iterations
169
start updating
iterations
170
start updating
iterations
171
start updating
iterations
172
start updating
iterations
173
start updating
iterations
174
start updating
iterations
175
start updating
iterations
176
start updating
iterations
177
start updating
iterations
178
start updating
iterations
179
start updating
iterations
180
start updating
iterations
181
start updating
iterations
182
start updating
iterations
183
start updating
iterations
184
start updating
iterations
185
start updating
iterations
186
start updating
iterations
187
start updating
iterations
188
start updating
iterations
189
start updating
iterations
190
start updating
iterations
191
start updating
iterations
192
start updating
iterations
193
start updating
iterations
194
start updating
iterations
195
start updating
iterations
196
start updating
iterations
197
start updating
iterations
198
start updating
iterations
199
start updating
iterations
200
start updating
iterations
201
start updating
iterations
202
start updating
iterations
203
start updating
iterations
204
start updating
iterations
205
start updating
iterations
206
start updating
iterations
207
start updating
iterations
208
start updating
iterations
209
start updating
iterations
210
start updating
iterations
211
start updating
iterations
212
start updating
iterations
213
start updating
iterations
214
start updating
iterations
215
start updating
iterations
216
start updating
iterations
217
start updating
iterations
218
start updating
iterations
219
start updating
iterations
220
start updating
iterations
221
start updating
iterations
222
start updating
iterations
223
start updating
iterations
224
start updating
iterations
225
start updating
iterations
226
start updating
iterations
227
start updating
iterations
228
start updating
iterations
229
start updating
iterations
230
start updating
iterations
231
start updating
iterations
232
start updating
iterations
233
start updating
iterations
234
start updating
iterations
235
start updating
iterations
236
start updating
iterations
237
start updating
iterations
238
start updating
iterations
239
start updating
iterations
240
start updating
iterations
241
start updating
iterations
242
start updating
iterations
243
start updating
iterations
244
start updating
iterations
245
start updating
iterations
246
start updating
iterations
247
start updating
iterations
248
start updating
iterations
249
start updating
iterations
250
start updating
iterations
251
start updating
iterations
252
start updating
iterations
253
start updating
iterations
254
start updating
iterations
255
start updating
iterations
256
start updating
iterations
257
start updating
iterations
258
start updating
iterations
259
start updating
iterations
260
start updating
iterations
261
start updating
iterations
262
start updating
iterations
263
start updating
iterations
264
start updating
iterations
265
start updating
iterations
266
start updating
iterations
267
start updating
iterations
268
start updating
iterations
269
start updating
iterations
270
start updating
iterations
271
start updating
iterations
272
start updating
iterations
273
start updating
iterations
274
start updating
iterations
275
start updating
iterations
276
start updating
iterations
277
start updating
iterations
278
start updating
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterations
279
start updating
iterations
280
start updating
iterations
281
start updating
iterations
282
start updating
iterations
283
start updating
iterations
284
start updating
iterations
285
start updating
iterations
286
start updating
iterations
287
start updating
iterations
288
start updating
iterations
289
start updating
iterations
290
start updating
iterations
291
start updating
iterations
292
start updating
iterations
293
start updating
iterations
294
start updating
iterations
295
start updating
iterations
296
start updating
iterations
297
start updating
iterations
298
start updating
iterations
299
start updating
iterations
300
start updating
iterations
301
start updating
iterations
302
start updating
iterations
303
start updating
iterations
304
start updating
iterations
305
start updating
iterations
306
start updating
iterations
307
start updating
iterations
308
start updating
iterations
309
start updating
iterations
310
start updating
iterations
311
start updating
iterations
312
start updating
iterations
313
start updating
iterations
314
start updating
iterations
315
start updating
iterations
316
start updating
iterations
317
start updating
iterations
318
start updating
iterations
319
start updating
iterations
320
start updating
iterations
321
start updating
iterations
322
start updating
iterations
323
start updating
iterations
324
start updating
iterations
325
start updating
iterations
326
start updating
iterations
327
start updating
iterations
328
start updating
iterations
329
start updating
iterations
330
start updating
iterations
331
start updating
iterations
332
start updating
iterations
333
start updating
iterations
334
start updating
iterations
335
start updating
iterations
336
start updating
iterations
337
start updating
iterations
338
start updating
iterations
339
start updating
iterations
340
start updating
iterations
341
start updating
iterations
342
start updating
iterations
343
start updating
iterations
344
start updating
iterations
345
start updating
iterations
346
start updating
iterations
347
start updating
iterations
348
start updating
iterations
349
start updating
iterations
350
start updating
iterations
351
start updating
iterations
352
start updating
iterations
353
start updating
iterations
354
start updating
iterations
355
start updating
iterations
356
start updating
iterations
357
start updating
iterations
358
start updating
iterations
359
start updating
iterations
360
start updating
iterations
361
start updating
iterations
362
start updating
iterations
363
start updating
iterations
364
start updating
iterations
365
start updating
iterations
366
start updating
iterations
367
start updating
iterations
368
start updating
iterations
369
start updating
iterations
370
start updating
iterations
371
start updating
iterations
372
start updating
iterations
373
start updating
iterations
374
start updating
iterations
375
start updating
iterations
376
start updating
iterations
377
start updating
iterations
378
start updating
iterations
379
start updating
iterations
380
start updating
iterations
381
start updating
iterations
382
start updating
iterations
383
start updating
iterations
384
start updating
iterations
385
start updating
iterations
386
start updating
iterations
387
start updating
iterations
388
start updating
iterations
389
start updating
iterations
390
start updating
iterations
391
start updating
iterations
392
start updating
iterations
393
start updating
iterations
394
start updating
iterations
395
start updating
iterations
396
start updating
iterations
397
start updating
iterations
398
start updating
iterations
399
start updating
iterations
400
start updating
iterations
401
start updating
iterations
402
start updating
iterations
403
start updating
iterations
404
start updating
iterations
405
start updating
iterations
406
start updating
iterations
407
start updating
iterations
408
start updating
iterations
409
start updating
iterations
410
start updating
iterations
411
start updating
iterations
412
start updating
iterations
413
start updating
iterations
414
start updating
iterations
415
start updating
iterations
416
start updating
iterations
417
start updating
iterations
418
start updating
iterations
419
start updating
iterations
420
start updating
iterations
421
start updating
iterations
422
start updating
iterations
423
start updating
iterations
424
start updating
iterations
425
start updating
iterations
426
start updating
iterations
427
start updating
iterations
428
start updating
iterations
429
start updating
iterations
430
start updating
iterations
431
start updating
iterations
432
start updating
iterations
433
start updating
iterations
434
start updating
iterations
435
start updating
iterations
436
start updating
iterations
437
start updating
iterations
438
start updating
iterations
439
start updating
iterations
440
start updating
iterations
441
start updating
iterations
442
start updating
iterations
443
start updating
iterations
444
start updating
iterations
445
start updating
iterations
446
start updating
iterations
447
start updating
iterations
448
start updating
iterations
449
start updating
iterations
450
start updating
iterations
451
start updating
iterations
452
start updating
iterations
453
start updating
iterations
454
start updating
iterations
455
start updating
iterations
456
start updating
iterations
457
start updating
iterations
458
start updating
iterations
459
start updating
iterations
460
start updating
iterations
461
start updating
iterations
462
start updating
iterations
463
start updating
iterations
464
start updating
iterations
465
start updating
iterations
466
start updating
iterations
467
start updating
iterations
468
start updating
iterations
469
start updating
iterations
470
start updating
iterations
471
start updating
iterations
472
start updating
iterations
473
start updating
iterations
474
start updating
iterations
475
start updating
iterations
476
start updating
iterations
477
start updating
iterations
478
start updating
iterations
479
start updating
iterations
480
start updating
iterations
481
start updating
iterations
482
start updating
iterations
483
start updating
iterations
484
start updating
iterations
485
start updating
iterations
486
start updating
iterations
487
start updating
iterations
488
start updating
iterations
489
start updating
iterations
490
start updating
iterations
491
start updating
iterations
492
start updating
iterations
493
start updating
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1695</span><span class="o">-</span><span class="mi">72466956</span><span class="n">edd3</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start iterating&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">5</span>     <span class="n">Update</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> 
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;iterations&quot;</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-1693-9b1782614768&gt;</span> in <span class="ni">Update</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start updating&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">ComputeDensityPressureTemperature</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">ComputeForces</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">Integrate</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">x</span> <span class="o">=</span><span class="p">[]</span>

<span class="nn">&lt;ipython-input-1691-3d5465fa62e2&gt;</span> in <span class="ni">ComputeForces</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> 
<span class="g g-Whitespace">     </span><span class="mi">10</span>             <span class="n">d</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">pi</span><span class="o">.</span><span class="n">X</span>
<span class="ne">---&gt; </span><span class="mi">11</span>             <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>             <span class="n">r</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">h</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> 

<span class="nn">&lt;__array_function__ internals&gt;</span> in <span class="ni">norm</span><span class="nt">(*args, **kwargs)</span>

<span class="nn">~\anaconda3\lib\site-packages\numpy\linalg\linalg.py</span> in <span class="ni">norm</span><span class="nt">(x, ord, axis, keepdims)</span>
<span class="g g-Whitespace">   </span><span class="mi">2474</span>                 <span class="n">sqnorm</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">+</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2475</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2476</span>                 <span class="n">sqnorm</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2477</span>             <span class="n">ret</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqnorm</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2478</span>             <span class="k">if</span> <span class="n">keepdims</span><span class="p">:</span>

<span class="nn">&lt;__array_function__ internals&gt;</span> in <span class="ni">dot</span><span class="nt">(*args, **kwargs)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># have the error in dividing zero density</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># expect the fluid particles to be concentrated at the corner (0,0,0)</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "primer-computational-mathematics/book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./d_geosciences/Fluid_Dynamics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Lecture7_Pipe_Flow_with_Heat.html" title="previous page">Lecture7_Pipe_Flow_with_Heat</a>
    <a class='right-next' id="next-link" href="../remote_sensing/intro.html" title="next page">Remote sensing</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Imperial College London<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>